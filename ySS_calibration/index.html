<html>

<script src="sPager.js"></script>

<script src="s_calibration.js"></script>
<script src="s_calibrationPage.js"></script>


<script src="s_basicSail.js"></script>
<script src="s_basicSailPage.js"></script>

<script src="s_ilooNav.js"></script>
<script src="s_ilooNavPage.js"></script>


<script src="s_fitscreen.js"></script>
<script src="s_blankPage.js"></script>

<script src="s_testFuncs.js"></script>
<script src="s_testFuncsPage.js"></script>



<script src="jquery.min.js"></script>
<script src="jquery-ui.js"></script>
<script src="svg.min.js"></script>
<script src="mShaders.js"></script>
<script src="mMath.js"></script>
<script src="mOperation.js"></script>
<script src="mWebSockets.js"></script>



<link rel="stylesheet" href="jquery-ui.css">
<link rel="stylesheet" href="main.css">


<script>

const pager = new sPager();
pager.addPage( new s_calibrationPage() );
pager.addPage( new s_basicSailPage() );
pager.addPage( new s_ilooNavPage() );
pager.addPage( new s_testFuncsPage() );
pager.addPage( new s_blankPage() );



function sendSetAccCor(){
  var ts = $("#sliX").slider('value')+","+
    $("#sliY").slider('value')+","+
    $("#sliZ").slider('value');
  console.log("ts:"+ts);
  sOutSend("action:setAccCor:"+ts);
  $("#accCorrV").text( ts );

}

// for tests


function svgTests(  ){

  var tt = SVG.find("#textTest");
  tt.text("");

	$( "#sliRotTest" ).slider({
			slide: function( event, ui ) {
				console.log(ui.value);
				rotateSvg( "boatHeel", true, ui.value );
					},
				min:-180,
				max:180,
				value:10
			});

}


function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

$( document ).ready(function() {
	console.log( "ready!" );
	//

	svgTests();

	wsConnectIn( pager );
	wsConnectOut();

	pager.getPage( -1 );

  // store last sean page on browser
  var lastUse = document.cookie;
  console.log("have cookie from last use: ["+lastUse+"]");
  var lastPageNo = getCookie('lastPage');
  console.log("lastPage: ["+lastPageNo+"]")
  if( lastPageNo != "" )
    pager.setPage( parseInt( lastPageNo ) );

  //pager.setPage( 3 );

  //mkShader('invert');
  //mkShader('normal');
  //mkShader('blackRed');


});


function mkfullscreen() {
  var doc = window.document;
  var docEl = doc.documentElement;

  var requestFullScreen =
    docEl.requestFullscreen ||
    docEl.mozRequestFullScreen ||
    docEl.webkitRequestFullScreen ||
    docEl.msRequestFullscreen;
  var cancelFullScreen =
    doc.exitFullscreen ||
    doc.mozCancelFullScreen ||
    doc.webkitExitFullscreen ||
    doc.msExitFullscreen;

  if (
    !doc.fullscreenElement &&
    !doc.mozFullScreenElement &&
    !doc.webkitFullscreenElement &&
    !doc.msFullscreenElement
  ) {
    requestFullScreen.call(docEl);
  } else {
    cancelFullScreen.call(doc);
  }
}

if( 0 ){
  console.log("shoud be: -90: "+ mMapVal( 0, 0, 180, -90,90 ));
  console.log("shoud be: 0: "+ mMapVal( 90, 0, 180, -90,90 ));
  console.log("shoud be: 90: "+ mMapVal( 180, 0, 180, -90,90 ));

  console.log("shoud be: 90: "+ mMapVal( 0, 0, 180, 90,-90 ));
  console.log("shoud be: 0: "+ mMapVal( 90, 0, 180, 90,-90 ));
  console.log("shoud be: -90: "+ mMapVal( 180, 0, 180, 90,-90 ));

  console.log("shoud be: 90: "+ mMapVal( 0, 180, 0, -90,90 ));
  console.log("shoud be: 0: "+ mMapVal( 90, 180, 0, -90,90 ));
  console.log("shoud be: -90: "+ mMapVal( 180, 180, 0, -90,90 ));

  console.log("shoud be: -90: "+ mMapVal( 0, 180, 0, 90,-90 ));
  console.log("shoud be: 0: "+ mMapVal( 90, 180, 0, 90,-90 ));
  console.log("shoud be: 90: "+ mMapVal( 180, 180, 0, 90,-90 ));


  console.log("shoud be: 0: "+ mMapVal( 0, 1, 20, 0,1, true ));
  console.log("shoud be: 1: "+ mMapVal( 20, 1, 20, 0,1, true ));
  console.log("shoud be: >1: "+ mMapVal( 30, 1, 20, 0,1, true ));

  console.log("shoud be: 0: "+ mMapVal( 0, -1, -20, 0,1, true ));
  console.log("shoud be: 1: "+ mMapVal( -20, -1, -20, 0,1, true ));
  console.log("shoud be: >1: "+ mMapVal( -30, -1, -20, 0,1, true ));
}

if( 0 ){
  var dm = '928.80856';
  var dm = '07838.028';
  function ddmmToLdec( ddmm ){
    var dot = ddmm.indexOf('.');
    console.log("dot is at "+dot);
    var dd = parseInt(ddmm.substring(0,dot-2));
    console.log("dd:"+dd);
    var mm = parseFloat( ddmm.substring(dot-2) );
    console.log("mm.mmmm:"+mm);
    var dec = dd + ( mm/60 );
    console.log("dec:"+dec);
  }
  ddmmToLdec( dm );
}

if( 0 ){
  var inIs = 234.124151;
  console.log("in:"+inIs);
  console.log(" fixto 0: "+inIs.toFixed(0));
  console.log(" fixto 2: "+inIs.toFixed(2));
  console.log(" fixto 20: "+inIs.toFixed(20));


}


</script>


<body>
<div style="display:none;position:absolute;top:200;">
test start: <br>
<input type="button" value="heel 0" onclick="rotateImage($('#heelI'),0.1)" >
<input type="button" value="heel 90" onclick="rotateImage($('#heelI'),90)" >
<input type="button" value="send ws msg" onclick="sOutSend(1)" >
<div id="sliRotTest" width="200" height="50"></div>
test end<br>
</div>


<div id="svgDyno">--</div>
<div id="htmlDyno" style="z-index:2;position:absolute;top:0;left:0;"></div>
<div style="z-index:2;position:absolute;bottom:0;left:0;">
in:[<div id="wsInStat" style="display:inline;">?</div>]
out:[<div id="wsOutStat" style="display:inline;">out?</div>]
<input type="button" value="On" onclick="sOutSend('action:on')" >
<input type="button" value="Off" onclick="sOutSend('action:off')" >
<input type="button" value="Menu" onclick="pager.setPage(-1)" >
<input type="button" value="full screen" onclick="mkfullscreen()" >
<input type="button" value="invert" onclick="mkShader('invert')" >
<input type="button" value="black red" onclick="mkShader('blackRed')" >
<input type="button" value="normal" onclick="mkShader('normal')" >
</div>

</body>

</html>
