[{"id":"2805bf47b395ec69","type":"tab","label":"Flow 1","disabled":false,"info":"","env":[]},{"id":"4b4e977e469fe455","type":"tab","label":"svgPlayground","disabled":false,"info":"","env":[]},{"id":"eec13ab45dc87a52","type":"tab","label":"svg time demo","disabled":false,"info":"","env":[]},{"id":"19e839b4177936cb","type":"tab","label":"WebGl 1","disabled":false,"info":"","env":[]},{"id":"4fd9ba86a4d24d52","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"59f8c157b9329c7d","type":"tab","label":"WindGuruCron","disabled":false,"info":"","env":[]},{"id":"a0e3ddcae30323e6","type":"tab","label":"Battery","disabled":false,"info":"","env":[]},{"id":"252ee7ba87c4e484","type":"tab","label":"TTS in input","disabled":false,"info":"","env":[]},{"id":"0a5e45f66bde827b","type":"tab","label":"GPS position slow","disabled":false,"info":"","env":[]},{"id":"744d808088e3adef","type":"tab","label":"ySensorsService to dell","disabled":false,"info":"","env":[]},{"id":"805e345c078ffbda","type":"tab","label":"ySensorService manager","disabled":false,"info":"","env":[]},{"id":"dc100dc94d61a256","type":"tab","label":"ySS oriCal","disabled":false,"info":"","env":[]},{"id":"82109d129821a2e2","type":"tab","label":"ySS at nex7","disabled":false,"info":"","env":[]},{"id":"efa51897ea7cb7f4","type":"tab","label":"Full houre bell binary","disabled":false,"info":"","env":[]},{"id":"4995893face99fd4","type":"tab","label":"SerWatchDog","disabled":false,"info":"","env":[]},{"id":"d4e42f8b078da96a","type":"tab","label":"Resource logs","disabled":false,"info":"","env":[]},{"id":"6a13900dd386ba70","type":"tab","label":"topicsConvert2v2","disabled":false,"info":"","env":[]},{"id":"f87d21ae04d5fae1","type":"tab","label":"esp01APDrive Talk","disabled":false,"info":"","env":[]},{"id":"e5f86021d852c38b","type":"subflow","name":"TTS for nex7","info":"","category":"","in":[{"x":60,"y":160,"wires":[{"id":"9f3ad961a4c07e10"},{"id":"631f72fac3630169"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"4bf528a73403ee8b","type":"mqtt-broker","name":"MqAtNex7","broker":"localhost","port":"10883","clientid":"nodeRedNex7Client","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"9c25e41ddfee2304","type":"ui_tab","name":"HomeTab","icon":"dashboard","disabled":false,"hidden":false},{"id":"602c39db822ce36a","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#cc0014","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#ffffff","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"dark grafana","default":"#4B7930","baseColor":"#944505","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":true},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"61c6bca08211128d","type":"ui_group","name":"Button tests - form","tab":"e005d6230d30f185","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"794897b66b94a457","type":"position-config","name":"Panama","isValide":"true","longitude":"0","latitude":"0","angleType":"deg","timeZoneOffset":"99","timeZoneDST":"0","stateTimeFormat":"3","stateDateFormat":"12","contextStore":""},{"id":"e005d6230d30f185","type":"ui_tab","name":"Tab2Test","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"19aa2c060832338b","type":"ui_group","name":"Dell battery tests","tab":"9c25e41ddfee2304","order":1,"disp":false,"width":"6","collapse":false,"className":""},{"id":"c20e25fb6de0c5b9","type":"ui_group","name":"JS timer demo","tab":"a28ff08f.3a822","order":1,"disp":true,"width":"30","collapse":false,"className":""},{"id":"a28ff08f.3a822","type":"ui_tab","name":"SVG","icon":"dashboard","order":38,"disabled":false,"hidden":false},{"id":"617051e711398356","type":"mqtt-broker","name":"mqttAtDell","broker":"192.168.43.220","port":"12883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"89749fb7.87f01","type":"ui_group","name":"Charts","tab":"","order":2,"disp":false,"width":"6"},{"id":"ab397e95.29ebe","type":"ui_group","name":"Inputs","tab":"","order":1,"disp":false,"width":"6"},{"id":"4e7edda4.417004","type":"ui_group","name":"Group 3","tab":"","order":3,"disp":false,"width":"6"},{"id":"be095263.b9616","type":"ui_group","name":"Charts","tab":"fffa5e09.2e08e8","order":2,"disp":false,"width":"6","collapse":false},{"id":"1d6a585.01f5d28","type":"ui_group","name":"Charts 3","tab":"fffa5e09.2e08e8","order":4,"disp":false,"width":"6","collapse":false},{"id":"b8a66ed1.d5bbc8","type":"ui_group","name":"Charts2","tab":"fffa5e09.2e08e8","order":3,"disp":false,"width":"6","collapse":false},{"id":"f4be6707.b57a28","type":"ui_group","name":"Input","tab":"fffa5e09.2e08e8","order":1,"disp":false,"width":"4","collapse":false},{"id":"fffa5e09.2e08e8","type":"ui_tab","name":"Home","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"b860fa6062a0cd92","type":"ui_tab","name":"ySensorsService2dell","icon":"dashboard","order":6,"disabled":false,"hidden":false},{"id":"7d18e7f1f3d5bd09","type":"ui_group","name":"Bearing","tab":"b860fa6062a0cd92","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"00ebcb1b054ce52e","type":"ui_group","name":"pitch","tab":"b860fa6062a0cd92","order":2,"disp":true,"width":"6","collapse":false,"className":""},{"id":"5c5c3a36c2a64fdb","type":"ui_group","name":"heel","tab":"b860fa6062a0cd92","order":3,"disp":true,"width":"6","collapse":false,"className":""},{"id":"6b9b854d61b75dd7","type":"ui_tab","name":"svgPlayground","icon":"dashboard","disabled":false,"hidden":false},{"id":"709a837ec09f1259","type":"ui_group","name":"niddle1","tab":"6b9b854d61b75dd7","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"22383a74ec7b5b52","type":"ui_tab","name":"ySS at nex7","icon":"dashboard","disabled":false,"hidden":false},{"id":"259eb7cb0880866d","type":"ui_group","name":"Actions","tab":"22383a74ec7b5b52","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"cbada9e3a1ba45d8","type":"MySQLdatabase","name":"","host":"127.0.0.1","port":"3306","db":"svoiysh","tz":"","charset":"UTF8"},{"id":"d611ceefa2b9fd0b","type":"mqtt-broker","name":"nodeRedAtHu","broker":"localhost","port":"10883","clientid":"nodeRedHu","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"c6bb1eb5.edd3d","type":"websocket-listener","path":"/ws/publish","wholemsg":"true"},{"id":"a5db9e65.7dd36","type":"websocket-listener","path":"/ws/receive","wholemsg":"true"},{"id":"2061b059bbc89ff7","type":"ui_group","name":"Every","tab":"b860fa6062a0cd92","order":4,"disp":false,"width":"6","collapse":false,"className":""},{"id":"1933a87dd47c0e42","type":"ui_group","name":"accel rotation","tab":"b860fa6062a0cd92","order":5,"disp":true,"width":"6","collapse":false,"className":""},{"id":"d31b28f36c269c47","type":"ui_group","name":"hdg rotation","tab":"b860fa6062a0cd92","order":6,"disp":true,"width":"6","collapse":false,"className":""},{"id":"5450e80745edff9b","type":"influxdb","hostname":"192.168.43.220","port":"8086","protocol":"http","database":"test3","name":"influxAtDell","usetls":false,"tls":"","influxdbVersion":"1.x","url":"http://localhost:8086","rejectUnauthorized":true},{"id":"53cf504.e9555b","type":"ui_group","name":"test","tab":"52aaa596.768b7c","order":1,"disp":true,"width":"12"},{"id":"52aaa596.768b7c","type":"ui_tab","name":"Test","icon":"dashboard"},{"id":"8d95526bcc58b42d","type":"ui_tab","name":"Resources","icon":"dashboard","disabled":false,"hidden":false},{"id":"2d06544978a5a923","type":"ui_group","name":"Default","tab":"8d95526bcc58b42d","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"1b214600.17935a","type":"ui_group","name":"Default","tab":"b8fb94f4.0d31d8","order":1,"disp":true,"width":"12","collapse":false},{"id":"b8fb94f4.0d31d8","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"8516e78c8b694779","type":"websocket-listener","path":"/ws/accel/oriCal","wholemsg":"true"},{"id":"d044c72ae32c6ef5","type":"websocket-listener","path":"/ws/test","wholemsg":"false"},{"id":"5192310fb92c0375","type":"websocket-listener","path":"/ws/accel/oriCal_In","wholemsg":"false"},{"id":"340f9eb1226975ae","type":"websocket-listener","path":"/ws/ap","wholemsg":"false"},{"id":"a9d942b1a9429b90","type":"websocket-listener","path":"/ws/pcr/newImg","wholemsg":"false"},{"id":"e09abdf33780475f","type":"websocket-listener","path":"/ws/pwf/newImg","wholemsg":"false"},{"id":"69e856b8b70c05bf","type":"websocket-client","path":"ws://192.168.43.1:13001/","tls":"","wholemsg":"false","hb":"0"},{"id":"0f8653816322bb62","type":"websocket-listener","path":"/ws/test2","wholemsg":"false"},{"id":"23cee834d6e61e4c","type":"ui_tab","name":"FFT analisis","icon":"dashboard","order":12,"disabled":false,"hidden":false},{"id":"98ce195fe7f2ef28","type":"ui_group","name":"heel group","tab":"23cee834d6e61e4c","order":1,"disp":true,"width":"6","collapse":false,"className":""},{"id":"21fb4565.85565a","type":"ui_group","name":"demo 1","tab":"","order":1,"disp":false,"width":"12","collapse":false},{"id":"c7a27394.057878","type":"ui_group","name":"CHART","tab":"54e197d8.7f7fe8","order":2,"disp":false,"width":"9","collapse":false},{"id":"54e197d8.7f7fe8","type":"ui_tab","name":"Home","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"d97d5d012858d934","type":"termux-tts-speak","z":"e5f86021d852c38b","name":"","topic":"","engine":"","language":"","pitch":"0.75","rate":"0.97","stream":"notification","text":"","x":1050,"y":80,"wires":[]},{"id":"fc44f8c8e018d39d","type":"within-time-switch","z":"e5f86021d852c38b","name":"","nameInt":"","positionConfig":"794897b66b94a457","startTime":"07:00","startTimeType":"entered","startOffset":0,"startOffsetType":"none","startOffsetMultiplier":60000,"endTime":"21:00","endTimeType":"entered","endOffset":0,"endOffsetType":"none","endOffsetMultiplier":60000,"timeRestrictions":0,"timeRestrictionsType":"none","timeDays":"*","timeOnlyOddDays":false,"timeOnlyEvenDays":false,"timeOnlyOddWeeks":false,"timeOnlyEvenWeeks":false,"timeMonths":"*","timedatestart":"","timedateend":"","propertyStart":"","propertyStartType":"none","propertyStartCompare":"true","propertyStartThreshold":"","propertyStartThresholdType":"num","startTimeAlt":"","startTimeAltType":"none","startOffsetAlt":0,"startOffsetAltType":"none","startOffsetAltMultiplier":60000,"propertyEnd":"","propertyEndType":"none","propertyEndCompare":"true","propertyEndThreshold":"","propertyEndThresholdType":"num","endTimeAlt":"","endTimeAltType":"none","endOffsetAlt":0,"endOffsetAltType":"none","endOffsetAltMultiplier":60000,"withinTimeValue":"true","withinTimeValueType":"msgInput","outOfTimeValue":"false","outOfTimeValueType":"msgInput","tsCompare":"0","x":370,"y":200,"wires":[["d92aba21df2109e8"],[]]},{"id":"9f3ad961a4c07e10","type":"switch","z":"e5f86021d852c38b","name":"","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"alert","vt":"str"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":190,"y":120,"wires":[["d92aba21df2109e8"],["fc44f8c8e018d39d"]]},{"id":"78c758d916dadcce","type":"exec","z":"e5f86021d852c38b","command":"/data/data/com.termux/files/home/playSound.sh","addpay":"mp3","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"play sound","x":830,"y":140,"wires":[[],[],[]]},{"id":"d92aba21df2109e8","type":"function","z":"e5f86021d852c38b","name":"","func":"if( msg.hasOwnProperty('status') ){\n    msg.mp3 = 'relaxing-bell-ding-sound.mp3';\n    if( msg.status == 'alert' )\n        msg.mp3 = 'ahooga-horn.mp3';\n    else if( msg.status == 'weather' )\n        msg.mp3 = '511491_5408716-lq.mp3';\n    \n    \n}else{\n    msg.mp3 = 'bell-rings-short.mp3'; \n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":100,"wires":[["78c758d916dadcce","e7fe0ea7bde6ef87"]]},{"id":"e7fe0ea7bde6ef87","type":"delay","z":"e5f86021d852c38b","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":820,"y":80,"wires":[["d97d5d012858d934"]]},{"id":"ed692d77484a6237","type":"inject","z":"e5f86021d852c38b","name":"select","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"select * from todolist where id>:id;","payload":"{'id':'10'}","payloadType":"jsonata","x":1030,"y":340,"wires":[[]]},{"id":"013b279561887f92","type":"debug","z":"e5f86021d852c38b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1390,"y":360,"wires":[]},{"id":"2cc1d11be653a24e","type":"comment","z":"e5f86021d852c38b","name":"create table","info":"CREATE TABLE `nrNotifications` (     \n    `id` int(11) NOT NULL AUTO_INCREMENT,          \n    `status` varchar(255) COLLATE utf8_bin NOT NULL,     \n    `sentence` varchar(255) COLLATE utf8_bin NOT NULL,          \n    `entryDate` int(11) NOT NULL,     \n    PRIMARY KEY (`id`) \n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin AUTO_INCREMENT=1;","x":1230,"y":360,"wires":[]},{"id":"631f72fac3630169","type":"function","z":"e5f86021d852c38b","name":"","func":"entryDate = Math.floor(Date.now() / 1000);\ntr = {};\ntr['topic'] = 'insert into nrNotifications \\\n    (status, sentence,entryDate) VALUES \\\n    (:status,:sentence,:entryDate)';\n    \nstatus = 'info';\nif( msg.hasOwnProperty('status') )\n    status = msg.status;\n    \ntr['payload'] = {\n    'status':   status,\n    'sentence': msg.payload,\n    'entryDate':    entryDate\n};\n\nreturn tr;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1020,"y":420,"wires":[["82aa528e4d32774e"]]},{"id":"92347ebd3e539817","type":"inject","z":"e5f86021d852c38b","name":"select","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"select * from todolist where id>:id;","payload":"{'id':'10'}","payloadType":"jsonata","x":1030,"y":480,"wires":[[]]},{"id":"82aa528e4d32774e","type":"debug","z":"e5f86021d852c38b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1360,"y":540,"wires":[]},{"id":"ae8a654daf7ef55d","type":"catch","z":"e5f86021d852c38b","name":"","scope":null,"uncaught":false,"x":950,"y":580,"wires":[["6833bad786edc84d"]]},{"id":"6833bad786edc84d","type":"debug","z":"e5f86021d852c38b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1160,"y":600,"wires":[]},{"id":"2bc9d15b17c20230","type":"mqtt in","z":"2805bf47b395ec69","name":"","topic":"dell/bat/vol","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":80,"y":220,"wires":[["9716d956bde7d18f","769a33ca24396553"]]},{"id":"9716d956bde7d18f","type":"function","z":"2805bf47b395ec69","name":"","func":"msg.payload = parseInt(msg.payload)/1000000;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":240,"wires":[["e5d201a2b63960ce","37919b2fcfc30fd9","e3db5f2d17f6821d","a1b0333542524a9b"]]},{"id":"e5d201a2b63960ce","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":500,"y":240,"wires":[]},{"id":"37919b2fcfc30fd9","type":"ui_text","z":"2805bf47b395ec69","group":"19aa2c060832338b","order":1,"width":"6","height":"1","name":"","label":"Dell battery","format":"{{msg.payload}} volt.","layout":"row-spread","className":"","x":440,"y":120,"wires":[]},{"id":"e3db5f2d17f6821d","type":"ui_audio","z":"2805bf47b395ec69","name":"","group":"19aa2c060832338b","voice":"Google US English","always":"","x":410,"y":60,"wires":[]},{"id":"5e7ddf07a73f90e5","type":"http response","z":"2805bf47b395ec69","name":"","statusCode":"","headers":{},"x":130,"y":440,"wires":[]},{"id":"66419aedd3e5bce5","type":"http request","z":"2805bf47b395ec69","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","senderr":false,"x":180,"y":340,"wires":[[]]},{"id":"23ecb0d55552125a","type":"tcp out","z":"2805bf47b395ec69","host":"","port":"19009","beserver":"server","base64":false,"end":false,"name":"","x":450,"y":480,"wires":[]},{"id":"39d880a6d7a744ca","type":"delay","z":"2805bf47b395ec69","d":true,"name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":300,"y":440,"wires":[["23ecb0d55552125a"]]},{"id":"5dcf856d6c4ceaf8","type":"trigger","z":"2805bf47b395ec69","name":"","op1":"1","op2":"0","op1type":"val","op2type":"val","duration":"250","extend":"false","overrideDelay":"false","units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":200,"y":500,"wires":[[]]},{"id":"a1b0333542524a9b","type":"switch","z":"2805bf47b395ec69","name":"","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"11.97","vt":"num","v2":"11.93","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":380,"wires":[[]]},{"id":"0664a147ef16d94e","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":800,"y":240,"wires":[]},{"id":"dafb5cdc0b3eb8da","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":690,"y":100,"wires":[["7fecb1fa48b5e407"]]},{"id":"7fecb1fa48b5e407","type":"termux-location","z":"2805bf47b395ec69","name":"","topic":"","provider":"gps","request":"once","x":730,"y":160,"wires":[["0664a147ef16d94e"]]},{"id":"769a33ca24396553","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":230,"y":120,"wires":[]},{"id":"ddb736f5b53c5ba4","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"test tts no status","payloadType":"str","x":1020,"y":480,"wires":[["de491fd6264c7809"]]},{"id":"0f367c258bd84f40","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"status","v":"alert","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"test status alert","payloadType":"str","x":1020,"y":540,"wires":[["de491fd6264c7809"]]},{"id":"c75a07f8fc6b5652","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"status","v":"weather","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"i don't know. if you need a tip-off to confirm this, consider the customary designation of prehistoric peoples as ","payloadType":"str","x":1010,"y":340,"wires":[["de491fd6264c7809"]]},{"id":"5ff87a84a0c7c570","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"status","v":"info","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"test info sound","payloadType":"str","x":1020,"y":440,"wires":[["de491fd6264c7809"]]},{"id":"043fafb6102b564d","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1020,"y":140,"wires":[["28a1cb7f1568b147"]]},{"id":"db0d3612e15e6bcf","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":140,"wires":[]},{"id":"28a1cb7f1568b147","type":"function","z":"2805bf47b395ec69","name":"","func":"v = context.get(\"abcc\")||0;\nv++;\ncontext.set(\"abcc\",v);\n\n// https://nodered.org/docs/creating-nodes/status\nnode.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"test 123\"\n});\n\nreturn {'payload':v};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1190,"y":140,"wires":[["db0d3612e15e6bcf"]]},{"id":"9ef47b54e83282c1","type":"inject","z":"2805bf47b395ec69","name":"to db - info.","props":[{"p":"payload"},{"p":"status","v":"info","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"test 002 - notification to database storage, status info","payloadType":"str","x":980,"y":600,"wires":[["de491fd6264c7809"]]},{"id":"de491fd6264c7809","type":"link out","z":"2805bf47b395ec69","name":"","mode":"link","links":["0ffa6fe5432288f0"],"x":1225,"y":480,"wires":[]},{"id":"b93c912d40a3e6a0","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1210,"y":80,"wires":[["db0d3612e15e6bcf"]]},{"id":"58da5ebf4b32673e","type":"ui_button","z":"2805bf47b395ec69","name":"","group":"61c6bca08211128d","order":1,"width":"3","height":"1","passthru":false,"label":"Klik it!","tooltip":"","color":"","bgcolor":"","className":"","icon":"standby","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":110,"y":760,"wires":[["d9977a9a334bcde4"]]},{"id":"1e0ea13cb743d9a8","type":"ui_text","z":"2805bf47b395ec69","group":"61c6bca08211128d","order":3,"width":0,"height":0,"name":"","label":"count","format":"{{msg.payload}}","layout":"row-spread","className":"","x":230,"y":920,"wires":[]},{"id":"d9977a9a334bcde4","type":"function","z":"2805bf47b395ec69","name":"","func":"n = context.get(\"btC\")||1;\ncontext.set(\"btC\",++n);\nreturn [\n    {payload:n},\n    {\n        \"payload\": {\n        \"command\": \"update_text\",\n        \"selector\": \"#textAtSvg\",\n        \"textContent\": \"Hello \"+n\n        }\n    }\n    ];","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":220,"y":840,"wires":[["1e0ea13cb743d9a8"],["75faa4554fe66ada"]]},{"id":"8a2965decfd309f4","type":"comment","z":"2805bf47b395ec69","name":"status icon example","info":"","x":1130,"y":40,"wires":[]},{"id":"15bd6e9d51c15e5b","type":"comment","z":"2805bf47b395ec69","name":"notification injection tester","info":"","x":1210,"y":300,"wires":[]},{"id":"75faa4554fe66ada","type":"ui_svg_graphics","z":"2805bf47b395ec69","group":"61c6bca08211128d","order":4,"width":0,"height":0,"svgString":"<svg x=\"0\" y=\"0\" height=\"70\" viewBox=\"0 0 100 100\" width=\"100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<!-- Add here your SVG shapes (circles, rectangles, ...) -->\n<!-- Or remove everything, if you want to paste an entire drawing (<svg...>...</svg>).-->\n<text id=\"textAtSvg\" x=\"10\" y=\"20\" font-family=\"FontAwesome\" font-size=\"12px\" fill=\"blue\" stroke=\"white\" >text</text>\n\n</svg>","clickableShapes":[],"javascriptHandlers":[{"selector":"","action":"msg","sourceCode":"switch(msg.payload) {\n    case \"start_timer\":\n        if(!$scope.myTimer) {\n            $scope.myTimer = setInterval(function() {\n                var randomColor = (Math.random()*100.0)%30;\n                $(\"#textAtSvg\").attr(\"x\", randomColor);\n            }, 100);\n        }\n        break;\n    case \"stop_timer\":\n        if($scope.myTimer) {\n            clearInterval($scope.myTimer);\n            $scope.myTimer = null;\n        }\n        break;\n}\n\n\n\n\n\n\n"}],"smilAnimations":[],"bindings":[],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":false,"showBrowserEvents":false,"enableJsDebugging":true,"sendMsgWhenLoaded":false,"noClickWhenDblClick":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"dblClickZoomPercentage":150,"cssString":"div.ui-svg svg{\n    color: var(--nr-dashboard-widgetColor);\n    fill: currentColor !important;\n}\ndiv.ui-svg path {\n    fill: inherit;\n}","name":"","x":440,"y":840,"wires":[["82b5a4d7ed928723"]]},{"id":"287526a80728e8ec","type":"inject","z":"2805bf47b395ec69","name":"stop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"custom_msg","payload":"stop_timer","payloadType":"str","x":330,"y":1060,"wires":[["75faa4554fe66ada"]]},{"id":"5ac7ed2e9e694d80","type":"inject","z":"2805bf47b395ec69","name":"start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"custom_msg","payload":"start_timer","payloadType":"str","x":330,"y":1000,"wires":[["75faa4554fe66ada","2470efbf337602c1"]]},{"id":"82b5a4d7ed928723","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":570,"y":960,"wires":[]},{"id":"2470efbf337602c1","type":"debug","z":"2805bf47b395ec69","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":510,"y":1020,"wires":[]},{"id":"ad93d5777ae32f13","type":"ui_switch","z":"2805bf47b395ec69","name":"","label":"animation","tooltip":"","group":"61c6bca08211128d","order":2,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"custom_msg","topicType":"str","style":"","onvalue":"start_timer","onvalueType":"str","onicon":"","oncolor":"","offvalue":"stop_timer","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":260,"y":760,"wires":[["75faa4554fe66ada"]]},{"id":"b46e6bb02c0240b1","type":"comment","z":"2805bf47b395ec69","name":"svg experiments","info":"","x":280,"y":680,"wires":[]},{"id":"dd17fd2b06538b98","type":"ui_ui_control","z":"2805bf47b395ec69","name":"","events":"all","x":550,"y":340,"wires":[[]]},{"id":"02a8dc80f3f52c37","type":"ui_form","z":"2805bf47b395ec69","name":"","label":"","group":"61c6bca08211128d","order":4,"width":0,"height":0,"options":[{"label":"It text","value":"ftext","type":"text","required":true,"rows":null},{"label":"it date","value":"fdate","type":"date","required":false,"rows":null},{"label":"it time","value":"ftime","type":"time","required":false,"rows":null}],"formValue":{"ftext":"","fdate":"","ftime":""},"payload":"","submit":"submit","cancel":"cancel","topic":"topic","topicType":"msg","splitLayout":true,"className":"","x":720,"y":460,"wires":[["6cc9c5f649659d30","32247fb05e498bfb"]]},{"id":"6cc9c5f649659d30","type":"ui_template","z":"2805bf47b395ec69","group":"61c6bca08211128d","name":"","order":5,"width":0,"height":0,"format":"<script>console.log(\"from template\");</script>\n<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","className":"","x":730,"y":560,"wires":[[]]},{"id":"32247fb05e498bfb","type":"debug","z":"2805bf47b395ec69","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":730,"y":620,"wires":[]},{"id":"19e85eac7dcf0d33","type":"ui_chart","z":"2805bf47b395ec69","name":"","group":"61c6bca08211128d","order":6,"width":"4","height":"4","label":"HDG","chartType":"radar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":830,"y":780,"wires":[[]]},{"id":"33da4788b3ec0696","type":"mqtt in","z":"2805bf47b395ec69","d":true,"name":"and/mag/bearing","topic":"and/mag/bearing","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":480,"y":740,"wires":[["2f6de155cffdbaed"]]},{"id":"2f6de155cffdbaed","type":"function","z":"2805bf47b395ec69","name":"","func":"var m={};\nm.labels = [];\nfor(var d=0;d<=360;d+=45){\n    m.labels.push(d);\n}\n\n\nm.series = ['HDG', 'COG'];\nm.data = [\n   [{x:1,y:16},{x:10,y:16},{x:30,y:16}],\n   [[90,1],[90,10]]//[6, 19, 5, 30,20, 2]\n  ];\nreturn {payload:[m]};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":840,"wires":[["19e85eac7dcf0d33","5708cdd907c6e038"]]},{"id":"5708cdd907c6e038","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":860,"wires":[]},{"id":"9ab120401c6cbec4","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"11","payloadType":"num","x":680,"y":720,"wires":[["2f6de155cffdbaed"]]},{"id":"b0d345d9f799e2de","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"#000","payloadType":"str","x":1570,"y":140,"wires":[["9522395c5d95dfc8"]]},{"id":"9522395c5d95dfc8","type":"function","z":"2805bf47b395ec69","name":"","func":"var tc = global.get('tinycolor');\n\nvar c1 = tc(msg.payload);\nnode.status({\n    text:\"res:\"+c1.isDark()\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1760,"y":180,"wires":[[]]},{"id":"91c358812b608c99","type":"inject","z":"2805bf47b395ec69","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"#fff","payloadType":"str","x":1560,"y":200,"wires":[["9522395c5d95dfc8"]]},{"id":"533207f7dc127960","type":"comment","z":"2805bf47b395ec69","name":"globar resources","info":"","x":1640,"y":80,"wires":[]},{"id":"346b3ced26b8e225","type":"mqtt in","z":"2805bf47b395ec69","d":true,"name":"","topic":"e01Mux/#","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":1520,"y":440,"wires":[["abcae612b7f04edf","4d8cddca46864ca8"]]},{"id":"4d8cddca46864ca8","type":"debug","z":"2805bf47b395ec69","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1670,"y":340,"wires":[]},{"id":"abcae612b7f04edf","type":"summariser","z":"2805bf47b395ec69","name":"","input":"payload","inputType":"msg","output":"payload","label":"","topic":"","outputs":1,"rules":[{"field":"payload","op":"join","sep":","}],"x":1740,"y":460,"wires":[["5fd086e2935bd0d4"]]},{"id":"5fd086e2935bd0d4","type":"debug","z":"2805bf47b395ec69","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1950,"y":360,"wires":[]},{"id":"2e22c8e32da43881","type":"ui_slider","z":"4b4e977e469fe455","name":"","label":"slider","tooltip":"","group":"709a837ec09f1259","order":2,"width":0,"height":0,"passthru":true,"outs":"all","topic":"topic","topicType":"msg","min":"0","max":"360","step":"1","className":"","x":230,"y":160,"wires":[["2a8d0444c122f3ce"]]},{"id":"f3fb3676938fe150","type":"ui_svg_graphics","z":"4b4e977e469fe455","group":"709a837ec09f1259","order":1,"width":0,"height":0,"svgString":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!-- Created with Inkscape (http://www.inkscape.org/) -->\n\n<svg\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n   xmlns:cc=\"http://creativecommons.org/ns#\"\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n   width=\"100\"\n   height=\"100\"\n   viewBox=\"0 0 100 100\"\n   version=\"1.1\"\n   id=\"svg8\"\n   inkscape:version=\"0.92.5 (2060ec1f9f, 2020-04-08)\"\n   sodipodi:docname=\"100x100Niddle_plain.svg\">\n  <defs\n     id=\"defs2\" />\n  <sodipodi:namedview\n     id=\"base\"\n     pagecolor=\"#ffffff\"\n     bordercolor=\"#666666\"\n     borderopacity=\"1.0\"\n     inkscape:pageopacity=\"0.0\"\n     inkscape:pageshadow=\"2\"\n     inkscape:zoom=\"3.959798\"\n     inkscape:cx=\"31.944689\"\n     inkscape:cy=\"71.051149\"\n     inkscape:document-units=\"px\"\n     inkscape:current-layer=\"svg8\"\n     showgrid=\"false\"\n     inkscape:window-width=\"1366\"\n     inkscape:window-height=\"704\"\n     inkscape:window-x=\"0\"\n     inkscape:window-y=\"27\"\n     inkscape:window-maximized=\"1\"\n     units=\"px\" />\n  <metadata\n     id=\"metadata5\">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about=\"\">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n        <dc:title></dc:title>\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <g\n     id=\"g5153\"\n     transform=\"translate(48.234784,56.316004)\">\n    <g\n       inkscape:label=\"#g5148\"\n       id=\"niddle\">\n      <circle\n         style=\"opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:5;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\"\n         id=\"path5142\"\n         cx=\"-0.25253794\"\n         cy=\"0.24743685\"\n         r=\"10.101525\" />\n      <path\n         style=\"fill:none;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\n         d=\"M 0.25253813,-0.00510127 0.50507627,-56.573643\"\n         id=\"path5144\"\n         inkscape:connector-curvature=\"0\" />\n    </g>\n  </g>\n</svg>","clickableShapes":[],"javascriptHandlers":[],"smilAnimations":[],"bindings":[],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":false,"showBrowserEvents":false,"enableJsDebugging":false,"sendMsgWhenLoaded":false,"noClickWhenDblClick":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"dblClickZoomPercentage":150,"cssString":"div.ui-svg svg{\n    color: var(--nr-dashboard-widgetColor);\n    fill: currentColor !important;\n}\ndiv.ui-svg path {\n    fill: inherit;\n}\n","name":"","x":600,"y":160,"wires":[[]]},{"id":"2a8d0444c122f3ce","type":"function","z":"4b4e977e469fe455","name":"","func":"node.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"angle\"+msg.payload\n});\nreturn {\n        \"payload\": {\n        \"command\": \"set_attribute\",\n        \"selector\": \"#niddle\",\n        \"attributeName\":\"transform\",\n        \"attributeValue\": \"rotate(\"+msg.payload+\")\"\n        }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":160,"wires":[["f3fb3676938fe150"]]},{"id":"d8b8d5afaecd2c56","type":"ui_svg_graphics","z":"4b4e977e469fe455","group":"709a837ec09f1259","order":3,"width":0,"height":0,"svgString":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!-- Created with Inkscape (http://www.inkscape.org/) -->\n\n<svg\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n   xmlns:cc=\"http://creativecommons.org/ns#\"\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n   width=\"300\"\n   height=\"100\"\n   viewBox=\"0 0 300 100\"\n   version=\"1.1\"\n   id=\"svg8\"\n   inkscape:version=\"0.92.5 (2060ec1f9f, 2020-04-08)\"\n   sodipodi:docname=\"100x100heelPitchG.svg\">\n  <defs\n     id=\"defs2\" />\n  <sodipodi:namedview\n     id=\"base\"\n     pagecolor=\"#ffffff\"\n     bordercolor=\"#666666\"\n     borderopacity=\"1.0\"\n     inkscape:pageopacity=\"0.0\"\n     inkscape:pageshadow=\"2\"\n     inkscape:zoom=\"1.4\"\n     inkscape:cx=\"70.554239\"\n     inkscape:cy=\"4.2612306\"\n     inkscape:document-units=\"px\"\n     inkscape:current-layer=\"svg8\"\n     showgrid=\"false\"\n     inkscape:window-width=\"1366\"\n     inkscape:window-height=\"704\"\n     inkscape:window-x=\"0\"\n     inkscape:window-y=\"27\"\n     inkscape:window-maximized=\"1\"\n     units=\"px\" />\n  <metadata\n     id=\"metadata5\">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about=\"\">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n        <dc:title></dc:title>\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <g\n     id=\"g5187\"\n     transform=\"matrix(4.5075429,0,0,4.5075429,149.20597,-55.99207)\">\n    <path\n       sodipodi:nodetypes=\"csscc\"\n       inkscape:connector-curvature=\"0\"\n       id=\"path5174\"\n       d=\"M 29.546962,0.75251269 C 29.546962,11.261749 23.917524,20.965769 14.794579,26.182658 5.6716343,31.399547 -5.5468201,31.32987 -14.60426,26.000064 -23.6617,20.670258 -29.170166,10.89706 -29.039626,0.38863414 c 19.5276143,0.3877438 39.05647,0.36387855 58.586588,0.36387855 z\"\n       style=\"opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:5;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\n    <path\n       inkscape:label=\"#path5177\"\n       inkscape:connector-curvature=\"0\"\n       id=\"niddleB\"\n       d=\"M 0,23.733483 V 36.36039\"\n       style=\"fill:none;stroke:#0000ff;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\n    <path\n       inkscape:transform-center-y=\"29.940158\"\n       inkscape:transform-center-x=\"2.1759812\"\n       inkscape:label=\"#path5179\"\n       inkscape:connector-curvature=\"0\"\n       id=\"niddleR\"\n       d=\"M 0.2623468,24.397648 0,36.36039\"\n       style=\"fill:#720000;fill-opacity:1;stroke:#f70000;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\n    <path\n       inkscape:transform-center-y=\"29.391947\"\n       inkscape:transform-center-x=\"0.12847272\"\n       inkscape:label=\"#path5181\"\n       inkscape:connector-curvature=\"0\"\n       id=\"niddleG\"\n       d=\"M 0.32348183,23.716833 0.17718673,37.329702\"\n       style=\"fill:none;stroke:#00ff00;stroke-width:3;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\n  </g>\n</svg>","clickableShapes":[],"javascriptHandlers":[],"smilAnimations":[],"bindings":[],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":false,"showBrowserEvents":false,"enableJsDebugging":false,"sendMsgWhenLoaded":false,"noClickWhenDblClick":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"dblClickZoomPercentage":150,"cssString":"div.ui-svg svg{\n    color: var(--nr-dashboard-widgetColor);\n    fill: currentColor !important;\n}\ndiv.ui-svg path {\n    fill: inherit;\n}","name":"","x":740,"y":260,"wires":[[]]},{"id":"ebe41fd9f8fa0764","type":"ui_slider","z":"4b4e977e469fe455","name":"","label":"sliderR","tooltip":"","group":"709a837ec09f1259","order":4,"width":0,"height":0,"passthru":true,"outs":"all","topic":"topic","topicType":"msg","min":"-90","max":"90","step":"1","className":"","x":240,"y":260,"wires":[["d9b03dd4d2e85abb"]]},{"id":"d9b03dd4d2e85abb","type":"function","z":"4b4e977e469fe455","name":"","func":"node.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"angle\"+msg.payload\n});\nreturn {\n        \"payload\": {\n        \"command\": \"set_attribute\",\n        \"selector\": \"#niddleR\",\n        \"attributeName\":\"transform\",\n        \"attributeValue\": \"rotate(\"+msg.payload+\")\"\n        }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":260,"wires":[["d8b8d5afaecd2c56"]]},{"id":"59aa1efa585faa69","type":"ui_slider","z":"4b4e977e469fe455","name":"","label":"sliderG","tooltip":"","group":"709a837ec09f1259","order":5,"width":0,"height":0,"passthru":true,"outs":"all","topic":"topic","topicType":"msg","min":"-90","max":"90","step":"1","className":"","x":240,"y":320,"wires":[["e52269ce386233db"]]},{"id":"e52269ce386233db","type":"function","z":"4b4e977e469fe455","name":"","func":"node.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"angle\"+msg.payload\n});\nreturn {\n        \"payload\": {\n        \"command\": \"set_attribute\",\n        \"selector\": \"#niddleG\",\n        \"attributeName\":\"transform\",\n        \"attributeValue\": \"rotate(\"+msg.payload+\")\"\n        }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":320,"wires":[["d8b8d5afaecd2c56"]]},{"id":"2ec0924db0a1416d","type":"ui_slider","z":"4b4e977e469fe455","name":"","label":"sliderB","tooltip":"","group":"709a837ec09f1259","order":6,"width":0,"height":0,"passthru":true,"outs":"all","topic":"topic","topicType":"msg","min":"-90","max":"90","step":"1","className":"","x":230,"y":380,"wires":[["b1325fb8989f6e37"]]},{"id":"b1325fb8989f6e37","type":"function","z":"4b4e977e469fe455","name":"","func":"node.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"angle\"+msg.payload\n});\nreturn {\n        \"payload\": {\n        \"command\": \"set_attribute\",\n        \"selector\": \"#niddleB\",\n        \"attributeName\":\"transform\",\n        \"attributeValue\": \"rotate(\"+msg.payload+\")\"\n        }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":360,"wires":[["d8b8d5afaecd2c56"]]},{"id":"62d3e34714881022","type":"ui_svg_graphics","z":"eec13ab45dc87a52","group":"c20e25fb6de0c5b9","order":0,"width":0,"height":0,"svgString":"<svg x=\"0\" y=\"0\" height=\"100\" viewBox=\"0 0 100 100\" width=\"100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n <g id=\"test\" >\n <rect id= \"my_rectangle\" x=\"0\" y=\"0\" width=\"45\" height=\"45\" fill=\"green\" />\n</g>\n</svg>","clickableShapes":[],"javascriptHandlers":[{"selector":"","action":"msg","sourceCode":"alert(msg.payload);\nswitch(msg.payload) {\n    case \"start_timer\":\n        if(!$scope.myTimer) {\n            $scope.myTimer = setInterval(function() {\n                var randomColor = \"#\" + Math.random().toString(16).slice(2, 8).toUpperCase();\n                $(\"#my_rectangle\").css(\"fill\", randomColor);\n            }, 1000);\n        }\n        break;\n    case \"stop_timer\":\n        if($scope.myTimer) {\n            clearInterval($scope.myTimer);\n            $scope.myTimer = null;\n        }\n        break;\n}\n\n\n\n\n\n\n"}],"smilAnimations":[],"bindings":[],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":true,"showBrowserEvents":false,"enableJsDebugging":false,"sendMsgWhenLoaded":false,"noClickWhenDblClick":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"dblClickZoomPercentage":150,"cssString":"div.ui-svg svg{\n    color: var(--nr-dashboard-widgetColor);\n    fill: currentColor !important;\n}\ndiv.ui-svg path {\n    fill: inherit !important;\n}","name":"","x":500,"y":280,"wires":[[]]},{"id":"a14058eed534879a","type":"inject","z":"eec13ab45dc87a52","name":"Start timer","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"custom_msg","payload":"start_timer","payloadType":"str","x":320,"y":260,"wires":[["62d3e34714881022"]]},{"id":"905f048865b2a319","type":"inject","z":"eec13ab45dc87a52","name":"Stop timer","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"custom_msg","payload":"stop_timer","payloadType":"str","x":320,"y":300,"wires":[["62d3e34714881022"]]},{"id":"82bc22cb.914be","type":"http in","z":"19e839b4177936cb","name":"","url":"/cube","method":"get","upload":false,"swaggerDoc":"","x":300,"y":180,"wires":[["0e705ef28f280c97"]]},{"id":"6752712.7f98a9","type":"http response","z":"19e839b4177936cb","name":"","statusCode":"","headers":{},"x":825,"y":180,"wires":[]},{"id":"ab9b0e5e.f8f8b","type":"template","z":"19e839b4177936cb","name":"three.js","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n\n    <title>Test</title>\n\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    \n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/three.js/109/three.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/three.js/109/three.min.js\"></script>\n    <script src=\"https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/GLTFLoader.js\"></script>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/three.js/109/three.module.js\"></script>\n    \n<script>\nvar server = window.location.href.split(\"http://\")[1].split(\"/\")[0]\nconsole.log(\"Page location is \" + server)\n\nvar socket1 = new  WebSocket(\"ws://\" + server + \"/ws/receive\");\nvar socket2 = new  WebSocket(\"ws://\" + server + \"/ws/publish\");\nvar cubeRotationSpeed = 0.02;\nlet cubeColor = \"blue\"\nvar socket1Opened = false\nvar cubeHeel = 0.0;\nvar cubePitch = 0.0;\n\nsocket1.onopen = function() {\n    socket1Opened = true\n  var message = {\n    'payload': 'Client connected'\n  };\n  socket1.send(JSON.stringify(message));\n};\n\nsocket2.onopen = function() {\n  var message = {\n    'payload': 'Client connected'\n  };\n  socket1.send(JSON.stringify(message));\n};\n\nsocket2.onclose = function(){\n  console.log('Connection closed');\n};\n\nsocket2.onerror = function(error) {\n  console.log('Error detected: ' + JSON.stringify(error));\n};\n\nsocket2.onmessage = function(e) {\n  var server_message = e.data;\n  responseObject = JSON.parse(server_message);\n\n  //alert(JSON.stringify(responseObject));\n  //Do the required stuff\n  console.log(responseObject.payload)\n  if (responseObject.payload.cubeRotationSpeed){\n      cubeRotationSpeed = responseObject.payload.cubeRotationSpeed\n  }else if(responseObject.payload.cubeColor){\n      cubeColor = responseObject.payload.cubeColor\n  }else if(responseObject.payload.cubeRotationHeel){\n      cubeHeel = responseObject.payload.cubeRotationHeel;\n      console.log(\"got heel\"+cubeHeel);\n      \n  }else if(responseObject.payload.cubeRotationPitch){\n      cubePitch = responseObject.payload.cubeRotationPitch;\n      \n  }\n}\n\nvar scene = new THREE.Scene();\n\n// Make highly-transparent plane\nvar fadeMaterial = new THREE.MeshBasicMaterial({\n    color: 0x0000f0,\n    transparent: true,\n    opacity: 0.1\n});\nvar fadePlane = new THREE.PlaneBufferGeometry(1, 1);\nvar fadeMesh = new THREE.Mesh(fadePlane, fadeMaterial);\n\n// Create Object3D to hold camera and transparent plane\nvar camGroup = new THREE.Object3D();\nvar camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);\ncamGroup.add(camera);\ncamGroup.add(fadeMesh);\n\n// Put plane in front of camera\nfadeMesh.position.z = -0.1;\n\n// Make plane render before particles\nfadeMesh.renderOrder = -1;\n\n// Add camGroup to scene\nscene.add(camGroup);\n\n\nrenderer = new THREE.WebGLRenderer( { preserveDrawingBuffer: true, antialias: true } );\nrenderer.autoClearColor = true;\nrenderer.setSize(window.innerWidth, window.innerHeight);\n\ndocument.addEventListener('DOMContentLoaded', function () {   \n    document.body.appendChild(renderer.domElement);\n});\n\nvar geometry = new THREE.BoxGeometry(1,1,1);\n//var color = new THREE.Color(0xff0000)\nvar material = new THREE.MeshBasicMaterial({color: \"blue\"});\nvar cube = new THREE.Mesh(geometry, material);\n//scene.add(cube);\n\ncube.position.z = -5;\n\n\n\n\n\n\n\nloader = new THREE.GLTFLoader()\nloader.load( '/3d_boat', function ( gltf ) {\n    scene.add( gltf.scene ); \n    console.log(\"added !\");\n    \n});\n\n\n\n\n\n\nvar step = .03;\nfunction animate(){\n\n    cube.rotation.z = -cubeHeel;\n    cube.rotation.x = -cubePitch;\n    cube.position.x = step;\n    cube.material.color = new THREE.Color(cubeColor);\n    if(Math.abs(cube.position.x) > 5.0)\n    {\n        step = -step;\n        if (socket1Opened){\n            socket1.send(\"ping\");\n        }\n    }\n    renderer.render(scene, camera);\n\n    requestAnimationFrame(animate);\n}\n\nanimate();\n\n</script>\n\n\n","output":"str","x":480,"y":120,"wires":[[]]},{"id":"f8262338.541b2","type":"websocket out","z":"19e839b4177936cb","name":"","server":"c6bb1eb5.edd3d","client":"","x":1060,"y":300,"wires":[]},{"id":"1f953c53.234544","type":"inject","z":"19e839b4177936cb","name":"Spin slow","props":[{"p":"payload","v":"{\"cubeRotationSpeed\":0.02}","vt":"json"},{"p":"topic","v":"","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"cubeRotationSpeed\":0.02}","payloadType":"json","x":625,"y":300,"wires":[["f8262338.541b2"]]},{"id":"ae4b9f83.855ed","type":"inject","z":"19e839b4177936cb","name":"Spin fast","props":[{"p":"payload","v":"{\"cubeRotationSpeed\":0.1}","vt":"json"},{"p":"topic","v":"","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"cubeRotationSpeed\":0.1}","payloadType":"json","x":625,"y":345,"wires":[["f8262338.541b2"]]},{"id":"f195cd.89a76a3","type":"change","z":"19e839b4177936cb","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"text/html","tot":"str"},{"t":"set","p":"headers.Access-Control-Allow-Origin","pt":"msg","to":"*","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":180,"wires":[["6752712.7f98a9","83c0d3aa27d0fb8b"]]},{"id":"eba548fa.e65d98","type":"change","z":"19e839b4177936cb","name":"","rules":[{"t":"delete","p":"_session","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":815,"y":240,"wires":[["f8262338.541b2"]]},{"id":"c1fc2e6e.bd70e","type":"websocket in","z":"19e839b4177936cb","name":"","server":"a5db9e65.7dd36","client":"","x":300,"y":240,"wires":[["22fc2d8b.025e32"]]},{"id":"22fc2d8b.025e32","type":"switch","z":"19e839b4177936cb","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ping","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":465,"y":240,"wires":[["eaae5e3a.3f284"]]},{"id":"eaae5e3a.3f284","type":"function","z":"19e839b4177936cb","name":"change color","func":"let colors = [\"white\",\"red\",0x00ff00,0x0000ff] //both hex or string are fine\nmsg.payload =  {\"cubeColor\": colors[Math.floor(Math.random()*colors.length)]}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":240,"wires":[["eba548fa.e65d98"]]},{"id":"94b2919c.8d227","type":"comment","z":"19e839b4177936cb","name":"Three.js example with websockets","info":"","x":340,"y":80,"wires":[]},{"id":"73fba6da99a3f0c5","type":"mqtt in","z":"19e839b4177936cb","d":true,"name":"and/orient/pitch","topic":"and/orient/pitch","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":620,"y":400,"wires":[["2f4959565ddfb430"]]},{"id":"efbab7e68c36d04a","type":"function","z":"19e839b4177936cb","name":"","func":"function degrees_to_radians(degrees)\n{\n  var pi = Math.PI;\n  return degrees * (pi/180);\n}\n\n\nreturn {\n    payload: {\n        \"cubeRotationPitch\":degrees_to_radians(msg.payload)\n        \n    } \n    \n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":400,"wires":[["f8262338.541b2"]]},{"id":"2f5a19809c22d91a","type":"mqtt in","z":"19e839b4177936cb","d":true,"name":"and/orient/heel","topic":"and/orient/heel","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":620,"y":460,"wires":[["efbab7e68c36d04a"]]},{"id":"2f4959565ddfb430","type":"function","z":"19e839b4177936cb","name":"","func":"function degrees_to_radians(degrees)\n{\n  var pi = Math.PI;\n  return degrees * (pi/180);\n}\n\n\nreturn {\n    payload: {\n        \"cubeRotationHeel\":degrees_to_radians(msg.payload)\n        \n    } \n    \n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":460,"wires":[["f8262338.541b2"]]},{"id":"82b13845174d77d6","type":"http in","z":"19e839b4177936cb","name":"","url":"/3d_boat","method":"get","upload":false,"swaggerDoc":"","x":290,"y":520,"wires":[["323ef079e7ef1158"]]},{"id":"323ef079e7ef1158","type":"file in","z":"19e839b4177936cb","name":"","filename":"/data/data/com.termux/files/usr/var/lib/proot-distro/installed-rootfs/debian/usr/share/grafana/public/3d/boat2.gltf","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":750,"y":600,"wires":[["f4f31454defc220d"]]},{"id":"bf197ff86d7c0fbe","type":"http response","z":"19e839b4177936cb","name":"","statusCode":"","headers":{},"x":1030,"y":500,"wires":[]},{"id":"f4f31454defc220d","type":"change","z":"19e839b4177936cb","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"text/html","tot":"str"},{"t":"set","p":"headers.Access-Control-Allow-Origin","pt":"msg","to":"*","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":520,"wires":[["bf197ff86d7c0fbe"]]},{"id":"0e705ef28f280c97","type":"file in","z":"19e839b4177936cb","name":"three1","filename":"/data/data/com.termux/files/home/webGl/three1","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":480,"y":180,"wires":[["f195cd.89a76a3"]]},{"id":"1fdddf05eafefdf8","type":"http in","z":"19e839b4177936cb","name":"","url":"/fileHost","method":"get","upload":false,"swaggerDoc":"","x":310,"y":760,"wires":[["e5a9b1fa8aa05463","1b4609e83fb529e4"]]},{"id":"78ded4bf91d09b9d","type":"http response","z":"19e839b4177936cb","name":"","statusCode":"","headers":{},"x":1010,"y":760,"wires":[]},{"id":"bea0436d56bccb1b","type":"change","z":"19e839b4177936cb","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.Access-Control-Allow-Origin","pt":"msg","to":"*","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":760,"wires":[["78ded4bf91d09b9d","8b13b83769fe14f8"]]},{"id":"c878d5f67a87c353","type":"file in","z":"19e839b4177936cb","name":"file reader","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":700,"y":760,"wires":[["bea0436d56bccb1b"]]},{"id":"e5a9b1fa8aa05463","type":"function","z":"19e839b4177936cb","name":"","func":"node.status({text:\"file:\"+msg.payload.file});\n\nmsg.filename = \"/data/data/com.termux/files/home/webGl/\"+msg.payload.file;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":760,"wires":[["c878d5f67a87c353"]]},{"id":"1b4609e83fb529e4","type":"debug","z":"19e839b4177936cb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":860,"wires":[]},{"id":"8b13b83769fe14f8","type":"debug","z":"19e839b4177936cb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":820,"y":940,"wires":[]},{"id":"83c0d3aa27d0fb8b","type":"debug","z":"19e839b4177936cb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":820,"y":80,"wires":[]},{"id":"1fb84b3f.99a1f5","type":"ui_template","z":"4fd9ba86a4d24d52","group":"53cf504.e9555b","name":"Autocomplete","order":0,"width":"6","height":"3","format":"<md-autocomplete md-no-cache=\"true\" md-selected-item=\"selectedItem\" md-items=\"items in msg.options | filter:searchText\" md-select-on-match=\"true\"  md-search-text=\"searchText\" placeholder=\"{{msg.topic}}\" >\n<span ng-bind=\"items\"></span></md-autocomplete>\n        \n<button ng-click=\"msg.payload = selectedItem; send(msg)\">Select</button>\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","className":"","x":720,"y":280,"wires":[["c759cbbe.82b1a8"]]},{"id":"c759cbbe.82b1a8","type":"debug","z":"4fd9ba86a4d24d52","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":880,"y":280,"wires":[]},{"id":"3b725772.4a6ae8","type":"change","z":"4fd9ba86a4d24d52","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"[\"Afghanistan\",\"Albania\",\"Algeria\",\"Andorra\",\"Angola\",\"Anguilla\",\"Antigua & Barbuda\",\"Argentina\",\"Armenia\",\"Aruba\",\"Australia\",\"Austria\",\"Azerbaijan\",\"Bahamas\",\"Bahrain\",\"Bangladesh\",\"Barbados\",\"Belarus\",\"Belgium\",\"Belize\",\"Benin\",\"Bermuda\",\"Bhutan\",\"Bolivia\",\"Bosnia & Herzegovina\",\"Botswana\",\"Brazil\",\"British Virgin Islands\",\"Brunei\",\"Bulgaria\",\"Burkina Faso\",\"Burundi\",\"Canada\",\"Cambodia\",\"Cameroon\",\"Cape Verde\",\"Cayman Islands\",\"Chad\",\"Chile\",\"China\",\"Colombia\",\"Congo\",\"Cook Islands\",\"Costa Rica\",\"Cote D Ivoire\",\"Croatia\",\"Cruise Ship\",\"Cuba\",\"Cyprus\",\"Czech Republic\",\"Denmark\",\"Djibouti\",\"Dominica\",\"Dominican Republic\",\"Ecuador\",\"Egypt\",\"El Salvador\",\"Equatorial Guinea\",\"Estonia\",\"Ethiopia\",\"Falkland Islands\",\"Faroe Islands\",\"Fiji\",\"Finland\",\"France\",\"French Polynesia\",\"French West Indies\",\"Gabon\",\"Gambia\",\"Georgia\",\"Germany\",\"Ghana\",\"Gibraltar\",\"Greece\",\"Greenland\",\"Grenada\",\"Guam\",\"Guatemala\",\"Guernsey\",\"Guinea\",\"Guinea Bissau\",\"Guyana\",\"Haiti\",\"Honduras\",\"Hong Kong\",\"Hungary\",\"Iceland\",\"India\",\"Indonesia\",\"Iran\",\"Iraq\",\"Ireland\",\"Isle of Man\",\"Israel\",\"Italy\",\"Jamaica\",\"Japan\",\"Jersey\",\"Jordan\",\"Kazakhstan\",\"Kenya\",\"Kuwait\",\"Kyrgyz Republic\",\"Laos\",\"Latvia\",\"Lebanon\",\"Lesotho\",\"Liberia\",\"Libya\",\"Liechtenstein\",\"Lithuania\",\"Luxembourg\",\"Macau\",\"Macedonia\",\"Madagascar\",\"Malawi\",\"Malaysia\",\"Maldives\",\"Mali\",\"Malta\",\"Mauritania\",\"Mauritius\",\"Mexico\",\"Moldova\",\"Monaco\",\"Mongolia\",\"Montenegro\",\"Montserrat\",\"Morocco\",\"Mozambique\",\"Namibia\",\"Nepal\",\"Netherlands\",\"Netherlands Antilles\",\"New Caledonia\",\"New Zealand\",\"Nicaragua\",\"Niger\",\"Nigeria\",\"Norway\",\"Oman\",\"Pakistan\",\"Palestine\",\"Panama\",\"Papua New Guinea\",\"Paraguay\",\"Peru\",\"Philippines\",\"Poland\",\"Portugal\",\"Puerto Rico\",\"Qatar\",\"Reunion\",\"Romania\",\"Russia\",\"Rwanda\",\"Saint Pierre & Miquelon\",\"Samoa\",\"San Marino\",\"Satellite\",\"Saudi Arabia\",\"Senegal\",\"Serbia\",\"Seychelles\",\"Sierra Leone\",\"Singapore\",\"Slovakia\",\"Slovenia\",\"South Africa\",\"South Korea\",\"Spain\",\"Sri Lanka\",\"St Kitts & Nevis\",\"St Lucia\",\"St Vincent\",\"St. Lucia\",\"Sudan\",\"Suriname\",\"Swaziland\",\"Sweden\",\"Switzerland\",\"Syria\",\"Taiwan\",\"Tajikistan\",\"Tanzania\",\"Thailand\",\"Timor L'Este\",\"Togo\",\"Tonga\",\"Trinidad & Tobago\",\"Tunisia\",\"Turkey\",\"Turkmenistan\",\"Turks & Caicos\",\"Uganda\",\"Ukraine\",\"United Arab Emirates\",\"United States of America\",\"United Kingdom\",\"Uruguay\",\"Uzbekistan\",\"Venezuela\",\"Vietnam\",\"Virgin Islands (US)\",\"Yemen\",\"Zambia\",\"Zimbabwe\"]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":180,"wires":[[]]},{"id":"d72df936.e5b118","type":"inject","z":"4fd9ba86a4d24d52","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"topics in mqtt layer","payload":"","payloadType":"date","x":250,"y":100,"wires":[["3b725772.4a6ae8"]]},{"id":"56ae68a6c7714cc7","type":"inject","z":"4fd9ba86a4d24d52","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":400,"wires":[["18cb14f649cda352"]]},{"id":"93a4c8fd1686ec19","type":"debug","z":"4fd9ba86a4d24d52","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":400,"wires":[]},{"id":"18cb14f649cda352","type":"influxdb in","z":"4fd9ba86a4d24d52","influxdb":"5450e80745edff9b","name":"","query":"show tag values from msgs6 with key =~ /.*/","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":460,"y":400,"wires":[["85f91523c35cfa87"]]},{"id":"85f91523c35cfa87","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"tr = new Array()\n\nfor(var i=0;i<msg.payload.length;i++){\n    if( msg.payload[i].key == \"topic\" ){\n        tr.push(msg.payload[i].value);\n    }\n}\n\n\nreturn {\n    options:tr,\n    topic:\"mqtt topics\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":400,"wires":[["93a4c8fd1686ec19","1fb84b3f.99a1f5"]]},{"id":"f801d191ac8c4ad3","type":"inject","z":"4fd9ba86a4d24d52","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":560,"wires":[["28ca77b611f8f537"]]},{"id":"28ca77b611f8f537","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"r = Math.random();\n//node.status({\n//    text:\"rand\"+r\n//    });\n\nj = {\"result\":{\n    \"data\":Math.round(r*100),\n    \"time\": new Date()\n}};\n\nmsg = {\n    payload:j\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":560,"wires":[["8f68f58cf0c20aea"]]},{"id":"8f68f58cf0c20aea","type":"websocket out","z":"4fd9ba86a4d24d52","name":"ws/test","server":"d044c72ae32c6ef5","client":"","x":620,"y":560,"wires":[]},{"id":"a09c9f29a7926848","type":"comment","z":"4fd9ba86a4d24d52","name":"stream broadcast for grafana as a websocket","info":"","x":290,"y":520,"wires":[]},{"id":"3b0dd1a6b6105152","type":"mqtt in","z":"4fd9ba86a4d24d52","name":"","topic":"and/mag","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":200,"y":640,"wires":[["5ea05c554c05bd0c"]]},{"id":"5ea05c554c05bd0c","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"\n/*\nj = {\"andMag\":{\n    \"data\":msg.payload,\n    \"time\": new Date()\n}};\n*/\nflow.set('andMag',msg.payload);\n\nj = {\n    \"andMag\":msg.payload,\n    'time':new Date().getTime()\n};\n\nmsg = {\n    payload:j\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":640,"wires":[["8f68f58cf0c20aea"]]},{"id":"fd6719d629a05244","type":"exec","z":"4fd9ba86a4d24d52","command":"/data/data/com.termux/files/home/ySS/shStopService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStopService.sh","x":1050,"y":560,"wires":[[],[],[]]},{"id":"b9a37f186660e6ec","type":"inject","z":"4fd9ba86a4d24d52","name":"off on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":540,"wires":[["fd6719d629a05244"]]},{"id":"43a514d0a4091f2f","type":"exec","z":"4fd9ba86a4d24d52","command":"/data/data/com.termux/files/home/ySS/shStartService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStartService.sh","x":1050,"y":660,"wires":[[],[],[]]},{"id":"6902e5d2415eeb69","type":"inject","z":"4fd9ba86a4d24d52","name":"on on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":640,"wires":[["43a514d0a4091f2f"]]},{"id":"4f65b3a10a1b9d62","type":"mqtt in","z":"4fd9ba86a4d24d52","name":"","topic":"and/orient/pitch","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":220,"y":720,"wires":[["ac1dee125dc69b6c"]]},{"id":"ac1dee125dc69b6c","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"\nj = {\n    \"andPitch\":msg.payload,\n    'timePitch':new Date().getTime()\n};\n\nmsg = {\n    payload:j\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":720,"wires":[["8f68f58cf0c20aea"]]},{"id":"019f32be3e7e2af3","type":"mqtt in","z":"4fd9ba86a4d24d52","name":"","topic":"and/orient/heel","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":220,"y":800,"wires":[["50c0859cb71cc23a"]]},{"id":"50c0859cb71cc23a","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"\n/*\nj = {\"andMag\":{\n    \"data\":msg.payload,\n    \"time\": new Date()\n}};\n*/\nwFAng = flow.get('wFAng')||0;\nandMag = flow.get('andMag')||0;\navg = flow.get('andHeelAvg')||0;\navgB0 = flow.get('andHeelAvgB0')||parseFloat(msg.payload);\ndAvg2 = flow.get(\"dAvg2\")||parseFloat(0);\nsmothBy = 0.02;\nsmothByB0 = 0.01;\nsmothBywFGain = 0.5;\nsmothBydAvg2 = 0.1;\navg = avg*(1-smothBy) + msg.payload*smothBy;\navgB0 = avgB0*(1-smothByB0) + avg*smothByB0;\nwFAnd = wFAng*(1-smothBywFGain) + andMag * smothBywFGain;\ndAvgSrc = ( parseFloat(avg)-parseFloat(avgB0));\ndAvg2 = dAvg2*(1-smothBydAvg2) + dAvgSrc*smothBydAvg2;\n\n\nflow.set('andHeelAvg',avg);\nflow.set('andHeelAvgB0',avgB0);\nflow.set('wFAnd',wFAng);\nflow.set('dAvg2',dAvg2);\n\n//node.status({text:\"dAvgII:\"+dAvg2});\n\nj = {\n    \"andHeel\":msg.payload,\n    'andHeelAvg': avg,\n    'andHeelAvgB0': avgB0,\n    'dAvg': dAvgSrc+\"\",\n    'dAvgII': dAvg2+\"\",\n    'wFAnd': 0,//wFAng,\n    'timeHeel':new Date().getTime()\n};\n\nmsg = {\n    payload:j\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":800,"wires":[["8f68f58cf0c20aea"]]},{"id":"7b73c78b655aab19","type":"inject","z":"4fd9ba86a4d24d52","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":940,"wires":[["7b9a0b157034e429"]]},{"id":"7b9a0b157034e429","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"j = {\n    'fft':[0,1,2],\n    'timefftt':new Date().getTime()\n};\n\n\nreturn {\n    payload:j\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":940,"wires":[[]]},{"id":"bc485eb95396202b","type":"mqtt in","z":"4fd9ba86a4d24d52","name":"","topic":"NR/fft02/top","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":210,"y":860,"wires":[["eababfb1366bf0df"]]},{"id":"cb5292119d7656d3","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"\n/*\nj = {\"andMag\":{\n    \"data\":msg.payload,\n    \"time\": new Date()\n}};\n*/\n//flow.set('fftHis',msg.payload);\n\nj = {\n    \"fftHeel\":JSON.parse(msg.payload),\n    'timeFftHeel': new Date().getTime()\n};\n\nmsg = {\n    payload:JSON.stringify(j)\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":860,"wires":[["eaf2f97e8f0e6c7c"]]},{"id":"eaf2f97e8f0e6c7c","type":"tcp out","z":"4fd9ba86a4d24d52","host":"","port":"11001","beserver":"server","base64":false,"end":true,"name":"","x":590,"y":940,"wires":[]},{"id":"494b029b7eb42d41","type":"debug","z":"4fd9ba86a4d24d52","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":550,"y":1360,"wires":[]},{"id":"eababfb1366bf0df","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"\n\n/*\nnode.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"fft payload: \"+msg.payload\n});\n*/\n\n/*\n[{\n\"series\": [\"A\"],\n\"data\": [\n    [{ \"x\": 1504029632890, \"y\": 5 },\n     { \"x\": 1504029636001, \"y\": 4 },\n     { \"x\": 1504029638656, \"y\": 2 }\n    ]\n],\n\"labels\": [\"\"]\n}]\n*/\nif( 0 ){\n    j = [{\n        \"series\": [\"A\"],\n        \"data\": [\n            []\n        ],\n        \"labels\": [\"\"]\n        }];\n    dIn = JSON.parse(msg.payload);\n    for(var i=0;i<dIn.length;i++){\n        \n        j[0]['data'][0].push( {'x':dIn[i][0], 'y':dIn[i][1]} );\n    }\n}else if( 1 ){\n    /*\n    [{\n    \"series\": [ \"X\" ],\n    \"data\": [ [5,6,9] ],\n    \"labels\": [ \"Jan\", \"Feb\", \"Mar\" ]\n    }]*/\n    j = [{\n        \"series\": [ \"freq / Power\" ],\n        \"xAxisID\": 'custom-x-axis',\n        \"yAxisID\": 'custom-y-axis',\n        \"data\": [ [] ],\n        \"labels\": [\"Hz\"]\n        }];\n    dIn = JSON.parse(msg.payload);\n    var fMax = 0;\n    var pMax = 0;\n    \n    \n    /*\n    ui_control\n    */\n    \n    \n    for(var ii=0;ii<dIn.length;ii++){\n        j[0]['data'][0].push( {\n            x:dIn[ii][0],\n            y:dIn[ii][1] \n            } );\n        if( fMax<dIn[ii][1] ){\n            fMax = dIn[ii][1];\n            pMax = dIn[ii][0];\n        }\n    }\n\n}\n\nuiControl = {\n    options: {\n        legend: {\n            display: true\n        },\n        tooltips: {\n            enabled: true\n        },\n        scales: {\n            xAxes: [{\n                type: 'linear',\n                id: 'custom-x-axis',\n                position:'bottom',\n                \n            }],\n            yAxes: [{\n                id: 'custom-y-axis',\n                \n                \n            }]\n       }\n    }\n};\n\n\nreturn [{\n    payload:\n        j\n        /*[{\n        \"series\": [\"A\"],\n        \"xAxisID\": 'custom-x-axis',\n        \"yAxisID\": 'custom-y-axis',\n        \"data\": [[\n            {x:0.0,y:10},\n            {x:0.5,y:0},\n            {x:0.6,y:5},\n            {x:0.7,y:1}\n            ]],\n        \"labels\": [\"\"]\n    \n    }]*/,\n    ui_control:uiControl\n    \n    },\n    { payload: pMax.toFixed(3)+\"Hz every \"+( 1/pMax ).toFixed(1)+\"sec. \"+fMax.toFixed(2)+\"[P]\" }\n    ];\n    \n    ","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":1300,"wires":[["494b029b7eb42d41","1ae480c440bd4f35"],["d57a6534fce69bf4"],[]]},{"id":"1ae480c440bd4f35","type":"ui_chart","z":"4fd9ba86a4d24d52","name":"","group":"98ce195fe7f2ef28","order":1,"width":"6","height":"7","label":"fft from heel","chartType":"line","legend":"false","xformat":"Hz","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"30","removeOlderPoints":"","removeOlderUnit":"1","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":850,"y":1240,"wires":[[]]},{"id":"d57a6534fce69bf4","type":"ui_text","z":"4fd9ba86a4d24d52","group":"98ce195fe7f2ef28","order":1,"width":0,"height":0,"name":"","label":"Strongest","format":"{{msg.payload}}","layout":"row-spread","className":"","x":840,"y":1280,"wires":[]},{"id":"c89e0ae77ecb5034","type":"ui_chart","z":"4fd9ba86a4d24d52","name":"","group":"98ce195fe7f2ef28","order":1,"width":"6","height":"6","label":"radar tests","chartType":"radar","legend":"false","xformat":"Hz","interpolate":"bezier","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"30","removeOlderPoints":"","removeOlderUnit":"1","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":850,"y":1140,"wires":[[]]},{"id":"f82109daba355e1d","type":"inject","z":"4fd9ba86a4d24d52","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":460,"y":1140,"wires":[["d4bdd197cc717d3c"]]},{"id":"d4bdd197cc717d3c","type":"function","z":"4fd9ba86a4d24d52","name":"","func":"var m = {};\nm.labels = ['0', '15', '30', '45', '60', '75', '90', '105', '120', '135', '150', '165', '180', '195', '210', '225', '240', '255', '270', '285', '300', '315', '330', '345'];\nm.data = [[20, -40, -75, -77, -74, 65, 45, 42, 36, 24, 15, 0, 0, 0, 10, 12, 15, 35, 50, 35, 15, 12, 10, 0]];\nm.series = ['Series A'];\nreturn {\n    payload:[m],\n    topic:\"topic it is\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":1140,"wires":[["c89e0ae77ecb5034"]]},{"id":"5b6a96f862e1acc1","type":"time-inject","z":"59f8c157b9329c7d","name":"","nameInt":"⏲ 06:05 = timestamp","positionConfig":"794897b66b94a457","props":[{"p":"","pt":"msgPayload","v":"","vt":"date","o":"","oT":"none","oM":"60000","f":0,"fS":0,"fT":"UNIX timestamp (ms)","fI":"0","next":true,"days":"*","months":"*","onlyOddDays":false,"onlyEvenDays":false,"onlyOddWeeks":false,"onlyEvenWeeks":false},{"p":"","pt":"msgTopic","v":"","vt":"str","o":"","oT":"none","oM":"60000","f":0,"fS":0,"fT":"UNIX timestamp (ms)","fI":"0","next":false,"days":"*","months":"*","onlyOddDays":false,"onlyEvenDays":false,"onlyOddWeeks":false,"onlyEvenWeeks":false}],"injectTypeSelect":"time","intervalCount":1,"intervalCountType":"num","intervalCountMultiplier":60000,"time":"06:05","timeType":"entered","offset":0,"offsetType":"none","offsetMultiplier":60000,"timeEnd":"","timeEndType":"entered","timeEndOffset":0,"timeEndOffsetType":"none","timeEndOffsetMultiplier":60000,"timeDays":"*","timeOnlyOddDays":false,"timeOnlyEvenDays":false,"timeOnlyOddWeeks":false,"timeOnlyEvenWeeks":false,"timeMonths":"*","timedatestart":"","timedateend":"","property":"","propertyType":"none","propertyCompare":"true","propertyThreshold":"","propertyThresholdType":"num","timeAlt":"","timeAltType":"entered","timeAltDays":"*","timeAltOnlyOddDays":false,"timeAltOnlyEvenDays":false,"timeAltOnlyOddWeeks":false,"timeAltOnlyEvenWeeks":false,"timeAltMonths":"*","timeAltOffset":0,"timeAltOffsetType":"none","timeAltOffsetMultiplier":60000,"once":false,"onceDelay":0.1,"recalcTime":2,"x":160,"y":160,"wires":[["056ce45e3d94f770"]]},{"id":"2e7d403c83a55353","type":"time-inject","z":"59f8c157b9329c7d","name":"","nameInt":"⏲ 16:05 = timestamp","positionConfig":"794897b66b94a457","props":[{"p":"","pt":"msgPayload","v":"","vt":"date","o":"","oT":"none","oM":"60000","f":0,"fS":0,"fT":"UNIX timestamp (ms)","fI":"0","next":true,"days":"*","months":"*","onlyOddDays":false,"onlyEvenDays":false,"onlyOddWeeks":false,"onlyEvenWeeks":false},{"p":"","pt":"msgTopic","v":"","vt":"str","o":"","oT":"none","oM":"60000","f":0,"fS":0,"fT":"UNIX timestamp (ms)","fI":"0","next":false,"days":"*","months":"*","onlyOddDays":false,"onlyEvenDays":false,"onlyOddWeeks":false,"onlyEvenWeeks":false}],"injectTypeSelect":"time","intervalCount":1,"intervalCountType":"num","intervalCountMultiplier":60000,"time":"16:05","timeType":"entered","offset":0,"offsetType":"none","offsetMultiplier":60000,"timeEnd":"","timeEndType":"entered","timeEndOffset":0,"timeEndOffsetType":"none","timeEndOffsetMultiplier":60000,"timeDays":"*","timeOnlyOddDays":false,"timeOnlyEvenDays":false,"timeOnlyOddWeeks":false,"timeOnlyEvenWeeks":false,"timeMonths":"*","timedatestart":"","timedateend":"","property":"","propertyType":"none","propertyCompare":"true","propertyThreshold":"","propertyThresholdType":"num","timeAlt":"","timeAltType":"entered","timeAltDays":"*","timeAltOnlyOddDays":false,"timeAltOnlyEvenDays":false,"timeAltOnlyOddWeeks":false,"timeAltOnlyEvenWeeks":false,"timeAltMonths":"*","timeAltOffset":0,"timeAltOffsetType":"none","timeAltOffsetMultiplier":60000,"once":false,"onceDelay":0.1,"recalcTime":2,"x":160,"y":240,"wires":[["056ce45e3d94f770"]]},{"id":"056ce45e3d94f770","type":"exec","z":"59f8c157b9329c7d","command":"/data/data/com.termux/files/home/pyWindGuru.sh","addpay":"","append":"","useSpawn":"false","timer":"60","winHide":false,"oldrc":false,"name":"pyWindGuru.sh","x":420,"y":280,"wires":[[],[],["0e4ebaef44d7f26e","9e5cf6e3c258eb60"]]},{"id":"517f16be0e7d18a0","type":"inject","z":"59f8c157b9329c7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":60,"wires":[["056ce45e3d94f770"]]},{"id":"0e4ebaef44d7f26e","type":"debug","z":"59f8c157b9329c7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":630,"y":420,"wires":[]},{"id":"9e5cf6e3c258eb60","type":"switch","z":"59f8c157b9329c7d","name":"","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"neq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":300,"wires":[["4f66868f667a6f77"],["b01100aac966fcaa"]]},{"id":"4f66868f667a6f77","type":"function","z":"59f8c157b9329c7d","name":"new weather forecast","func":"msg.status = 'weather';\nmsg.payload = 'new weather forecast available';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":240,"wires":[["6e4e578740e8a34e"]]},{"id":"b01100aac966fcaa","type":"function","z":"59f8c157b9329c7d","name":"new weather forecast","func":"msg.status = 'weather';\nmsg.payload = 'cannot connect to windguru';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":360,"wires":[["6e4e578740e8a34e"]]},{"id":"6e4e578740e8a34e","type":"link out","z":"59f8c157b9329c7d","name":"","mode":"link","links":["0ffa6fe5432288f0"],"x":1065,"y":300,"wires":[]},{"id":"1906e7aa5220053f","type":"inject","z":"59f8c157b9329c7d","name":"radarPanamaCanal","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/5 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":540,"wires":[["429dd01f778c80bb"]]},{"id":"429dd01f778c80bb","type":"http request","z":"59f8c157b9329c7d","name":"","method":"GET","ret":"bin","paytoqs":"ignore","url":"https://radar-meteorologico.delcanal.com/current_image.gif","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":390,"y":620,"wires":[["47d840b097562abb"]]},{"id":"47d840b097562abb","type":"function","z":"59f8c157b9329c7d","name":"","func":"if( msg.payload.length > 1000 ){\n    t = parseInt( Date.now() / 1000 );  \n    \n    node.status({\n        text: \"OK:\"+msg.payload.length\n    });\n    \n    return {\n        fileName: \"pcr_\"+t+\".gif\",\n        entryDate: t,\n        payload: msg.payload,\n        filename: \"/data/data/com.termux/files/usr/var/lib/proot-distro/installed-rootfs/debian/usr/share/grafana/public/prc/pcr_\"+t+\".gif\"\n        \n    };\n}else{\n    node.status({\n        text: \"file error it's to small :(\"\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":620,"wires":[["7b38205253f0674a","11d932ca9be5fc0c"]]},{"id":"7b38205253f0674a","type":"file","z":"59f8c157b9329c7d","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","encoding":"none","x":780,"y":700,"wires":[[]]},{"id":"11d932ca9be5fc0c","type":"function","z":"59f8c157b9329c7d","name":"","func":"if( msg.payload.length > 1000 ){\n    return {\n        topic: \"prc/img\",\n        payload: msg.fileName\n        };\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":620,"wires":[["e4aed3da87a13e66","4c1743b99ea8d816"]]},{"id":"e4aed3da87a13e66","type":"mqtt out","z":"59f8c157b9329c7d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":1070,"y":580,"wires":[]},{"id":"a5bbe4632f6e501e","type":"inject","z":"59f8c157b9329c7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"new img","payloadType":"str","x":1320,"y":600,"wires":[["af111f5be02e3b6b"]]},{"id":"af111f5be02e3b6b","type":"websocket out","z":"59f8c157b9329c7d","name":"","server":"a9d942b1a9429b90","client":"","x":1660,"y":680,"wires":[]},{"id":"facc7bd8e163a42d","type":"function","z":"59f8c157b9329c7d","name":"reload on new img","func":"\nreturn { payload: \"new img\"};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1250,"y":680,"wires":[["af111f5be02e3b6b","3065cb5b76dc1c75"]]},{"id":"4c1743b99ea8d816","type":"delay","z":"59f8c157b9329c7d","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":680,"wires":[["facc7bd8e163a42d"]]},{"id":"88f22ccd478d70ee","type":"status","z":"59f8c157b9329c7d","name":"ws","scope":["af111f5be02e3b6b"],"x":890,"y":800,"wires":[["cd0c297d322a09ff","348be5b9666ef0f8","3065cb5b76dc1c75"]]},{"id":"cd0c297d322a09ff","type":"debug","z":"59f8c157b9329c7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":820,"wires":[]},{"id":"348be5b9666ef0f8","type":"function","z":"59f8c157b9329c7d","name":"","func":"if( msg.status.event == 'connect'){\n    node.status({\n        text:\"uuu connection :)\"\n    });\n    \n    \n    q = `select \n    id,msg,entryDate \n    from topic_prc_img\n    order by entryDate desc\n    limit 100`;\n        \n    msg.topic = q;\n    return msg;\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":860,"wires":[["b49048a604d9fb22"]]},{"id":"b49048a604d9fb22","type":"mysql","z":"59f8c157b9329c7d","mydb":"cbada9e3a1ba45d8","name":"","x":1240,"y":860,"wires":[["61a139ed2f4f8a86"]]},{"id":"61a139ed2f4f8a86","type":"function","z":"59f8c157b9329c7d","name":"","func":"\nvar imgs = [];\nvar imgOne = \"\";\nfor(var i=0;i<msg.payload.length; i++){\n    if( i == 0 )\n        imgOne = msg.payload[i].msg;\n    imgs.push( msg.payload[i].msg );\n}\n\nnode.send({\n    payload: imgs\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":860,"wires":[["af111f5be02e3b6b"]]},{"id":"d425d86b9fc892e7","type":"inject","z":"59f8c157b9329c7d","name":"passageWeather","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1060,"wires":[["f59653076f7a6b09"]]},{"id":"f59653076f7a6b09","type":"http request","z":"59f8c157b9329c7d","name":"","method":"GET","ret":"bin","paytoqs":"ignore","url":"https://www.passageweather.com/maps/caribbean/wind/000.png","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":370,"y":1140,"wires":[["aeb899b33e44396b"]]},{"id":"aeb899b33e44396b","type":"function","z":"59f8c157b9329c7d","name":"","func":"if( msg.payload.length > 1000 ){\n    t = parseInt( Date.now() / 1000 );  \n    \n    node.status({\n        text: \"OK:\"+msg.payload.length\n    });\n    \n    return {\n        fileName: \"pwf_\"+t+\".png\",\n        entryDate: t,\n        payload: msg.payload,\n        filename: \"/data/data/com.termux/files/usr/var/lib/proot-distro/installed-rootfs/debian/usr/share/grafana/public/pwf/pwf_\"+t+\".png\"\n        \n    };\n}else{\n    node.status({\n        text: \"file error it's to small :(\"\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":1140,"wires":[["92a11ddb471a0c90","146fff1c282a1252"]]},{"id":"92a11ddb471a0c90","type":"file","z":"59f8c157b9329c7d","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"false","encoding":"none","x":760,"y":1220,"wires":[[]]},{"id":"146fff1c282a1252","type":"function","z":"59f8c157b9329c7d","name":"","func":"if( msg.payload.length > 1000 ){\n    return {\n        topic: \"pwf/img\",\n        payload: msg.fileName\n        };\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":1140,"wires":[["109f91c54d24b4ba","97a7779fbfdb7de2"]]},{"id":"109f91c54d24b4ba","type":"mqtt out","z":"59f8c157b9329c7d","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":1050,"y":1100,"wires":[]},{"id":"c6fa98487b37474c","type":"inject","z":"59f8c157b9329c7d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"new img","payloadType":"str","x":1300,"y":1120,"wires":[["facc865a583425ab"]]},{"id":"facc865a583425ab","type":"websocket out","z":"59f8c157b9329c7d","name":"","server":"e09abdf33780475f","client":"","x":1500,"y":1200,"wires":[]},{"id":"7024d90a915eab19","type":"function","z":"59f8c157b9329c7d","name":"reload on new img","func":"\nreturn { payload: \"new img\"};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1230,"y":1200,"wires":[["facc865a583425ab","4d0dc42ff1ab3a39"]]},{"id":"97a7779fbfdb7de2","type":"delay","z":"59f8c157b9329c7d","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1060,"y":1200,"wires":[["7024d90a915eab19"]]},{"id":"1f4314019e9dc986","type":"status","z":"59f8c157b9329c7d","name":"ws","scope":["facc865a583425ab"],"x":990,"y":1380,"wires":[["ba7b9480c61a8a8a","d0f2dcd219557315","4d0dc42ff1ab3a39"]]},{"id":"ba7b9480c61a8a8a","type":"debug","z":"59f8c157b9329c7d","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":1380,"wires":[]},{"id":"d0f2dcd219557315","type":"function","z":"59f8c157b9329c7d","name":"","func":"if( msg.status.event == 'connect'){\n    node.status({\n        text:\"uuu connection :)\"\n    });\n    \n    \n    q = `select \n    id,msg,entryDate \n    from topic_pwf_img\n    order by entryDate desc\n    limit 100`;\n        \n    msg.topic = q;\n    return msg;\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":1480,"wires":[["76d0d7522e4c1b08"]]},{"id":"76d0d7522e4c1b08","type":"mysql","z":"59f8c157b9329c7d","mydb":"cbada9e3a1ba45d8","name":"","x":1620,"y":1480,"wires":[["1fa151c27b8af526"]]},{"id":"1fa151c27b8af526","type":"function","z":"59f8c157b9329c7d","name":"","func":"\nvar imgs = [];\nvar imgOne = \"\";\nfor(var i=0;i<msg.payload.length; i++){\n    if( i == 0 )\n        imgOne = msg.payload[i].msg;\n    imgs.push( msg.payload[i].msg );\n}\n\nnode.send({\n    payload: imgs\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1760,"y":1480,"wires":[["facc865a583425ab"]]},{"id":"c1db35c762ab0083","type":"comment","z":"59f8c157b9329c7d","name":"history for panama canal radar","info":"","x":180,"y":480,"wires":[]},{"id":"a081bb74900136bd","type":"comment","z":"59f8c157b9329c7d","name":"history for passafe weather","info":"","x":150,"y":1000,"wires":[]},{"id":"37408585eab8b613","type":"inject","z":"59f8c157b9329c7d","name":"passageWeather","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 06 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1100,"wires":[["f59653076f7a6b09"]]},{"id":"57c64019af3abed0","type":"inject","z":"59f8c157b9329c7d","name":"passageWeather","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 12 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1140,"wires":[["f59653076f7a6b09"]]},{"id":"1b4fb4cc6dfed468","type":"inject","z":"59f8c157b9329c7d","name":"passageWeather","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 18 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1180,"wires":[["f59653076f7a6b09"]]},{"id":"9b49de1543c7a320","type":"inject","z":"59f8c157b9329c7d","name":"","props":[{"p":"payload"},{"p":"url","v":"https://www.youtube.com/watch?v=MqhnHqkaoGI","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":740,"y":60,"wires":[["dd36dc0f4a7e5d4f"]]},{"id":"dd36dc0f4a7e5d4f","type":"exec","z":"59f8c157b9329c7d","command":"/data/data/com.termux/files/home/yd18.sh","addpay":"url","append":"","useSpawn":"false","timer":"6000","winHide":false,"oldrc":false,"name":"yd18.sh","x":900,"y":60,"wires":[["69ae4ee90522155c"],["69ae4ee90522155c"],["69ae4ee90522155c"]]},{"id":"69ae4ee90522155c","type":"debug","z":"59f8c157b9329c7d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1090,"y":80,"wires":[]},{"id":"3065cb5b76dc1c75","type":"function","z":"59f8c157b9329c7d","name":"","func":"/*\nif( msg.status.event == 'connect'){\n    node.status({\n        text:\"uuu connection :)\"\n    });\n    \n    \n    q = `select msg from topic_nex7_gps_ll order by entryDate desc limit 1;`;\n        \n    msg.topic = q;\n    return msg;\n    \n}\n\n*/\nq = `select msg from topic_nex7_gps_ll order by entryDate desc limit 1;`;\n    \nmsg.topic = q;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":920,"wires":[["fd70016c672d9411"]]},{"id":"fd70016c672d9411","type":"mysql","z":"59f8c157b9329c7d","mydb":"cbada9e3a1ba45d8","name":"","x":1240,"y":920,"wires":[["a50f41e7df2856b8"]]},{"id":"a50f41e7df2856b8","type":"function","z":"59f8c157b9329c7d","name":"","func":"\nvar ll = [];\nfor(var i=0;i<msg.payload.length; i++){\n    ll.push( msg.payload[i].msg );\n}\n\nnode.send({\n    payload: {\n        'typeMsg':'msgLocation',\n        'll':ll\n    }\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":920,"wires":[["af111f5be02e3b6b"]]},{"id":"297e33dfb741b5f1","type":"inject","z":"59f8c157b9329c7d","name":"force my location on img","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":830,"y":920,"wires":[["3065cb5b76dc1c75"]]},{"id":"4d0dc42ff1ab3a39","type":"function","z":"59f8c157b9329c7d","name":"","func":"/*\nif( msg.status.event == 'connect'){\n    node.status({\n        text:\"uuu connection :)\"\n    });\n    \n    \n    q = `select msg from topic_nex7_gps_ll order by entryDate desc limit 1;`;\n        \n    msg.topic = q;\n    return msg;\n    \n}\n\n*/\nq = `select msg from topic_nex7_gps_ll order by entryDate desc limit 1;`;\n    \nmsg.topic = q;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":1560,"wires":[["11ca154ef2c1ddd9"]]},{"id":"11ca154ef2c1ddd9","type":"mysql","z":"59f8c157b9329c7d","mydb":"cbada9e3a1ba45d8","name":"","x":1620,"y":1560,"wires":[["a91329f7f5ca278a"]]},{"id":"a91329f7f5ca278a","type":"function","z":"59f8c157b9329c7d","name":"","func":"\nvar ll = [];\nfor(var i=0;i<msg.payload.length; i++){\n    ll.push( msg.payload[i].msg );\n}\n\nnode.send({\n    payload: {\n        'typeMsg':'msgLocation',\n        'll':ll\n    }\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1760,"y":1560,"wires":[["facc865a583425ab"]]},{"id":"0f047041f0b7fdfe","type":"inject","z":"59f8c157b9329c7d","name":"force my location on img","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1210,"y":1560,"wires":[["4d0dc42ff1ab3a39"]]},{"id":"78ea4dfc96d896ef","type":"mqtt in","z":"a0e3ddcae30323e6","name":"e01Mux/adc0","topic":"e01Mux/adc0","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":170,"y":360,"wires":[["100ef967eec92f5a","8810d1382adb55ac"]]},{"id":"8810d1382adb55ac","type":"function","z":"a0e3ddcae30323e6","name":"","func":"batStat = context.get(\"batStat\")||1;\n// 1 - full \n// 2 - normal\n// 3 - low\n// 4 - super low !!\nadc = parseInt(msg.payload);\n\nif( batStat != 1 && adc >= 474 ){\n    context.set(\"batStat\",1);\n    \n    return {\n        'payload':'house battery is full',\n        'status':'info'\n        };\n        \n}else if( batStat < 2 && adc < 468 ){\n    context.set(\"batStat\",2);\n    \n}else if( batStat < 3 && adc < 453 ){\n    context.set(\"batStat\",3);\n    return {\n        'payload':'house battery is low',\n        'status':'info'\n        };\n        \n}else if( adc < 447 ){\n    context.set(\"batStat\",4);\n    return {\n        'payload':'house battery is super low',\n        'status':'alert'\n        };\n    \n}else{\n    a = 0;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":140,"wires":[["1258a0ac1df89dd8","0fe22534f3cb8b13"]]},{"id":"100ef967eec92f5a","type":"debug","z":"a0e3ddcae30323e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":440,"wires":[]},{"id":"1258a0ac1df89dd8","type":"debug","z":"a0e3ddcae30323e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":730,"y":160,"wires":[]},{"id":"98f9342f40abd063","type":"inject","z":"a0e3ddcae30323e6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"440","payloadType":"num","x":170,"y":240,"wires":[["8810d1382adb55ac"]]},{"id":"b730e6093a01bbe5","type":"inject","z":"a0e3ddcae30323e6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"460","payloadType":"num","x":170,"y":160,"wires":[["8810d1382adb55ac"]]},{"id":"89536c29d0c86af9","type":"inject","z":"a0e3ddcae30323e6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"470","payloadType":"num","x":170,"y":120,"wires":[["8810d1382adb55ac"]]},{"id":"c5a6f9f71ee97bd2","type":"inject","z":"a0e3ddcae30323e6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"475","payloadType":"num","x":170,"y":80,"wires":[["8810d1382adb55ac"]]},{"id":"014da7e0df125655","type":"inject","z":"a0e3ddcae30323e6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"450","payloadType":"num","x":170,"y":200,"wires":[["8810d1382adb55ac"]]},{"id":"0fe22534f3cb8b13","type":"link out","z":"a0e3ddcae30323e6","name":"makeNotification","mode":"link","links":["0ffa6fe5432288f0"],"x":705,"y":120,"wires":[]},{"id":"5f63c3cd97686f22","type":"inject","z":"a0e3ddcae30323e6","name":"every 5 min","props":[{"p":"payload"}],"repeat":"300","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":720,"wires":[["abb39290705bc26b","58d2bb56126a4285"]]},{"id":"abb39290705bc26b","type":"termux-battery-status","z":"a0e3ddcae30323e6","name":"","topic":"","x":480,"y":720,"wires":[["c54e89d01ee8d1e1","6845dafc85b79df9","5d87334ac3be6252"]]},{"id":"243c4183146f6ed6","type":"debug","z":"a0e3ddcae30323e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":910,"y":660,"wires":[]},{"id":"c54e89d01ee8d1e1","type":"function","z":"a0e3ddcae30323e6","name":"if < 20 alert if 70 ok","func":"perc = msg.payload.percentage;\nif( perc < 20 ){\n    \n    lowBat = context.get(\"phoneLowBat\")||0;\n    if( lowBat == 0 ){\n        context.set(\"phoneLowBat\", 1);\n        \n        return {\n            'payload':'Phone, huawei, battery is getting low.',\n            'status':'alert'\n            };      \n    }\n} else if( perc > 70 ){\n    context.set(\"phoneLowBat\", 0);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":720,"wires":[["243c4183146f6ed6","dd72bcc4a8e7ff0c"]]},{"id":"6845dafc85b79df9","type":"debug","z":"a0e3ddcae30323e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":780,"wires":[]},{"id":"dd72bcc4a8e7ff0c","type":"link out","z":"a0e3ddcae30323e6","name":"makeNotification","mode":"link","links":["0ffa6fe5432288f0"],"x":855,"y":720,"wires":[]},{"id":"5d87334ac3be6252","type":"function","z":"a0e3ddcae30323e6","name":"raport battery info","func":"node.send({ topic:\"hu/bat/percent\", payload: msg.payload.percentage});\nnode.send({ topic:\"hu/bat/current\", payload: msg.payload.current});\nnode.send({ topic:\"hu/bat/temp\", payload: msg.payload.temperature});\nnode.send({ topic:\"hu/bat/charging\", payload: (( msg.payload.plugged == \"PLUGGED_AC\") ? '1' : '0')});\nnode.send({ topic:\"hu/cpu/percent\", payload: \"0\"});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":880,"wires":[["b5261a3044aa9e87","f257083c3585f3bc"]]},{"id":"b5261a3044aa9e87","type":"debug","z":"a0e3ddcae30323e6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":940,"wires":[]},{"id":"f257083c3585f3bc","type":"mqtt out","z":"a0e3ddcae30323e6","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":920,"y":880,"wires":[]},{"id":"f0d28619d8438460","type":"termux-telephony-cellinfo","z":"a0e3ddcae30323e6","name":"","topic":"","x":470,"y":960,"wires":[["abafb7db3db978ec"]]},{"id":"abafb7db3db978ec","type":"function","z":"a0e3ddcae30323e6","name":"","func":"node.send({\n    topic: \"hu/gsm/sim0/dbm\",\n    payload: msg.payload[0].dbm\n});\nnode.send({\n    topic: \"hu/gsm/sim0/type\",\n    payload: msg.payload[0].type\n});\nnode.send({\n    topic: \"hu/gsm/sim0/registered\",\n    payload: (( msg.payload[0].registered ) ? '1' : '0')\n});\n\nnode.send({\n    topic: \"hu/gsm/sim0/level\",\n    payload: msg.payload[0].level\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":960,"wires":[["f257083c3585f3bc"]]},{"id":"58d2bb56126a4285","type":"delay","z":"a0e3ddcae30323e6","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":300,"y":960,"wires":[["f0d28619d8438460"]]},{"id":"5ea5ee211ac5105e","type":"termux-tts-speak","z":"252ee7ba87c4e484","name":"","topic":"","engine":"","language":"","pitch":"1","rate":"1","stream":"notification","text":"","x":1010,"y":180,"wires":[]},{"id":"6bd727567437e789","type":"within-time-switch","z":"252ee7ba87c4e484","name":"","nameInt":"","positionConfig":"794897b66b94a457","startTime":"07:00","startTimeType":"entered","startOffset":0,"startOffsetType":"none","startOffsetMultiplier":60000,"endTime":"21:00","endTimeType":"entered","endOffset":0,"endOffsetType":"none","endOffsetMultiplier":60000,"timeRestrictions":0,"timeRestrictionsType":"none","timeDays":"*","timeOnlyOddDays":false,"timeOnlyEvenDays":false,"timeOnlyOddWeeks":false,"timeOnlyEvenWeeks":false,"timeMonths":"*","timedatestart":"","timedateend":"","propertyStart":"","propertyStartType":"none","propertyStartCompare":"true","propertyStartThreshold":"","propertyStartThresholdType":"num","startTimeAlt":"","startTimeAltType":"none","startOffsetAlt":0,"startOffsetAltType":"none","startOffsetAltMultiplier":60000,"propertyEnd":"","propertyEndType":"none","propertyEndCompare":"true","propertyEndThreshold":"","propertyEndThresholdType":"num","endTimeAlt":"","endTimeAltType":"none","endOffsetAlt":0,"endOffsetAltType":"none","endOffsetAltMultiplier":60000,"withinTimeValue":"true","withinTimeValueType":"msgInput","outOfTimeValue":"false","outOfTimeValueType":"msgInput","tsCompare":"0","x":470,"y":300,"wires":[["8d29a9418d8bbef8"],[]]},{"id":"1da3c3e57f205d5e","type":"switch","z":"252ee7ba87c4e484","name":"alert overwrite","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"alert","vt":"str"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":340,"y":200,"wires":[["8d29a9418d8bbef8"],["6bd727567437e789"]]},{"id":"5233453e57d1627d","type":"exec","z":"252ee7ba87c4e484","command":"/data/data/com.termux/files/home/playSound.sh","addpay":"mp3","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"play sound","x":790,"y":240,"wires":[[],[],[]]},{"id":"8d29a9418d8bbef8","type":"function","z":"252ee7ba87c4e484","name":"","func":"if( msg.hasOwnProperty('status') ){\n    msg.mp3 = 'relaxing-bell-ding-sound.mp3';\n    if( msg.status == 'alert' )\n        msg.mp3 = 'ahooga-horn.mp3';\n    else if( msg.status == 'weather' )\n        msg.mp3 = '511491_5408716-lq.mp3';\n    \n    \n}else{\n    msg.mp3 = 'bell-rings-short.mp3'; \n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":200,"wires":[["5233453e57d1627d","fb226307b5ce3f99"]]},{"id":"fb226307b5ce3f99","type":"delay","z":"252ee7ba87c4e484","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":780,"y":180,"wires":[["5ea5ee211ac5105e"]]},{"id":"b2db3d45b1af9c8a","type":"inject","z":"252ee7ba87c4e484","name":"select","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"select * from todolist where id>:id;","payload":"{'id':'10'}","payloadType":"jsonata","x":290,"y":460,"wires":[["235adf39d2d4f472"]]},{"id":"ae0b2392af3f696a","type":"debug","z":"252ee7ba87c4e484","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":810,"y":460,"wires":[]},{"id":"647fa5e7e8adb8e3","type":"comment","z":"252ee7ba87c4e484","name":"create table","info":"CREATE TABLE `nrNotifications` (     \n    `id` int(11) NOT NULL AUTO_INCREMENT,          \n    `status` varchar(255) COLLATE utf8_bin NOT NULL,     \n    `sentence` varchar(255) COLLATE utf8_bin NOT NULL,          \n    `entryDate` int(11) NOT NULL,     \n    PRIMARY KEY (`id`) \n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin AUTO_INCREMENT=1;","x":490,"y":480,"wires":[]},{"id":"15059cebc8f63d0e","type":"function","z":"252ee7ba87c4e484","name":"","func":"entryDate = Math.floor(Date.now() / 1000);\ntr = {};\ntr['topic'] = 'insert into nrNotifications \\\n    (status, sentence,entryDate) VALUES \\\n    (:status,:sentence,:entryDate)';\n    \nstatus = 'info';\nif( msg.hasOwnProperty('status') )\n    status = msg.status;\n    \ntr['payload'] = {\n    'status':   status,\n    'sentence': msg.payload,\n    'entryDate':    entryDate\n};\n\nreturn tr;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":540,"wires":[["0b80bd3b01bb2a18","235adf39d2d4f472"]]},{"id":"f73d531802f11610","type":"inject","z":"252ee7ba87c4e484","name":"select","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"select * from todolist where id>:id;","payload":"{'id':'10'}","payloadType":"jsonata","x":290,"y":600,"wires":[["235adf39d2d4f472"]]},{"id":"0b80bd3b01bb2a18","type":"debug","z":"252ee7ba87c4e484","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":490,"y":640,"wires":[]},{"id":"0d36399fb0f6c102","type":"inject","z":"252ee7ba87c4e484","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":80,"wires":[["1da3c3e57f205d5e","15059cebc8f63d0e"]]},{"id":"0ffa6fe5432288f0","type":"link in","z":"252ee7ba87c4e484","name":"makeNotification","links":["85d524c5e306d42e","de491fd6264c7809","6e4e578740e8a34e","0fe22534f3cb8b13","dd72bcc4a8e7ff0c"],"x":115,"y":200,"wires":[["1da3c3e57f205d5e","15059cebc8f63d0e"]]},{"id":"235adf39d2d4f472","type":"mysql","z":"252ee7ba87c4e484","mydb":"cbada9e3a1ba45d8","name":"mysqlAtHu","x":530,"y":540,"wires":[["ae0b2392af3f696a"]]},{"id":"c912ccbd424745b3","type":"inject","z":"0a5e45f66bde827b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"9.613203 -79.584372","payloadType":"str","x":200,"y":300,"wires":[["6eb88a2af43d2681"]]},{"id":"166115fce950c9f5","type":"debug","z":"0a5e45f66bde827b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":320,"wires":[]},{"id":"6eb88a2af43d2681","type":"function","z":"0a5e45f66bde827b","name":"","func":"sendIt = false;\n\nif( msg.topic == 'and/lat' ){\n    flow.set(\"and_lat\", msg.payload);\n    \n}else if( msg.topic == 'and/lon' ){\n    msg.payload = flow.get(\"and_lat\")+\" \"+\n        msg.payload;\n    \n    node.status({text:\"ll from and/[lat lon]\"});\n    \n    sendIt = true;\n}else{\n    node.status({text:\"ll from huGps/ll\"});\n    sendIt = true;\n}\n\n\nif( sendIt ){\n    sp = msg.payload.split(\" \");\n    \n    function toDegreesMinutesAndSeconds(coordinate) {\n        deg = Math.abs(coordinate);\n        //console.log(deg);\n        t = String(deg).split(\".\");\n        //console.log(t);\n        \n        return (parseInt(t[0])*100) + (parseFloat(\"0.\"+t[1])*60) ;\n    }\n    \n    \n    lat = toDegreesMinutesAndSeconds(sp[0]);\n    if( parseInt(sp[0])>=0.0 )\n        latNS = 'N';\n    else \n        latNS = 'S';\n        \n    lon = toDegreesMinutesAndSeconds(sp[1]);\n    if( parseInt(sp[1])<=0.0 )\n        lonWE = 'W';\n    else \n        lonWE = 'E';\n        \n    \n    nrrmc = '$NRRMC,,A,'+lat+','+latNS+\n        ','+lon+','+lonWE+',,,,,,A\\r\\n';\n        \n    flow.set(\"nrrmc\",nrrmc);\n    \n    //$YKRMC,,A,0936.770489,N,07935.157794,W,4.75,82.88,,,,A\n    return {\n        'payload': nrrmc\n        \n        };\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":380,"wires":[["63ed976524ed6b39","e2fc1387f6dc6947"]]},{"id":"4b92b38744029ff1","type":"mqtt in","z":"0a5e45f66bde827b","name":"huGps/gps/ll","topic":"huGps/gps/ll","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":230,"y":340,"wires":[["166115fce950c9f5","6eb88a2af43d2681"]]},{"id":"63ed976524ed6b39","type":"debug","z":"0a5e45f66bde827b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":500,"wires":[]},{"id":"e2fc1387f6dc6947","type":"tcp out","z":"0a5e45f66bde827b","host":"","port":"11226","beserver":"server","base64":false,"end":false,"name":"nmea at :11226","x":900,"y":560,"wires":[]},{"id":"0a42d0450e12c84d","type":"inject","z":"0a5e45f66bde827b","name":"resend rmc to not time out opencpn","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"str","x":190,"y":240,"wires":[["267116a856ee7e1c"]]},{"id":"267116a856ee7e1c","type":"function","z":"0a5e45f66bde827b","name":"","func":"\nreturn {\n    'payload': '\\r\\n'+( flow.get(\"nrrmc\")||\"\" )\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":240,"wires":[["e2fc1387f6dc6947"]]},{"id":"dbabdf5f773cc32c","type":"mqtt in","z":"0a5e45f66bde827b","d":true,"name":"and/mag","topic":"and/mag","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":120,"y":1080,"wires":[["5d0fe4fae2ac10fd","4a7e5a9883632c24","a5255a3e829242d3"]]},{"id":"5d0fe4fae2ac10fd","type":"function","z":"0a5e45f66bde827b","name":"","func":"nrhdg = '$NRHDM,'+parseInt(msg.payload)+',M\\r\\n';//'$NRHDM,'+parseInt(msg.payload)+',W,0,E\\r\\n';\n\nnode.status({\n        fill:'blue',\n        shape: 'ring',\n        text:\"HDM: \"+parseInt(msg.payload)\n    });\n\nreturn {\n    'payload': nrhdg\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":1080,"wires":[["77b0ba9e165fb120"]]},{"id":"77b0ba9e165fb120","type":"tcp out","z":"0a5e45f66bde827b","host":"","port":"11227","beserver":"server","base64":false,"end":false,"name":"","x":760,"y":1000,"wires":[]},{"id":"59402290bdc70bf6","type":"inject","z":"0a5e45f66bde827b","name":"gps ask every 5 min","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":80,"wires":[["131a7d6c41272ddd"]]},{"id":"131a7d6c41272ddd","type":"exec","z":"0a5e45f66bde827b","command":"/data/data/com.termux/files/home/sPyGps2Mqtt.sh","addpay":"","append":"","useSpawn":"true","timer":"","winHide":false,"oldrc":false,"name":"sPyGps2Mqtt","x":1040,"y":80,"wires":[["ea08e2064dc700cb","02a14b2cc8bd322b"],[],[]]},{"id":"ea08e2064dc700cb","type":"debug","z":"0a5e45f66bde827b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1330,"y":40,"wires":[]},{"id":"56f010e8eaa787ce","type":"termux-location","z":"0a5e45f66bde827b","name":"","topic":"","provider":"gps","request":"once","x":1360,"y":260,"wires":[["8ae7d262a9f7c0bd"]]},{"id":"8ae7d262a9f7c0bd","type":"debug","z":"0a5e45f66bde827b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1490,"y":260,"wires":[]},{"id":"ac7a85472ada0179","type":"delay","z":"0a5e45f66bde827b","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1200,"y":260,"wires":[["56f010e8eaa787ce"]]},{"id":"05a895677365a9d0","type":"function","z":"0a5e45f66bde827b","name":"","func":"//$YKXDR,A,%s,,PTCH,A,%s,,ROLL,\nif( msg.pitch && msg.heel ){\n    pitch = msg.pitch;\n    heel = msg.heel;\n    \n    node.status({\n        fill:'blue',\n        shape: 'ring',\n        text:\"he: \"+heel+\" pi: \"+pitch\n    });\n    return {\n        payload: \"$NRXDR,A,\"+pitch+\n            \",,PTCH,A,\"+heel+\n            \",,ROLL,\\r\\n\"\n        };\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":1520,"wires":[["77b0ba9e165fb120"]]},{"id":"0b5cd6d2614e7882","type":"mqtt in","z":"0a5e45f66bde827b","d":true,"name":"and/accel","topic":"and/accel","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":380,"y":1540,"wires":[["f52957cb9d037acf","abb1d040cca7e29d"]]},{"id":"f52957cb9d037acf","type":"debug","z":"0a5e45f66bde827b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":610,"y":1660,"wires":[]},{"id":"abb1d040cca7e29d","type":"function","z":"0a5e45f66bde827b","name":"","func":"vs = msg.payload.split(\",\");\n\nsensor = \"flat\";\nmPitch = 1;\nmHeel = 1;\n\nvMin = 0.0;\nvOrient = \"\";\nif( vs[0] > vMin ){\n    vMin = vs[0];\n    vOrient = \"landscape\";\n}\nif( vs[1] > vMin ){\n    vMin = vs[1];\n    vOrient = \"portret\";\n}\nif( vs[2] > vMin ){\n    vMin = vs[2];\n    vOrient = \"flat\";\n}\n\nsensor = vOrient;\n\nif( sensor == \"landscape\" ){\n    aDown = 0;\n    aPitch = 2;\n    aHeel = 1;\n}else if( sensor == \"portret\"){\n    aDown = 1;\n    aPitch = 2;\n    aHeel = 0;\n    \n    mHeel = -1;\n    \n}else if( sensor == \"flat\"){\n    aDown = 2;\n    aPitch = 1;\n    aHeel = 0;\n    \n    mPitch = -1;\n    mHeel = -1;\n}\n\nz = parseFloat( vs[ aDown ] );\nx = parseFloat( vs[ aPitch ] );\ny = parseFloat( vs[ aHeel ] ); \n\nheel = Math.atan2(y , z) * 57.3 * mHeel;\npitch = Math.atan2((- x) , Math.sqrt(y * y + z * z)) * 57.3 * mPitch;\n\n\nnode.status({\n        fill:'blue',\n        shape: 'ring',\n        text:\"sen: \"+sensor+\" he: \"+heel.toFixed(2)+\" pi: \"+pitch.toFixed(2)\n    });\n    \nreturn {\n    heel: heel.toFixed(2),\n    pitch: pitch.toFixed(2)\n};\n    \n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":1580,"wires":[["4340f4c450d883db","05a895677365a9d0"]]},{"id":"4340f4c450d883db","type":"link out","z":"0a5e45f66bde827b","name":"orient heel and pitch","mode":"link","links":["cb1beed861f5ef04"],"x":855,"y":1540,"wires":[]},{"id":"a9d5487c17f70192","type":"tcp in","z":"0a5e45f66bde827b","d":true,"name":"from_ySS","server":"server","host":"","port":"19888","datamode":"stream","datatype":"utf8","newline":"\\n","topic":"","base64":false,"x":1290,"y":380,"wires":[["a0ede6e1def05f0b","f83ca69c4e767f39"]]},{"id":"a0ede6e1def05f0b","type":"debug","z":"0a5e45f66bde827b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1470,"y":380,"wires":[]},{"id":"a1d5de102ba9c987","type":"mqtt out","z":"0a5e45f66bde827b","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":1670,"y":400,"wires":[]},{"id":"f83ca69c4e767f39","type":"function","z":"0a5e45f66bde827b","name":"","func":"divPos = msg.payload.indexOf(\":{\");\nt = msg.payload.substring(0, divPos );\nm = msg.payload.substring(divPos+2, msg.payload.length-1);\n\nif( 0 ){\n    node.status({\n        text: \"t:\"+t+\" m:\"+m\n    });\n}\n\nreturn {\n  topic: \"and/\"+t,\n  payload: m\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1440,"y":460,"wires":[["a1d5de102ba9c987"]]},{"id":"502bf5b82c4885dd","type":"mqtt in","z":"0a5e45f66bde827b","d":true,"name":"","topic":"e01Mux/C","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":660,"y":1340,"wires":[["0bf39f857f5593d2"]]},{"id":"0bf39f857f5593d2","type":"function","z":"0a5e45f66bde827b","name":"to TempAir","func":"//$IIXDR,C,19.52,C,TempAir*19\nnode.status({\n   text:\"temp:\"+msg.payload+\"`C\" \n});\nreturn {payload:\"$NRXDR,C,\"+msg.payload+\",C,TempAir,\\r\\n\"};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":830,"y":1340,"wires":[["77b0ba9e165fb120"]]},{"id":"b2989716127d048c","type":"link in","z":"0a5e45f66bde827b","name":"","links":["6e19cb88f94939f1"],"x":155,"y":1180,"wires":[["4a7e5a9883632c24"]]},{"id":"4a7e5a9883632c24","type":"function","z":"0a5e45f66bde827b","name":"","func":"if( msg.topic == \"NR/windEffordAng\" ){\n    wea = parseInt( msg.payload );\n    node.status({\n        text:\"windFrom:\"+wea\n        \n    });\n    flow.set(\"windEffordAngle\",wea);\n    \n}\n\nif( msg.topic == \"and/mag\" ){\n    wea = parseInt(flow.get(\"windEffordAngle\")||-1);\n    if( wea >= 0 ){\n        \n        \n        \n        relWindAng = wea - parseInt( msg.payload );\n        if( relWindAng < 0 )\n            relWindAng+= 360.0;\n        \n        node.status({\n            text:\"windFrom:\"+relWindAng\n            \n        });\n        \n        node.send({\n            payload: \"$NRMWV,\"+relWindAng+\".0,R,,K,A\\r\\n\"\n            //payload: \"$NRVWR,\"+relWindAng+\".0,Right,0.0,N,0.0,M,0.0,K,\\r\\n\"\n            //payload: \"$NRMWV,\"+relWindAng+\".0,A,0.0,K,V,\\r\\n\"\n            //payload: \"$NRMWV,\"+relWindAng+\".0,R,0.0,\\r\\n\"\n        });\n        \n        \n        \n    }\n    \n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":1160,"wires":[[]]},{"id":"a5096c1b39d76b38","type":"inject","z":"0a5e45f66bde827b","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"NR/windEffordAng","payload":"10","payloadType":"str","x":120,"y":1140,"wires":[["4a7e5a9883632c24"]]},{"id":"d4448a0a456725b2","type":"mqtt in","z":"0a5e45f66bde827b","d":true,"name":"","topic":"cIMU/windComs","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":100,"y":1260,"wires":[["a5255a3e829242d3"]]},{"id":"a5255a3e829242d3","type":"function","z":"0a5e45f66bde827b","name":"","func":"if( msg.topic == \"cIMU/windComs\" ){\n    wea = parseInt( msg.payload );\n    flow.set(\"windComs\",wea);\n    \n}\n\nif( msg.topic == \"and/mag\" ){\n    wea = parseInt(flow.get(\"windComs\")||-1);\n    if( wea >= 0 ){\n        \n        \n        \n        relWindAng = wea - parseInt( msg.payload );\n        if( relWindAng < 0 )\n            relWindAng+= 360.0;\n        \n        node.status({\n            text:\"windFrom:\"+relWindAng\n            \n        });\n        \n        node.send({\n            payload: \"$NRMWV,\"+relWindAng+\".0,R,,K,A\\r\\n\"\n            //payload: \"$NRVWR,\"+relWindAng+\".0,Right,0.0,N,0.0,M,0.0,K,\\r\\n\"\n            //payload: \"$NRMWV,\"+relWindAng+\".0,A,0.0,K,V,\\r\\n\"\n            //payload: \"$NRMWV,\"+relWindAng+\".0,R,0.0,\\r\\n\"\n        });\n        \n        \n        \n    }\n    \n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":280,"y":1240,"wires":[["77b0ba9e165fb120"]]},{"id":"e30deb1ea1fad329","type":"function","z":"0a5e45f66bde827b","name":"","func":"\n\nnrhdg = '$NRHDM,'+parseInt(msg.payload)+',M\\r\\n';\n//'$NRHDM,'+parseInt(msg.payload)+',W,0,E\\r\\n';\n\nnode.status({\n        fill:'blue',\n        shape: 'ring',\n        text:\"HDM: \"+parseInt(msg.payload)\n    });\n\nreturn {'payload': nrhdg };","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":860,"wires":[["e2fc1387f6dc6947"]]},{"id":"c85213b89730275b","type":"mqtt in","z":"0a5e45f66bde827b","name":"and/mag","topic":"and/mag","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":160,"y":860,"wires":[["e30deb1ea1fad329"]]},{"id":"370f354bc0ae17ea","type":"status","z":"0a5e45f66bde827b","name":"","scope":["e2fc1387f6dc6947"],"x":920,"y":620,"wires":[["d72c7ff305d06eee"]]},{"id":"7620f8ec8c0a801b","type":"mqtt in","z":"0a5e45f66bde827b","name":"and/lat","topic":"and/lat","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":250,"y":460,"wires":[["6eb88a2af43d2681"]]},{"id":"2e1fa7080199cdd4","type":"mqtt in","z":"0a5e45f66bde827b","name":"and/lon","topic":"and/lon","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":250,"y":500,"wires":[["6eb88a2af43d2681"]]},{"id":"caa9ff1e9f59bcaa","type":"inject","z":"0a5e45f66bde827b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1200,"y":300,"wires":[["56f010e8eaa787ce"]]},{"id":"d72c7ff305d06eee","type":"link out","z":"0a5e45f66bde827b","name":"","mode":"link","links":["52f734b330961380"],"x":1035,"y":620,"wires":[]},{"id":"596cea9df4804f02","type":"function","z":"0a5e45f66bde827b","name":"","func":"//$YKXDR,A,%s,,PTCH,A,%s,,ROLL,\nreturn {\n    payload: \"$NRXDR,A,\"+pitch+\n        \",,PTCH,\\r\\n\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":1340,"wires":[["77b0ba9e165fb120"]]},{"id":"0e10943f01216d1b","type":"mqtt in","z":"0a5e45f66bde827b","d":true,"name":"and/accel","topic":"and/orient/pitch","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":160,"y":1340,"wires":[["596cea9df4804f02"]]},{"id":"9e7b97c3239be01f","type":"mqtt in","z":"0a5e45f66bde827b","name":"","topic":"e01Mux/C","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":160,"y":800,"wires":[["04012f0ee9b535fa"]]},{"id":"04012f0ee9b535fa","type":"function","z":"0a5e45f66bde827b","name":"to TempAir","func":"//$IIXDR,C,19.52,C,TempAir*19\nnode.status({\n   text:\"temp:\"+msg.payload+\"`C\" \n});\nreturn {payload:\"$NRXDR,C,\"+msg.payload+\",C,TempAir,\\r\\n\"};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":800,"wires":[["e2fc1387f6dc6947"]]},{"id":"12434ed4b13b315d","type":"function","z":"0a5e45f66bde827b","name":"","func":"//$YKXDR,A,%s,,PTCH,A,%s,,ROLL,\nif( msg.topic == 'and/orient/pitch'){\n    flow.set(\"andOrientPitch\",msg.payload);\n\n    \n}else{\n    p = parseFloat(flow.get('andOrientPitch')||0).toFixed(2);\n    h = parseFloat(msg.payload).toFixed(2);\n    \n    node.status({\n        text: 'P:'+p+' H:'+h\n    });\n    \n    return {\n        payload: \"$NRXDR,A,\"+p+\n                \",,PTCH,A,\"+h+\n                \",,ROLL,\\r\\n\"\n    };\n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":700,"wires":[["e2fc1387f6dc6947"]]},{"id":"898f2ea4d72044e3","type":"mqtt in","z":"0a5e45f66bde827b","name":"and/orient/pitch","topic":"and/orient/pitch","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":180,"y":680,"wires":[["12434ed4b13b315d"]]},{"id":"f96f00c24a755a58","type":"mqtt in","z":"0a5e45f66bde827b","name":"and/orient/pitch","topic":"and/orient/heel","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":180,"y":740,"wires":[["12434ed4b13b315d"]]},{"id":"23ad5f3e9e9a307c","type":"mqtt in","z":"0a5e45f66bde827b","name":"nex7/gps/ll","topic":"nex7/gps/ll","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":220,"y":400,"wires":[["6eb88a2af43d2681"]]},{"id":"3d83af6066816f03","type":"comment","z":"0a5e45f66bde827b","name":"","info":"test 000xy","x":1430,"y":580,"wires":[]},{"id":"02a14b2cc8bd322b","type":"function","z":"0a5e45f66bde827b","name":"chk if error geting gps","func":"if( msg.payload.indexOf('no gps location') != -1 ){\n    node.status({text: 'no gps location :('});\n    return { mp3: 'error11.mp3' };\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1600,"y":120,"wires":[["b50b55f87beb887f","5187358c0d80bc95"]]},{"id":"b50b55f87beb887f","type":"exec","z":"0a5e45f66bde827b","d":true,"command":"/data/data/com.termux/files/home/playSound.sh","addpay":"mp3","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"play sound","x":1810,"y":120,"wires":[[],[],[]]},{"id":"f3cc96ee29eb5d27","type":"inject","z":"0a5e45f66bde827b","name":"","props":[{"p":"payload"},{"p":"mp3","v":"error11","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"no gps location","payloadType":"str","x":1600,"y":60,"wires":[["02a14b2cc8bd322b"]]},{"id":"5187358c0d80bc95","type":"exec","z":"0a5e45f66bde827b","d":true,"command":"/data/data/com.termux/files/home/ySS/shDisplayOn.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shDisplayOn.sh","x":1820,"y":180,"wires":[[],[],[]]},{"id":"2e7cd96147602d61","type":"inject","z":"0a5e45f66bde827b","name":"send ais1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"!AIVDM,1,1,,A,100000OP00rCcFj5Oviv4?vt0000,0*5C","payloadType":"str","x":860,"y":340,"wires":[["e2fc1387f6dc6947"]]},{"id":"95b00ce258473188","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"and/mag","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":100,"y":280,"wires":[["680f0d5e5ffd775d","9a8e40f9223b6ec8","d63721fe89812e17","e59b0cee687234a6"]]},{"id":"680f0d5e5ffd775d","type":"function","z":"744d808088e3adef","name":"","func":"\nnode.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"HDG:\"+parseInt(msg.payload)\n});\n\nreturn {\n    payload: parseInt(msg.payload)\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":280,"wires":[["7d4dbc91ace738ca","849dc998303344bd"]]},{"id":"9a8e40f9223b6ec8","type":"debug","z":"744d808088e3adef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":350,"y":380,"wires":[]},{"id":"d017b95f95ab20bc","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"and/orient/pitch","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":120,"y":480,"wires":[["f4935b7fb7572017","9b6aa95a5bb5b978"]]},{"id":"f4935b7fb7572017","type":"function","z":"744d808088e3adef","name":"","func":"\nnode.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"pitch:\"+parseInt(msg.payload)\n});\n\nreturn {\n    payload: parseInt(msg.payload)\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":480,"wires":[["2de2e16eb16a51bf","8c4481a881ec7479"]]},{"id":"9b6aa95a5bb5b978","type":"debug","z":"744d808088e3adef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":340,"y":580,"wires":[]},{"id":"a1967ecd22c73be8","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"and/orient/heel","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":80,"y":720,"wires":[["b350da50d2a4267a","e1a0a7e45a2f45ab","e59b0cee687234a6"]]},{"id":"b350da50d2a4267a","type":"function","z":"744d808088e3adef","name":"","func":"\nnode.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"heel:\"+parseInt(msg.payload)\n});\n\nreturn {\n    payload: parseInt(msg.payload)\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":660,"wires":[["5bf50b8a48749e8b","af4fe59e77e753ae"]]},{"id":"e1a0a7e45a2f45ab","type":"debug","z":"744d808088e3adef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":340,"y":760,"wires":[]},{"id":"7d4dbc91ace738ca","type":"ui_numeric","z":"744d808088e3adef","name":"hdg","label":"hdg","tooltip":"","group":"7d18e7f1f3d5bd09","order":2,"width":"1","height":"1","wrap":false,"passthru":true,"topic":"topic","topicType":"msg","format":"{{value}}","min":0,"max":10,"step":1,"className":"","x":510,"y":320,"wires":[[]]},{"id":"2de2e16eb16a51bf","type":"ui_numeric","z":"744d808088e3adef","name":"pitch","label":"pitch","tooltip":"","group":"00ebcb1b054ce52e","order":2,"width":"1","height":"1","wrap":false,"passthru":true,"topic":"topic","topicType":"msg","format":"{{value}}","min":0,"max":10,"step":1,"className":"","x":510,"y":520,"wires":[[]]},{"id":"5bf50b8a48749e8b","type":"ui_numeric","z":"744d808088e3adef","name":"heel","label":"heel","tooltip":"","group":"5c5c3a36c2a64fdb","order":2,"width":"1","height":"1","wrap":false,"passthru":true,"topic":"topic","topicType":"msg","format":"{{value}}","min":0,"max":10,"step":1,"className":"","x":510,"y":700,"wires":[[]]},{"id":"af4fe59e77e753ae","type":"ui_chart","z":"744d808088e3adef","name":"heel","group":"5c5c3a36c2a64fdb","order":1,"width":"4","height":"3","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":500,"y":660,"wires":[[]]},{"id":"8c4481a881ec7479","type":"ui_chart","z":"744d808088e3adef","name":"pitch","group":"00ebcb1b054ce52e","order":1,"width":"4","height":"3","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":500,"y":480,"wires":[[]]},{"id":"849dc998303344bd","type":"ui_chart","z":"744d808088e3adef","name":"hdg","group":"7d18e7f1f3d5bd09","order":1,"width":"4","height":"3","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"2","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":510,"y":280,"wires":[[]]},{"id":"ffc95bb7e3e3c613","type":"ui_svg_graphics","z":"744d808088e3adef","group":"5c5c3a36c2a64fdb","order":3,"width":0,"height":0,"svgString":"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<!-- Created with Inkscape (http://www.inkscape.org/) -->\n\n<svg\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n   xmlns:cc=\"http://creativecommons.org/ns#\"\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n   width=\"300\"\n   height=\"100\"\n   viewBox=\"0 0 300 100\"\n   version=\"1.1\"\n   id=\"svg8\"\n   inkscape:version=\"0.92.5 (2060ec1f9f, 2020-04-08)\"\n   sodipodi:docname=\"100x100heelPitchG.svg\">\n  <defs\n     id=\"defs2\">\n    <marker\n       inkscape:stockid=\"Arrow1Lend\"\n       orient=\"auto\"\n       refY=\"0.0\"\n       refX=\"0.0\"\n       id=\"marker1752\"\n       style=\"overflow:visible;\"\n       inkscape:isstock=\"true\">\n      <path\n         id=\"path1750\"\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\n         style=\"fill-rule:evenodd;stroke:#f70000;stroke-width:1pt;stroke-opacity:1;fill:#f70000;fill-opacity:1\"\n         transform=\"scale(0.8) rotate(180) translate(12.5,0)\" />\n    </marker>\n    <marker\n       inkscape:stockid=\"Arrow1Lend\"\n       orient=\"auto\"\n       refY=\"0.0\"\n       refX=\"0.0\"\n       id=\"Arrow1Lend\"\n       style=\"overflow:visible;\"\n       inkscape:isstock=\"true\">\n      <path\n         id=\"path839\"\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\n         style=\"fill-rule:evenodd;stroke:#00ff00;stroke-width:1pt;stroke-opacity:1;fill:#00ff00;fill-opacity:1\"\n         transform=\"scale(0.8) rotate(180) translate(12.5,0)\" />\n    </marker>\n    <marker\n       inkscape:stockid=\"Arrow1Lstart\"\n       orient=\"auto\"\n       refY=\"0.0\"\n       refX=\"0.0\"\n       id=\"Arrow1Lstart\"\n       style=\"overflow:visible\"\n       inkscape:isstock=\"true\">\n      <path\n         id=\"path836\"\n         d=\"M 0.0,0.0 L 5.0,-5.0 L -12.5,0.0 L 5.0,5.0 L 0.0,0.0 z \"\n         style=\"fill-rule:evenodd;stroke:#00ff00;stroke-width:1pt;stroke-opacity:1;fill:#00ff00;fill-opacity:1\"\n         transform=\"scale(0.8) translate(12.5,0)\" />\n    </marker>\n  </defs>\n  <sodipodi:namedview\n     id=\"base\"\n     pagecolor=\"#ffffff\"\n     bordercolor=\"#666666\"\n     borderopacity=\"1.0\"\n     inkscape:pageopacity=\"0.0\"\n     inkscape:pageshadow=\"2\"\n     inkscape:zoom=\"1.979899\"\n     inkscape:cx=\"113.50804\"\n     inkscape:cy=\"70.157241\"\n     inkscape:document-units=\"px\"\n     inkscape:current-layer=\"svg8\"\n     showgrid=\"false\"\n     inkscape:window-width=\"1366\"\n     inkscape:window-height=\"704\"\n     inkscape:window-x=\"0\"\n     inkscape:window-y=\"27\"\n     inkscape:window-maximized=\"1\"\n     units=\"px\"\n     inkscape:pagecheckerboard=\"true\"\n     showguides=\"true\" />\n  <metadata\n     id=\"metadata5\">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about=\"\">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n        <dc:title />\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <g\n     id=\"g5187\"\n     transform=\"matrix(4.5075429,0,0,4.5075429,149.20597,-55.99207)\">\n    <path\n       sodipodi:nodetypes=\"csscc\"\n       inkscape:connector-curvature=\"0\"\n       id=\"path5174\"\n       d=\"M 29.546962,0.75251269 C 29.546962,11.261749 23.917524,20.965769 14.794579,26.182658 5.6716343,31.399547 -5.5468201,31.32987 -14.60426,26.000064 -23.6617,20.670258 -29.170166,10.89706 -29.039626,0.38863414 c 19.5276143,0.3877438 39.05647,0.36387855 58.586588,0.36387855 z\"\n       style=\"opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:5;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\n    <path\n       inkscape:label=\"#path5177\"\n       inkscape:connector-curvature=\"0\"\n       id=\"niddleB\"\n       d=\"M 0,23.733483 V 36.36039\"\n       style=\"fill:none;stroke:#0000ff;stroke-width:5;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\n    <path\n       inkscape:transform-center-y=\"29.940158\"\n       inkscape:transform-center-x=\"2.1759812\"\n       inkscape:label=\"#path5179\"\n       inkscape:connector-curvature=\"0\"\n       id=\"niddleR\"\n       d=\"M 0.07923227,27.536632 0,36.36039\"\n       style=\"fill:none;fill-opacity:1;stroke:#f70000;stroke-width:0.33787809;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-start:url(#marker1752)\"\n       sodipodi:nodetypes=\"cc\" />\n    <path\n       inkscape:transform-center-y=\"29.391947\"\n       inkscape:transform-center-x=\"0.12847272\"\n       inkscape:label=\"#path5181\"\n       inkscape:connector-curvature=\"0\"\n       id=\"niddleG\"\n       d=\"M 0.07923227,27.536632 0,36.36039\"\n       style=\"fill:none;fill-opacity:1;stroke:#00ff00;stroke-width:0.31569305;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-start:url(#Arrow1Lend)\"\n       sodipodi:nodetypes=\"cc\" />\n  </g>\n  <text\n     xml:space=\"preserve\"\n     style=\"font-style:normal;font-weight:normal;font-size:66.91195679px;line-height:1.25;font-family:sans-serif;text-align:center;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#f2f2f2;fill-opacity:1;stroke:none;stroke-width:1.67279899\"\n     x=\"150.72325\"\n     y=\"45.333214\"\n     id=\"textAtSvg\"\n     inkscape:label=\"#text826\"><tspan\n       sodipodi:role=\"line\"\n       id=\"tspan824\"\n       x=\"150.72325\"\n       y=\"45.333214\"\n       style=\"text-align:center;text-anchor:middle;fill:#f2f2f2;stroke-width:1.67279899\"></tspan></text>\n  <text\n     xml:space=\"preserve\"\n     style=\"font-style:normal;font-weight:normal;font-size:27.49344254px;line-height:1.25;font-family:sans-serif;text-align:center;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#f2f2f2;fill-opacity:1;stroke:none;stroke-width:0.68733609\"\n     x=\"40.675816\"\n     y=\"85.078018\"\n     id=\"textAtSvgMax\"\n     inkscape:label=\"#text826\"><tspan\n       sodipodi:role=\"line\"\n       id=\"tspan824-6\"\n       x=\"40.675816\"\n       y=\"85.078018\"\n       style=\"text-align:center;text-anchor:middle;fill:#f2f2f2;stroke-width:0.68733609\"></tspan></text>\n  <text\n     xml:space=\"preserve\"\n     style=\"font-style:normal;font-weight:normal;font-size:27.49344254px;line-height:1.25;font-family:sans-serif;text-align:center;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#f2f2f2;fill-opacity:1;stroke:none;stroke-width:0.68733609\"\n     x=\"274.90079\"\n     y=\"86.088181\"\n     id=\"textAtSvgMin\"\n     inkscape:label=\"#text826\"><tspan\n       sodipodi:role=\"line\"\n       id=\"tspan824-6-5\"\n       x=\"274.90079\"\n       y=\"86.088181\"\n       style=\"text-align:center;text-anchor:middle;fill:#f2f2f2;stroke-width:0.68733609\"></tspan></text>\n</svg>","clickableShapes":[],"javascriptHandlers":[],"smilAnimations":[],"bindings":[],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":false,"showBrowserEvents":false,"enableJsDebugging":false,"sendMsgWhenLoaded":false,"noClickWhenDblClick":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"dblClickZoomPercentage":150,"cssString":"div.ui-svg svg{\n    color: var(--nr-dashboard-widgetColor);\n    fill: currentColor !important;\n}\ndiv.ui-svg path {\n    fill: inherit;\n}","name":"","x":500,"y":120,"wires":[[]]},{"id":"8582c2d053d4f6f1","type":"function","z":"744d808088e3adef","name":"","func":"ophs = context.get(\"ophs\")||false;\n\nif(msg.payload==\"clear\")\n    context.set(\"ophs\",false);\n\n\nv = parseFloat(msg.heel);\nif( ophs == false ){\n    tr = {\n        min:v,\n        max:v\n        };\n    context.set(\"ophs\", true);\n    context.set(\"ophHeel\",tr);\n}else{\n    tr = context.get(\"ophHeel\");\n    if( tr.min>v ){\n        tr.min = v;\n        node.send({\n            \"payload\": {\n            \"command\": \"set_attribute\",\n            \"selector\": \"#niddleR\",\n            \"attributeName\":\"transform\",\n            \"attributeValue\": \"rotate(\"+tr.min+\")\"\n            }\n        });\n        node.send({ payload :{\n            \"command\": \"update_text\",\n            \"selector\": \"#textAtSvgMin\",\n            \"textContent\": parseInt(tr.min)+\"'\"\n            }\n        });\n        \n    }\n    if( tr.max<v ){\n        tr.max = v;\n        node.send({\n            \"payload\": {\n            \"command\": \"set_attribute\",\n            \"selector\": \"#niddleG\",\n            \"attributeName\":\"transform\",\n            \"attributeValue\": \"rotate(\"+tr.max+\")\"\n            }\n        });\n        node.send({ payload :{\n            \"command\": \"update_text\",\n            \"selector\": \"#textAtSvgMax\",\n            \"textContent\": parseInt(tr.max)+\"'\"\n            }\n        });\n        \n        \n    }\n    \n    context.set(\"ophHeel\",tr);\n}\n\n\n\n\n\nnode.status({\n        fill:'blue',\n        shape: 'ring',\n        text: tr.min+\" < \"+v+\" > \"+tr.max\n    });\n\nnode.send({\n        \"payload\": {\n        \"command\": \"set_attribute\",\n        \"selector\": \"#niddleB\",\n        \"attributeName\":\"transform\",\n        \"attributeValue\": \"rotate(\"+v+\")\"\n        }\n    });\nnode.send({ payload :{\n        \"command\": \"update_text\",\n        \"selector\": \"#textAtSvg\",\n        \"textContent\": parseInt(v)+\"'\"\n        }\n    });\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":120,"wires":[["ffc95bb7e3e3c613"]]},{"id":"cb1beed861f5ef04","type":"link in","z":"744d808088e3adef","d":true,"name":"","links":["4340f4c450d883db"],"x":155,"y":120,"wires":[["8582c2d053d4f6f1","294297572d41eda5"]]},{"id":"c7684adabc9b6333","type":"ui_button","z":"744d808088e3adef","name":"","group":"5c5c3a36c2a64fdb","order":3,"width":"1","height":"1","passthru":false,"label":"clear","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"clear","payloadType":"str","topic":"topic","topicType":"msg","x":270,"y":40,"wires":[["8582c2d053d4f6f1"]]},{"id":"294297572d41eda5","type":"function","z":"744d808088e3adef","name":"","func":"\nreturn {\n    payload: msg.heel\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":100,"y":640,"wires":[["b350da50d2a4267a"]]},{"id":"016960862eeda7d1","type":"exec","z":"744d808088e3adef","command":"/data/data/com.termux/files/home/ySS/shStartService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStartService.sh","x":910,"y":520,"wires":[[],[],[]]},{"id":"f2064f898668973b","type":"exec","z":"744d808088e3adef","command":"/data/data/com.termux/files/home/ySS/shStopService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStopService.sh","x":890,"y":400,"wires":[[],[],["3c4c8bc2903047a2"]]},{"id":"3c4c8bc2903047a2","type":"delay","z":"744d808088e3adef","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":920,"y":460,"wires":[["016960862eeda7d1"]]},{"id":"d63721fe89812e17","type":"function","z":"744d808088e3adef","name":"","func":"if( msg.topic == \"and/mag\" ){\n    context.set(\"workLast\", new Date().getTime() / 1000 );\n    node.status({\n        fill:'blue',\n        shape: 'ring',\n        text: \"got mag\"\n    });\n    \n}\n\n\n\nif( msg.topic == \"workOn\" || \n    (msg.topic == \"swOnOff\" && msg.payload == \"workOn\" ) ){\n    context.set(\"work\",true);\n    return [\n        {topic:\"loop\"},\n        null\n        ];   \n}\nif( msg.topic == \"workOff\" ||\n    (msg.topic == \"swOnOff\" && msg.payload == \"workOff\" ) ){\n    context.set(\"work\",false);\n    node.status({\n        fill:'black',\n        shape: 'ring',\n        text: \"off\"\n    });\n}\n\n    \n    \nif( msg.topic == \"loop\" ){\n    reset = null;\n    loop = {topic:\"loop\"};\n    \n    node.status({\n        fill:'green',\n        shape: 'ring',\n        text: \"work\"\n    });\n    \n    seconds = new Date().getTime() / 1000;\n    last = parseInt(context.get(\"workLast\"))||0;\n    if( (seconds-last) > 7 ){\n        \n        rCount = context.get(\"resetCount\")||0;\n        if( context.get(\"work\") ){\n            reset = {topic: \"work\",payload:\"reset It\"};\n            \n            context.set(\"resetCount\",rCount+1);\n            \n        }else\n            loop = null;\n        node.status({\n            fill:'green',\n            shape: 'ring',\n            text: \"timed out reset:\"+rCount\n        });\n        \n        context.set(\"workLast\", seconds );\n    }\n    \n    return [\n        loop,\n        reset\n        ];\n        \n}\n\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1060,"y":220,"wires":[["10779e0132084d50","bdbc65bbeeb85b16"],["df90d84d273cd415","f2064f898668973b"]]},{"id":"bbdcb208cec74995","type":"inject","z":"744d808088e3adef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"workOff","payload":"","payloadType":"date","x":790,"y":140,"wires":[["d63721fe89812e17"]]},{"id":"9e260e98719d3b2e","type":"inject","z":"744d808088e3adef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"workOn","payload":"","payloadType":"date","x":790,"y":100,"wires":[["d63721fe89812e17"]]},{"id":"10779e0132084d50","type":"delay","z":"744d808088e3adef","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":100,"wires":[["d63721fe89812e17"]]},{"id":"96dd7ff7e19d2a41","type":"inject","z":"744d808088e3adef","name":"off on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":680,"y":380,"wires":[["f2064f898668973b"]]},{"id":"bdbc65bbeeb85b16","type":"debug","z":"744d808088e3adef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":120,"wires":[]},{"id":"df90d84d273cd415","type":"debug","z":"744d808088e3adef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":180,"wires":[]},{"id":"0c69409832c592ca","type":"ui_slider","z":"744d808088e3adef","name":"","label":"Every","tooltip":"","group":"2061b059bbc89ff7","order":0,"width":"4","height":"1","passthru":true,"outs":"end","topic":"topic","topicType":"msg","min":"20","max":"200","step":1,"className":"","x":1270,"y":360,"wires":[["4047913c26afa4d3","e63a9258d7ed0291"]]},{"id":"4047913c26afa4d3","type":"debug","z":"744d808088e3adef","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1460,"y":300,"wires":[]},{"id":"ff3e68e4e9648b72","type":"mqtt out","z":"744d808088e3adef","name":"","topic":"and/cmd","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":1580,"y":420,"wires":[]},{"id":"e63a9258d7ed0291","type":"function","z":"744d808088e3adef","name":"","func":"\nreturn {payload:\"sensorsEvery:\"+msg.payload};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1420,"y":420,"wires":[["ff3e68e4e9648b72"]]},{"id":"4d59c7a1baf26aa1","type":"ui_chart","z":"744d808088e3adef","name":"mag raw","group":"7d18e7f1f3d5bd09","order":1,"width":"4","height":"3","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":540,"y":920,"wires":[[]]},{"id":"f777ac0f13f877a0","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"and/mag/raw","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":130,"y":920,"wires":[["a141de5238349ed9"]]},{"id":"a141de5238349ed9","type":"function","z":"744d808088e3adef","name":"","func":"node.status({text:msg.payload});\nv = msg.payload.split(\",\");\n\nnode.send({\n    topic:\"x\",\n    payload:parseFloat(v[0]).toFixed(2)\n});\n\nnode.send({\n    topic:\"y\",\n    payload:parseFloat(v[1]).toFixed(2)\n});\n\nnode.send({\n    topic:\"z\",\n    payload:parseFloat(v[2]).toFixed(2)\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":920,"wires":[["4d59c7a1baf26aa1"]]},{"id":"a5338357c1d55e55","type":"function","z":"744d808088e3adef","name":"rotate matrix","func":"function rotByZ( xyz,deg){\n    x = xyz[0];\n    y = xyz[1];\n    z = xyz[2];\n    \n\txr = x*Math.cos(deg) - y*Math.sin(deg);\n\tyr = x*Math.sin(deg) + y*Math.cos(deg);\n\tzr = z;\n\t\n\treturn [xr,yr,zr];\n}\n\nfunction rotByX( xyz,deg){\n    x = xyz[0];\n    y = xyz[1];\n    z = xyz[2];\n    \n\t\n\tyr = y*Math.cos(deg) - z*Math.sin(deg);\n\tzr = y*Math.sin(deg) + z*Math.cos(deg);\n\txr = x;\n\t\n\treturn [xr,yr,zr];\n}\n\nfunction rotByY( xyz,deg){\n    x = xyz[0];\n    y = xyz[1];\n    z = xyz[2];\n    \n\t\n\tzr = z*Math.cos(deg) - x*Math.sin(deg);\n\txr = z*Math.sin(deg) + x*Math.cos(deg);\n\tyr = y;\n\t\n\treturn [xr,yr,zr];\n}\n\nfunction deg2rad(deg)\n{\n  return deg * Math.PI / 180;\n}\n\nvar pr = msg.payload;\nvar pEnd = rotByZ( pr, deg2rad(flow.get(\"zAxis\")||0) );\nvar pEnd = rotByX( pEnd, deg2rad(flow.get(\"xAxis\")||0) );\nvar pEnd = rotByY( pEnd, deg2rad(flow.get(\"yAxis\")||0) );\n\n\nnode.send(\n    [\n    {topic:\"x\",payload: pr[0]},\n    {topic:\"x2\",payload: pEnd[0]}\n    ]);\nnode.send([\n    {topic:\"y\",payload: pr[1]},\n    {topic:\"y2\",payload: pEnd[1]}\n    ]);\nnode.send([\n    {topic:\"z\",payload: pr[2]},\n    {topic:\"z2\",payload: pEnd[2]}\n    ]);\n\n\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1030,"y":960,"wires":[["6e1b2373f203cbed"],["c4237c1cb89ed7f9"]]},{"id":"2c343671aa82dcb0","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"and/accel","topic":"and/accel","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":680,"y":840,"wires":[["5f2eb71a279f84fc"]]},{"id":"5f2eb71a279f84fc","type":"function","z":"744d808088e3adef","name":"","func":"p = msg.payload.split(\",\");\nreturn {payload:p};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":860,"wires":[["a5338357c1d55e55"]]},{"id":"6e1b2373f203cbed","type":"ui_chart","z":"744d808088e3adef","name":"accel raw","group":"1933a87dd47c0e42","order":1,"width":"3","height":"4","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"15","removeOlderPoints":"","removeOlderUnit":"1","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":1300,"y":880,"wires":[[]]},{"id":"c64316a90d3775dd","type":"ui_slider","z":"744d808088e3adef","name":"","label":"x axis","tooltip":"","group":"1933a87dd47c0e42","order":1,"width":"6","height":"1","passthru":true,"outs":"end","topic":"xAxis","topicType":"str","min":"-180","max":"90","step":"10","className":"","x":1030,"y":1060,"wires":[["04c89d3d60e6c92a"]]},{"id":"04c89d3d60e6c92a","type":"function","z":"744d808088e3adef","name":"","func":"if( msg.topic)\n    flow.set(msg.topic,msg.payload);\n    \n    \nnode.status({text:\"top:\"+msg.topic+\" p:\"+msg.payload});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1240,"y":1100,"wires":[[]]},{"id":"5db09af182904ef1","type":"ui_slider","z":"744d808088e3adef","name":"","label":"y axis","tooltip":"","group":"1933a87dd47c0e42","order":1,"width":"6","height":"1","passthru":true,"outs":"end","topic":"yAxis","topicType":"str","min":"-180","max":"90","step":"10","className":"","x":1030,"y":1140,"wires":[["04c89d3d60e6c92a"]]},{"id":"4417a26d4a38214e","type":"ui_slider","z":"744d808088e3adef","name":"","label":"z axis","tooltip":"","group":"1933a87dd47c0e42","order":1,"width":"6","height":"1","passthru":true,"outs":"end","topic":"zAxis","topicType":"str","min":"-180","max":"90","step":"10","className":"","x":1030,"y":1200,"wires":[["04c89d3d60e6c92a"]]},{"id":"c4237c1cb89ed7f9","type":"ui_chart","z":"744d808088e3adef","name":"accel after rotate","group":"1933a87dd47c0e42","order":1,"width":"3","height":"4","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"15","removeOlderPoints":"","removeOlderUnit":"1","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":1330,"y":960,"wires":[[]]},{"id":"ec22486220e62f8c","type":"comment","z":"744d808088e3adef","name":"transformations","info":"flat\n    transformations: 0,0,0\n\nlandscape\n    transformations: x90 y-90\n        \nportret\n    transformations: x90\n    \nportret screen forward\n    transformations: x-90 y-180","x":1240,"y":1180,"wires":[]},{"id":"47ca2639f2d2a1d9","type":"ui_button","z":"744d808088e3adef","name":"","group":"1933a87dd47c0e42","order":5,"width":"4","height":"1","passthru":false,"label":"send settings to ySS","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":980,"y":1280,"wires":[["230271b8f2adfa26"]]},{"id":"230271b8f2adfa26","type":"function","z":"744d808088e3adef","name":"","func":"accelCorr = flow.get(\"xAxis\")+\",\"+\n    flow.get(\"yAxis\")+\",\"+\n    flow.get(\"zAxis\");\n\nreturn {\n  topic:\"and/cmd\",\n  payload: \"accelCorrect:\"+accelCorr\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1200,"y":1280,"wires":[["6c2a007f7e4dba0c"]]},{"id":"6c2a007f7e4dba0c","type":"mqtt out","z":"744d808088e3adef","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":1370,"y":1320,"wires":[]},{"id":"4a02898ada3f7301","type":"inject","z":"744d808088e3adef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"10","payloadType":"num","x":820,"y":1060,"wires":[["c64316a90d3775dd"]]},{"id":"26c3300694e3a0aa","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"and/stat/accelCorrect","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":600,"y":1160,"wires":[["235540f13499700c"]]},{"id":"235540f13499700c","type":"function","z":"744d808088e3adef","name":"","func":"v = msg.payload.split(\",\");\nreturn [\n    {payload:parseInt(v[0])},\n    {payload:parseInt(v[1])},\n    {payload:parseInt(v[2])}\n    ];","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":1160,"wires":[["c64316a90d3775dd"],["5db09af182904ef1"],["4417a26d4a38214e"]]},{"id":"1aec1d9d6c34509f","type":"ui_button","z":"744d808088e3adef","name":"","group":"1933a87dd47c0e42","order":6,"width":"2","height":"1","passthru":false,"label":"get settings","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"accelCorrect:?","payloadType":"str","topic":"myss/cmd","topicType":"str","x":950,"y":1360,"wires":[["1a39ffd2f747cd6d"]]},{"id":"7e457a323ca0884a","type":"ui_slider","z":"744d808088e3adef","name":"","label":"hdg offset","tooltip":"","group":"d31b28f36c269c47","order":0,"width":0,"height":0,"passthru":true,"outs":"end","topic":"topic","topicType":"str","min":0,"max":"360","step":1,"className":"","x":940,"y":1440,"wires":[["c38ea839b3453ede"]]},{"id":"c38ea839b3453ede","type":"function","z":"744d808088e3adef","name":"","func":"\nreturn {\n    topic: \"and/cmd\",\n    payload: \"magOffset:\"+msg.payload\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":1440,"wires":[["6c2a007f7e4dba0c"]]},{"id":"1a39ffd2f747cd6d","type":"function","z":"744d808088e3adef","name":"","func":"node.send({\n    topic: \"and/cmd\",\n    payload: \"accelCorrect:?\"\n});\n\nnode.send({\n    topic: \"and/cmd\",\n    payload: \"magOffset:?\"\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1140,"y":1360,"wires":[["6c2a007f7e4dba0c"]]},{"id":"3f73fec37ff8d415","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"and/stat/magOffset","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":650,"y":1440,"wires":[["7e457a323ca0884a"]]},{"id":"9b70ce9fbf3626ee","type":"exec","z":"744d808088e3adef","command":"/data/data/com.termux/files/home/ySS/shStopService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStopService.sh","x":910,"y":620,"wires":[[],[],[]]},{"id":"a7c5daeaf285a2f7","type":"inject","z":"744d808088e3adef","name":"off on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":600,"wires":[["9b70ce9fbf3626ee"]]},{"id":"226175e6daea229e","type":"mqtt out","z":"744d808088e3adef","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":870,"y":200,"wires":[]},{"id":"e59b0cee687234a6","type":"function","z":"744d808088e3adef","name":"windEfort","func":"\n\nif( msg.topic == \"and/mag\" ){\n    flow.set(\"hdgLast\",msg.payload);\n    \n    g = parseFloat(msg.payload);\n    hdgAvgM = parseFloat(flow.get(\"hdgAvg\")||g);\n    hdgAvg = (0.995*hdgAvgM + 0.005*g);\n    flow.set(\"hdgAvg\",hdgAvg);\n    \n    \n    node.send({\n        topic:\"NR/hdgAvg\",\n        payload:flow.get(\"hdgAvg\")\n        });\n    \n    wea = parseInt(flow.get(\"windEffordAng\")||-1);\n    if( wea > 0 ){\n        node.send({\n            topic:\"NR/tack\",\n            payload: ( wea < g   ? \"P\" : \"S\" )\n            });\n        \n        node.status({\n            text:\"windEffordAnd:\"+wea\n        });\n    }\n    \n    \n} else if( msg.topic == \"and/orient/heel\"){\n    g = parseFloat(msg.payload);\n    heelAvgM = parseFloat(flow.get(\"heelAvg\")||g);\n    heelAvg = (0.9*heelAvgM + 0.1*g);\n    flow.set(\"heelAvg\",heelAvg);\n        \n    node.send({\n        topic:\"NR/heelAvg2\",\n        payload: heelAvg\n        \n    });\n    \n    \n    g = parseFloat(msg.payload);\n    avgHeelM = parseFloat(flow.get(\"avgHeel\")||g);\n    avgHeel = (0.995*avgHeelM + 0.005*g);\n    flow.set(\"avgHeel\",avgHeel);\n        \n    \n    \n\n    node.send({\n        topic:\"NR/avgHeel\",\n        payload: avgHeel\n        \n    });\n    \n    \n    pLast = parseInt(flow.get(\"pLast\")||1);\n    if( pLast > 0 && avgHeel > heelAvg ){\n        node.send({\n            topic:\"NR/windEffordAng\",\n            payload:flow.get(\"hdgAvg\")\n            });\n        flow.set(\"windEffordAng\", flow.get(\"hdgAvg\"));\n        flow.set(\"pLast\",-1);\n    }else if( pLast < 0 && avgHeel < heelAvg ){\n        \n        node.send({\n            topic:\"NR/windEffordAng\",\n            payload:flow.get(\"hdgAvg\")\n            });\n        flow.set(\"windEffordAng\", flow.get(\"hdgAvg\"));\n        flow.set(\"pLast\",1);\n    }\n    \n    \n    \n\n}\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":200,"wires":[["226175e6daea229e","83624622bbce60b0","6e19cb88f94939f1"]]},{"id":"83624622bbce60b0","type":"function","z":"744d808088e3adef","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":280,"wires":[["226175e6daea229e"]]},{"id":"6e19cb88f94939f1","type":"link out","z":"744d808088e3adef","name":"goToWindAfort","mode":"link","links":["b2989716127d048c"],"x":595,"y":180,"wires":[]},{"id":"af08c408d135b1cd","type":"ui_gauge","z":"744d808088e3adef","name":"","group":"7d18e7f1f3d5bd09","order":3,"width":0,"height":0,"gtype":"compass","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"360","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","className":"","x":450,"y":1040,"wires":[]},{"id":"93fddf5a4d3f9921","type":"mqtt in","z":"744d808088e3adef","d":true,"name":"","topic":"cIMU/windComs","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":140,"y":1100,"wires":[["7fcbd6014bfcc44e"]]},{"id":"7d15d05117cb35d8","type":"debug","z":"744d808088e3adef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":390,"y":1220,"wires":[]},{"id":"7fcbd6014bfcc44e","type":"function","z":"744d808088e3adef","name":"","func":"\nreturn {\n    payload: parseInt( msg.payload )\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":1080,"wires":[["af08c408d135b1cd","7d15d05117cb35d8"]]},{"id":"3b783fa724d1eeb2","type":"exec","z":"744d808088e3adef","command":"/data/data/com.termux/files/home/ySS/shStartService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStartService.sh","x":910,"y":720,"wires":[[],[],[]]},{"id":"e34495fc949f6b6e","type":"inject","z":"744d808088e3adef","name":"on on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":700,"wires":[["3b783fa724d1eeb2"]]},{"id":"d0f5cc44e836c1f5","type":"exec","z":"805e345c078ffbda","command":"/data/data/com.termux/files/home/ySS/shStopService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStopService.sh","x":970,"y":280,"wires":[[],[],[]]},{"id":"ac458332aa63e932","type":"exec","z":"805e345c078ffbda","command":"/data/data/com.termux/files/home/ySS/shStartService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStartService.sh","x":970,"y":220,"wires":[[],[],[]]},{"id":"e3c978b7551f4285","type":"inject","z":"805e345c078ffbda","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"doActionsChk","payload":"","payloadType":"date","x":270,"y":480,"wires":[["1e47f16c79fb5797"]]},{"id":"1e47f16c79fb5797","type":"function","z":"805e345c078ffbda","name":"","func":"var timeOut = 5000; // 5 sec\nvar clients = flow.get('yssClients')||{};\n\nif( msg.status ){\n    \n    if( msg.status.text == '0 connections' ){\n        clients[ msg.status.source.name ] = 0;\n    }else if( msg.status.text == 'common.status.disconnected' ){\n        clients[ msg.status.source.name ] = 0;\n    }else{\n        clients[ msg.status.source.name ] = 1;\n    }\n    flow.set('yssClients', clients);\n    \n}\n\n\n\nif( msg.topic == 'doActionsChk' ){\n    tn = new Date().getTime();\n    lastPing = parseInt(flow.get('andPingLastTime'))||0;\n    \n    var andStatus = 'on';\n    fillColor = 'green';\n    if( (lastPing+timeOut) < tn ){\n        andStatus = 'off';\n        fillColor = 'red'\n    }\n    \n    var s = \" -- \";\n    var ks = Object.getOwnPropertyNames(clients);\n    var onSum = 0;\n    for( var k=0,kl=ks.length;k<kl;k++ ){\n        s+= ' ( '+ks[k]+' ->  '+clients[ ks[k] ]+'), ';\n        onSum+= clients[ ks[k] ];\n    }\n    \n    if( global.get('apOnIs') )\n        onSum+=1;\n    \n    \n    \n    node.status({\n        fill:fillColor,\n        shape: 'ring',\n        text:'doAction andStat('+andStatus+')' +s+'[ap:'+global.get('apOnIs')+']'\n    });   \n    \n    \n    if( onSum > 0 && andStatus == 'off'){\n        node.send([\n            {payload:'make it running'},\n            null\n            ]);\n    }else if( onSum == 0 && andStatus == 'on'){\n        node.send([\n            null,\n            {payload:'make it stop'}\n            ]);\n    }\n    \n}\nif( msg.topic == 'and/stat/ping' ){\n    flow.set('andPingLastTime',new Date().getTime());\n    \n    //node.status({\n    //    text:'gotPing'\n    //});\n}","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":540,"wires":[["ac458332aa63e932"],["d0f5cc44e836c1f5"],[]]},{"id":"efbd243056224b42","type":"mqtt in","z":"805e345c078ffbda","name":"","topic":"and/stat/ping","qos":"2","datatype":"auto","broker":"4bf528a73403ee8b","nl":false,"rap":true,"rh":0,"inputs":0,"x":310,"y":540,"wires":[["1e47f16c79fb5797"]]},{"id":"5e34213eb7c27988","type":"inject","z":"805e345c078ffbda","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":790,"y":220,"wires":[["ac458332aa63e932"]]},{"id":"723d7daebb7540b4","type":"inject","z":"805e345c078ffbda","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":790,"y":280,"wires":[["d0f5cc44e836c1f5"]]},{"id":"52f734b330961380","type":"link in","z":"805e345c078ffbda","name":"yssManagerCmdLink","links":["d72c7ff305d06eee","6c193329fe0d5f0c"],"x":355,"y":660,"wires":[["1e47f16c79fb5797","c0de322b2322cf08"]]},{"id":"c0de322b2322cf08","type":"debug","z":"805e345c078ffbda","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":450,"y":720,"wires":[]},{"id":"2028074dde6dc44d","type":"inject","z":"805e345c078ffbda","name":"zero clients list","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":420,"wires":[["19674c3f36303a79"]]},{"id":"19674c3f36303a79","type":"function","z":"805e345c078ffbda","name":"","func":"flow.set('yssClients',{});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":420,"wires":[[]]},{"id":"723b063ef50ea7c3","type":"exec","z":"dc100dc94d61a256","command":"/data/data/com.termux/files/home/ySS/shStopService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStopService.sh","x":830,"y":100,"wires":[[],[],[]]},{"id":"b52e01bf025f7a25","type":"inject","z":"dc100dc94d61a256","name":"off on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":580,"y":100,"wires":[["723b063ef50ea7c3"]]},{"id":"3114b88e6a7f43b5","type":"exec","z":"dc100dc94d61a256","command":"/data/data/com.termux/files/home/ySS/shStartService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStartService.sh","x":830,"y":40,"wires":[[],[],[]]},{"id":"3171de2d8dec70d1","type":"inject","z":"dc100dc94d61a256","name":"on on loop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":580,"y":40,"wires":[["3114b88e6a7f43b5"]]},{"id":"6e972fe8d0532d27","type":"inject","z":"dc100dc94d61a256","name":"ping","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"5","crontab":"","once":false,"onceDelay":"1","topic":"ping","payload":"","payloadType":"date","x":150,"y":560,"wires":[["f0e20f44c35a8239"]]},{"id":"f0e20f44c35a8239","type":"websocket out","z":"dc100dc94d61a256","name":"/ws/accel/oriCal","server":"8516e78c8b694779","client":"","x":840,"y":560,"wires":[]},{"id":"318a83a44dedb148","type":"websocket in","z":"dc100dc94d61a256","name":"/ws/accel/oriCal_In","server":"5192310fb92c0375","client":"","x":190,"y":200,"wires":[["073235304195fa7d","d24cfdc27d6173d6","59aeb56c4852664c","5bd0c7a0667d33b1","a31c8fdeb21292d1"]]},{"id":"073235304195fa7d","type":"debug","z":"dc100dc94d61a256","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":410,"y":100,"wires":[]},{"id":"d24cfdc27d6173d6","type":"function","z":"dc100dc94d61a256","name":"","func":"\nm = msg.payload;\n\nnode.status({\n    text: m\n});\n\n\n\nif( m == \"action:off\" ){\n    node.send([null,{}]);\n    \n}else if( m == \"action:on\" ){\n    node.send([{},null]);\n\n    \n}else if( m == \"action:getAccelCorrect\" ){\n    msg = {\n        topic: \"and/cmd\",\n        payload: \"accelCorrect:?\"\n        };\n    node.send([null,null,msg]);\n    \n}else if( m.substring(0,17) == \"action:setAccCor:\" ){\n    accCor = m.substring(17);\n    \n    msg = {\n      topic:\"and/cmd\",\n      payload: \"accelCorrect:\"+accCor\n    };\n    \n    node.send([null,null,msg]);\n    \n    node.status({\n        text:\"set correct\"+accCor\n    });\n}\n\n\n\n\n","outputs":5,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":240,"wires":[["3114b88e6a7f43b5"],["723b063ef50ea7c3"],["e88f0cfad5151b4b"],[],[]]},{"id":"71d93728273b2939","type":"mqtt in","z":"dc100dc94d61a256","name":"","topic":"and/#","qos":"2","datatype":"auto","broker":"4bf528a73403ee8b","nl":false,"rap":true,"rh":0,"inputs":0,"x":150,"y":620,"wires":[["6fb3306c2d1e9967","59aeb56c4852664c"]]},{"id":"e88f0cfad5151b4b","type":"mqtt out","z":"dc100dc94d61a256","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"4bf528a73403ee8b","x":750,"y":240,"wires":[]},{"id":"6fb3306c2d1e9967","type":"function","z":"dc100dc94d61a256","name":"","func":"\nreturn {\n    topic: msg.topic,\n    payload: msg.payload\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":620,"wires":[["f0e20f44c35a8239"]]},{"id":"2c2dc82b9f6f7406","type":"mqtt in","z":"dc100dc94d61a256","name":"e01Mux/adc0","topic":"e01Mux/adc0","qos":"2","datatype":"auto","broker":"d611ceefa2b9fd0b","nl":false,"rap":true,"rh":0,"inputs":0,"x":130,"y":720,"wires":[["6fb3306c2d1e9967"]]},{"id":"8e92236cb4b9a77a","type":"inject","z":"dc100dc94d61a256","name":"gps p0 lat","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"and/lat","payload":"9.0","payloadType":"str","x":120,"y":380,"wires":[["6fb3306c2d1e9967"]]},{"id":"db87107df3ca67ba","type":"inject","z":"dc100dc94d61a256","name":"gps p0 lon","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"and/lon","payload":"-78.0","payloadType":"str","x":110,"y":420,"wires":[["6fb3306c2d1e9967"]]},{"id":"70bf37a06a04e96f","type":"inject","z":"dc100dc94d61a256","name":"gps p2 lat","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1.1","topic":"and/lat","payload":"10.0","payloadType":"str","x":120,"y":460,"wires":[["6fb3306c2d1e9967"]]},{"id":"757df0c5723b39fa","type":"inject","z":"dc100dc94d61a256","name":"gps p2 lon","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1.5","topic":"and/lon","payload":"-78.0","payloadType":"str","x":110,"y":500,"wires":[["6fb3306c2d1e9967"]]},{"id":"e435951805d82abd","type":"tcp in","z":"dc100dc94d61a256","name":"from opencpn :12226","server":"server","host":"","port":"12226","datamode":"stream","datatype":"utf8","newline":"\\n","topic":"","base64":false,"x":1000,"y":260,"wires":[["8d718b12b13c74c9","a84695150d12fee7"]]},{"id":"8d718b12b13c74c9","type":"debug","z":"dc100dc94d61a256","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1150,"y":180,"wires":[]},{"id":"a84695150d12fee7","type":"function","z":"dc100dc94d61a256","name":"extract nav to point","func":"function ddmmToLdec( ddmm ){\n    var dot = ddmm.indexOf('.');\n    var dd = parseInt(ddmm.substring(0,dot-2));\n    var mm = parseFloat( ddmm.substring(dot-2) );\n    return dd + ( mm/60 );\n}\n\n\nif( msg.payload.substring(0,1) == \"$\" && msg.payload.substring(6,7) == \",\" ){\n    m = msg.payload;\n    key = m.substring(3,6);\n    v = m.split(\",\");\n    tex = \"\";\n    srcCmd = m.substring(1,3);\n    \n    if( key == \"RMB\" ){\n        xte = v[12];\n        if( v[3] == \"L\" )\n            xte*=-1;\n            \n        lat = ddmmToLdec(v[6])*( v[7]==\"S\"?-1:1);\n        lon = ddmmToLdec(v[8])*( v[9]==\"W\"?-1:1);\n        flow.set('rmbLast',Math.round(v[11]));\n        \n        node.send({\n            topic: \"NR/nav/rmb\",\n            payload: {\n                'xte': xte,\n                'rng': v[10],\n                'onHeading': v[11],\n                'arrived': v[13]=='V'?0:1,\n                'to': v[4],\n                'lat': lat,\n                'lon': lon\n                },\n            srcDev: srcCmd\n        });\n        /*\n        node.send({\n            topic: \"NR/nav/rng\",\n            payload: v[10],\n            srcDev: srcCmd\n        });\n        \n        node.send({\n            topic: \"NR/nav/onHeading\",\n            payload: v[11],\n            srcDev: srcCmd\n        });\n        \n        \n        \n        node.send({\n            topic: \"NR/nav/arrival\",\n            payload: v[13],\n            srcDev: srcCmd\n        });\n        */\n        \n    }\n    \n    \n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1270,"y":260,"wires":[["96b3175ecfc9917c","f0e20f44c35a8239","59aeb56c4852664c"]]},{"id":"96b3175ecfc9917c","type":"debug","z":"dc100dc94d61a256","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1410,"y":180,"wires":[]},{"id":"9c34c47c70102874","type":"debug","z":"dc100dc94d61a256","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1040,"wires":[]},{"id":"e0fe1439430dc210","type":"inject","z":"dc100dc94d61a256","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"test","payloadType":"str","x":390,"y":1040,"wires":[["1f7d57962a14fa14"]]},{"id":"1f7d57962a14fa14","type":"function","z":"dc100dc94d61a256","name":"test global funcs","func":"var mu = global.get('mutil');\n\nmuTest = {\n    'add( 10, 1 ) -> 11': mu.add(10,1),\n    'getHello' : mu.getHello()\n};\n\nnode.send({payload:mu.degPos(-90)});\n\nd3 = {\n    \"pos(-180) -> 180\":mu.degPos(-180),\n    \"pos(-190) -> 170\":mu.degPos(-190),\n    \"pos(-361) -> 359\":mu.degPos(-361),\n    \"pos(-350) -> 10\":mu.degPos(10),\n    \"delta( 0, 10) -> 10\": mu.degDelta(0,10),\n    \"delta( 0, -10) -> -10\": mu.degDelta(0,-10),\n    \"delta( 90, -90) -> -190 || 190\": mu.degDelta(90,-90)\n};\n\nnode.send({\n    muTest,\n    d3,\n    'Controller': mu.getPid().getHello()\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":1040,"wires":[["9c34c47c70102874"]]},{"id":"057f74a11eeabfc5","type":"inject","z":"dc100dc94d61a256","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":430,"y":980,"wires":[["7ef168a719e03c57"]]},{"id":"7ef168a719e03c57","type":"function","z":"dc100dc94d61a256","name":"deg360 functions","func":"const mutil = (function () {\n    'use strict';\n    var cc = 0;\n    \n    function add(a, b) {\n        return a + b;\n    }\n    \n    function getHello( ){\n        return \"hello \"+cc++;\n    }\n    \n    function degPos( deg ){\n        deg = deg%360;\n        if( deg < 0 )\n            deg+=360;\n        return deg;\n    }\n    \n    function degDelta( deg0, deg1 ){\n        deg0 = degPos(deg1)-degPos(deg0);\n        \n        if( deg0 > 180 )\n            deg0-=360;\n        if( deg0 < -180 )\n            deg0+=360;\n        \n        return deg0;\n    }\n    \n    function mMapVal( val, minI, maxI, minO, maxO, inLimits = false){\n      var dI = maxI - minI;\n      var dO = maxO - minO;\n      var nI = ( val - minI )/dI;\n    \n      if( inLimits ){\n        var tr = minO + ( nI*dO );\n        if( tr < minO )\n          return minO;\n        else if( tr > maxO )\n          return maxO;\n        else\n          return tr;\n    \n      }else\n        return minO + ( nI*dO );\n    \n    }\n    \n    \n    \n    class Controller {\n      helloCount = 0;\n      updatesCount = 0;\n      \n      constructor(k_p, k_i, k_d, dt) {\n        let i_max;\n        if (typeof k_p === 'object') {\n          let options = k_p;\n          k_p = options.k_p;\n          k_i = options.k_i;\n          k_d = options.k_d;\n          dt = options.dt;\n          i_max = options.i_max;\n        }\n    \n        // PID constants\n        this.k_p = (typeof k_p === 'number') ? k_p : 1;\n        this.k_i = k_i || 0;\n        this.k_d = k_d || 0;\n    \n        // Interval of time between two updates\n        // If not set, it will be automatically calculated\n        this.dt = dt || 0;\n    \n        // Maximum absolute value of sumError\n        this.i_max = i_max || 0;\n    \n        this.sumError  = 0;\n        this.lastError = 0;\n        this.lastTime  = 0;\n    \n        this.target    = 0; // default value, can be modified with .setTarget\n      }\n      \n      getHello(){\n          return \"hello from Controller\"+this.helloCount++;\n      }\n    \n      setTarget(target) {\n        this.target = target;\n      }\n    \n      update(currentValue) {\n        if(!currentValue) throw new Error(\"Invalid argument\");\n        this.currentValue = currentValue;\n        this.updatesCount++;\n    \n        // Calculate dt\n        let dt = this.dt;\n        if (!dt) {\n          let currentTime = Date.now();\n          if (this.lastTime === 0) { // First time update() is called\n            dt = 0;\n          } else {\n            dt = (currentTime - this.lastTime) / 1000; // in seconds\n          }\n          this.lastTime = currentTime;\n        }\n        if (typeof dt !== 'number' || dt === 0) {\n          dt = 1;\n        }\n    \n        let error = (this.target - this.currentValue);\n        this.sumError = this.sumError + error*dt;\n        if (this.i_max > 0 && Math.abs(this.sumError) > this.i_max) {\n          let sumSign = (this.sumError > 0) ? 1 : -1;\n          this.sumError = sumSign * this.i_max;\n        }\n    \n        let dError = (error - this.lastError)/dt;\n        this.lastError = error;\n    \n        // differential_error - delta\n        // heading_error = heading_to_steer - heading; \n        // differential_error = bearingrate; // 0 - 0.5\n        //PID_output = PID_Ks[0] * (PID_Ks[1] * heading_error  - PID_Ks[2] * differential_error); \n        //rudder_command = rudder_command + PID_output;\n    \n    \n        return (this.k_p*error) + (this.k_i * this.sumError) + (this.k_d * dError);\n      }\n    \n      reset() {\n        this.sumError  = 0;\n        this.lastError = 0;\n        this.lastTime  = 0;\n      }\n    }\n    \n    \n    function getPid(){\n        return pid;\n    }   \n    \n    function toDegrees ( rad ) {\n      return rad * (180 / Math.PI);\n    }\n    function getAngle( x0, y0, x1, y1 ){\n      var dx = x1-x0;\n      var dy = y1-y0;\n      return toDegrees( Math.atan2( dx, dy ) );\n    }\n\n    \n    var sec1 = 1000;\n    var sec30 = sec1*30;\n    var min1 = 2*sec30;\n    var min5 = min1*5;\n    \n    var storeData = {};\n    function storeIt( key, val, forMs ){\n      var t = new Date().getTime();\n      //new Date().getTime() / 1000\n      //console.log(\"t:\"+t);\n      // todo\n      if( storeData[key] == undefined )\n        storeData[key] = new Array();\n    \n        storeData[key].push({\n          'v': val,\n          't': t\n          });\n    \n        var tOld = t - forMs;\n        while( true ){\n          if( storeData[key][0]['t'] < tOld ){\n            //console.log(\"storeIt key:\"+key+\" drop to old!\");\n            storeData[key].shift();\n    \n          }else{\n            //console.log(\"storeIt key:\"+key+\" is up to date...\"+len);\n            break;\n          }\n    \n        }\n    \n    \n    }\n    function storeGetLast( key ){\n      return storeData[key][ storeData[key].length-1 ];\n    }\n    function storeGetPreLast( key ){\n      return storeData[key][ storeData[key].length-2 ];\n    }\n    \n    function avgIt( key, forMs, toMs ){\n  var now = new Date().getTime();\n\n  var t = now-forMs;\n\n  var tFrom = now;\n  if( toMs != undefined )\n    tFrom = t+toMs;\n\n  var d = storeData[key];\n  var l = d.length-1;\n  var tr = 0;\n  var trC = 0;\n\n\n  for( var i=l; i>=0; i-- ){\n    if( t <= d[i]['t'] && d[i]['t'] <= tFrom ){\n      tr+= d[i]['v'];\n      trC++;\n    }\n\n  }\n\n  //console.log(\"avgIt tr\"+tr+\" trC\"+trC+\" res\"+(tr/trC));\n  return tr/trC;\n\n}\n    \n    \n    var pid = new Controller( 0.05 ,0.0001, 0.002);\n    \n    class apContener {\n      on = false;\n      \n      resp = 100;\n      gain2 = -6;\n      \n      hdm = 0;\n      target = 0;\n      delta = 0;\n      \n      pid = getPid();\n      pidRes = 0;\n      tPos = 0;\n      pidResS = 0;\n      \n      \n      \n      constructor() {\n      }\n      \n      pidResS = 0;\n      calTillerMove( pidRes ){\n          var d = pidRes - this.tPos;\n          \n        \n          if( Math.abs(d) > 0.25 ){\n            this.tPos = pidRes;\n            return Math.round(d*this.resp);\n          }else\n            return 0;\n      }\n      \n      rudder_command = 0;\n      pid2( delta ){\n          // differential_error - delta\n        // heading_error = heading_to_steer - heading; \n        // differential_error = bearingrate; // 0 - 0.5\n        var PID_output = this.pid.k_p * (this.pid.k_i * delta  - this.pid.k_d * this.gain2); \n        return this.rudder_command + PID_output;\n      }\n      \n      update( degMag ){\n          storeIt('ap_degMag', degMag, sec30);\n          this.hdm = avgIt('ap_degMag',sec1*2);\n          this.delta = degDelta( this.hdm, this.target );\n          this.pidRes = this.pid.update( this.delta-(this.tPos*this.gain2) );\n          this.rudder_command = this.pidRes;\n          storeIt('pidRes', this.pidRes, sec30);\n          \n          //this.pidRes = this.pid.update( this.delta - this.pidRes );\n          \n          \n          \n          return {\n            hdm: this.hdm,\n            target: this.target,\n            delta: this.delta,\n            pidRes: this.pidRes,\n            pidResAvgSec5: avgIt('pidRes',sec1*5),\n            tillerPos: this.tPos,\n            tillerBy: this.calTillerMove( this.pidRes ),\n            pidAng: this.ang,\n            time: new Date()\n            };\n      }\n      \n      setTarget( deg ){\n          this.target = degPos(deg);\n      }\n      \n      setAuto( degTarget ){\n          this.setTarget( degTarget );\n          this.on = true;\n          this.tPos = 0;\n          this.pidRes = 0;\n          this.pid.reset();\n          this.rudder_command = 0;\n          \n      }\n      setStandby(){\n          this.on = false;\n      }\n      \n      getStatusMsg(){\n          if( this.on ){\n              return \"auto to: \"+Math.round(this.target);\n          }else{\n            return \"stand by\";    \n          }\n          \n      }\n      \n    }\n    var apCon = new apContener();\n    function getApContener(){\n        return apCon;\n    }\n    \n    \n    \n    \n    \n    class apSolver{\n\n\ta0 = 0;\n\ta1 = 0;\n\ta2 = 0;\n\n\n\n\n\tdb( msg){\n\t\t/*\n\t\t$('#sDeb').html(\n\t\t\tmsg+\"<br>\"+\n\t\t\t$('#sDeb').html()\n\t\t\t);\n\t\t*/\n\t}\n\n\tq1(){\n\t\tvar tr = \"cn - NaN\";\n\t\tif( this.a0 == this.a1 && this.a1 == this.a2 )\n\t\t\ttr = 'c1 - stable';\n\t\telse if( this.a0 > this.a1 && this.a1 == this.a2 )\n\t\t\ttr = 'c2 - up start';\n\t\telse if( this.a0 < this.a1 && this.a1 == this.a2 )\n\t\t\ttr = 'c3 - down start';\n\n\t\telse if( this.a0 > this.a1 && this.a1 > this.a2 )\n\t\t\ttr = 'c4 - up speed up';\n\n\n\t\telse if( this.a0 < this.a1 && this.a1 < this.a2 )\n\t\t\ttr = 'c5 - down speed up';\n\n\t\telse if( this.a0 < this.a1 && this.a1 > this.a2 )\n\t\t\ttr = 'c6 - down past peek';\n\n\t\telse if( this.a0 > this.a1 && this.a1 < this.a2 )\n\t\t\ttr = 'c7 - up past bottom';\n\n\t\telse if( this.a0 == this.a1 && this.a1 > this.a2 )\n\t\t\ttr = 'c8 - up';\n\n\t\telse if( this.a0 == this.a1 && this.a1 < this.a2 )\n\t\t\ttr = 'c9 - down';\n\n\t\treturn tr;\n\t}\n\n\ttAvgs = 2;\n\tdegSpe01 = 0\n\tdegSpe02 = 0\n\n\tpreA0DS01 = 0;\n\tpreA0DS02 = 0;\n\taccels(){\n\t\tthis.degSpe01 = ( parseFloat(this.a0)-parseFloat(this.a1) )/1;\n\t\tthis.degSpe02 = ( parseFloat(this.a0)-parseFloat(this.a2) )/2;\n\n\t\tstoreIt(\"ap_preA0DS01\", ( (this.a0+(this.degSpe01*this.tPredict)) ), sec30);\n\t\tstoreIt(\"ap_preA0DS02\", ( (this.a0+(this.degSpe02*this.tPredict)) ), sec30);\n\t\tthis.preA0DS01 = avgIt('ap_preA0DS01',sec1*3);\n\t\tthis.preA0DS02 = avgIt('ap_preA0DS02',sec1*3);\n\n\t\treturn \"ds: \"+this.degSpe01.toFixed(2)+\" \"+\n\t\t\tthis.degSpe02.toFixed(2)+\" deg/s\";\n\t}\n\n\n\ttLastAct = 0;\n\teveryT = 1000;\n\tactType = '';\n\tlastDelta = 0;\n\n\ttPredict = 15;\n\tstartTrashHold = 5;\n\tmaxAngleSpeed = 2.0;\n\terrorToCorrectionGain = 0.05;\n\tlandingAHeadGain = 1.5;\n\n\ttillerOffset = 0;\n\ttillerPos = 0;\n\n\ttillerTuneLast = 0;\n\n\ttillerStack = [];\n\n\tlandingHardDirection = 0;\n\n\ttillerStackSum(){\n\t\treturn this.tillerStack.reduce((partialSum, a) => partialSum + a, 0);\n\n\t}\n\n\thdm = 0;\n\tdelta = 0;\n\ttarget = 0;\n\tresp = 1;\n\tgain2 = 600;\n\ton = false;\n\n\tgetStatusMsg(){\n\t    if( this.on ){\n          return \"auto to: \"+Math.round(this.target);\n      }else{\n        return \"stand by\";    \n      }\n\t}\n\t\n\tgetStatusResp(){\n\t\treturn {\n        hdm: this.hdm,\n        target: this.target,\n        delta: this.a0,\n        tillerPos: this.tillerPos,\n        tillerBy: this.tillerGetToSend(  ),\n        time: new Date()\n        };\n\t}\n\n\tsetAuto( target ){\n\t\tthis.setTarget( target );\n\t\tthis.tillerStack = [];\n\t\tthis.actType = '';\n\t\tthis.on = true;\n\n\t}\n\n\tsetStandby(){\n        this.on = false;\n        this.actType = '';\n\t}\n\n\n\n\tsetTarget(target){\n\t\tthis.target = target;\n\t}\n\n\ttillerBy( by ){\n\t\tif( Math.abs(by) > 0.01 ){\n\t\t\tthis.tillerStack.push(by);\n\t\t\tthis.tillerPos+= by;\n\t\t\t//apTillerFake+= by*this.gain2;\n\t\t\tthis.tillerToSend.push( by*this.gain2 );\n\t\t}\n\t\t//$(\"#apDebTillerPos\").text(apTillerFake);\n\t\t//this.db(\" --> tiller is:\"+apTillerFake+\" and offset:\"+this.tillerOffset);\n\t}\n\n\ttillerToSend = [];\n\ttillerGetToSend(){\n\t\tvar tr = this.tillerToSend.reduce((partialSum, a) => partialSum + a, 0);\n\t\tthis.tillerToSend = [];\n\t\treturn tr;\n\t}\n\n\tupdate( hdm ){\n\t    if( this.on == false )\n\t        return this.getStatusResp();\n\t        \n\t\tthis.hdm = hdm;\n\t\tthis.delta = degDelta( this.hdm, this.target );\n\t\tvar t = new Date().getTime();\n\t\tstoreIt(\"apDelta\", this.delta, sec30 );\n\t\tthis.a0 = avgIt('apDelta', sec1);\n\t\tthis.a1 = avgIt('apDelta', sec1*2) ||0;\n\t\tthis.a2 = avgIt('apDelta', sec1*4) ||0;\n\n\t\tthis.db(\n\t\t\t\"\t\"+ Math.round(this.a2)+\n\t\t\t\"\t\"+Math.round(this.a1)+\n\t\t\t\"\t\"+Math.round(this.a0)+\n\t\t\t\"<br>\t\tacc: \"+this.accels()+\n\t\t\t\"\t\tq: \"+ this.q1()+\n\t\t\t\"<br> delt pred \"+this.tPredict+\"sec: \"+\n\t\t\tthis.preA0DS01.toFixed(0)+\" \"+this.preA0DS02.toFixed(0)+\" \"\n\n\t\t );\n\n\t\t /*\n\t\t var deb0 = {'deb0':{\n\t\t\t'time': new Date(),\n\n\t\t\t'a0': this.a0,\n\t\t\t'a1': this.a1,\n\t\t\t'a2': this.a2,\n\t\t\t'hdm': apHDMFake,\n\t\t\t'target': $(\"#ap2Target\").val()\n\t\t \t}};\n\t\t sOutSend('apDeb:'+JSON.stringify(deb0));\n\n\t\t var deb0 = {'debPreA0DS01':{\n\t\t\t'time': new Date().getTime()+(this.tPredict*1000),\n\t\t\t'data0': this.preA0DS01,\n\t\t\t'data1': this.preA0DS02,\n\t\t \t}};\n\t\t sOutSend('apDeb:'+JSON.stringify(deb0));\n\n\t\t var deb0 = {\n\t\t\t'time': new Date(),\n\t\t\t'hdm': apHDMFake,\n\t\t\t'target': $(\"#ap2Target\").val()\n\t\t \t};\n\t\t sOutSend('apDeb:'+JSON.stringify(deb0));\n\t\t */\n\n\n\n\n\n\n\t\t if( this.tLastAct < (t-this.everyT) || this.tLastAct == 0 ){\n\t\t\t this.db(\"$ action [\"+this.actType+\"] old\"+(t-this.tLastAct));\n\n\t\t\t var trashHoldWithGain = Math.abs( Math.abs(this.degSpe01)>1? Math.abs(this.degSpe01)*this.landingAHeadGain : this.landingAHeadGain )*this.startTrashHold;\n\n\t\t\t if( Math.abs( this.lastDelta ) < this.startTrashHold || Math.abs( this.preA0DS02 ) < this.startTrashHold )\n\t\t\t \tthis.db(\" is ok :)\");\n\n\n\n\t\t\t\tvar tillerSum = this.tillerStackSum();\n\n\t\t\t\tif( this.actType == 'landing' &&\n\t\t\t\t\t(t-this.tLastAct) >= 4000\n\t\t\t\t\t){\n\t\t\t\t\t\tthis.actType = '';\n\t\t\t\t\t\tthis.db(\"[landing ABORD]\");\n\t\t\t\t}\n\n\t\t\t\tif( this.actType == 'tune offset start' &&\n\t\t\t\t\tMath.abs( this.a0 ) >= this.startTrashHold\n\t\t\t\t\t){\n\t\t\t\t\t\tthis.actType = '';\n\t\t\t\t\t\tthis.tLastAct = t;\n\n\t\t\t\t\t\tif( this.degSpe01 > 0 ){\n\t\t\t\t\t\t\tthis.tillerBy( -0.05 );\n\t\t \t\t\t\t \tthis.tillerStack = [];\n\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tthis.tillerBy( 0.05 );\n\t\t \t\t\t\t \tthis.tillerStack = [];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.db(\"[<b>tune offset ABORD</b>]\");\n\n\t\t\t\t}\n\n\t\t\t\tif( this.actType == 'tune offset start' ){\n\t\t\t\t\tvar res = \"none\";\n\n\t\t\t\t\tif( this.degSpe01 > 0 ){\n\t\t\t\t\t\tthis.tillerBy( -0.05 );\n\t \t\t\t\t \tthis.tillerStack = [];\n\t\t\t\t\t\tres = \"-\";\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.tillerBy( 0.05 );\n\t \t\t\t\t \tthis.tillerStack = [];\n\t\t\t\t\t\tres = \"+\";\n\t\t\t\t\t}\n\n\n\t\t\t\t\tthis.actType = '';\n\t\t\t\t\tthis.tLastAct = t;\n\t\t\t\t\tthis.db(\"[<b>tune offset DONE</b>] res:\"+res);\n\t\t\t\t}\n\n\t\t\t\tif( this.actType == '' &&\n\t\t\t\t\tMath.abs(this.degSpe01) < 0.5 &&\n\t\t\t\t\tMath.abs( this.a0 ) < this.startTrashHold &&\n\t\t\t\t\tMath.abs( this.a1 ) < this.startTrashHold &&\n\t\t\t\t\ttillerSum == 0\n\t\t\t\t\t){\n\n\t\t\t\t\tthis.tillerTuneLast = this.degSpe01;\n\t\t\t\t\tthis.actType = 'tune offset start';\n\t\t\t\t\tthis.tLastAct = t+sec1*3;\n\t\t\t\t\tthis.db(\"[<b>tune offset start</b>]\");\n\n\t\t\t\t}else if(\n\t\t\t\t this.actType == 'landing hard' &&\n\t\t\t\t this.tillerStack.length == 0\n\t\t\t ){\n\t\t\t \t\tthis.actType = '';\n\t\t\t\t\tthis.tLastAct = t+sec1*2;\n\t\t\t\t\tthis.db(\" [ clean landing hard ]\");\n\t\t\t\t\tthis.db(\" [landing direction ]\"+this.landingHardDirection);\n\t\t\t\t\tthis.db(\" a0:\"+this.a0);\n\n\n\t\t\t\t\t/*\n\t\t\t\t\tif( this.landingHardDirection == 1 )\n\t\t\t\t\t\tif( this.a0 > 0 )\n\t\t\t\t\t\t\tthis.tPredict+= 1;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthis.tPredict-= 1;\n\n\t\t\t\t\tif( this.landingHardDirection == -1 )\n\t\t\t\t\t\tif( this.a0 < 0 )\n\t\t\t\t\t\t\tthis.tPredict+= 1;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tthis.tPredict-= 1;\n\n\t\t\t\t\tif( this.tPredict < 5 )\n\t\t\t\t\t\tthis.tPredict = 5;\n\t\t\t\t\telse if( this.tPredict > 30 )\n\t\t\t\t\t\tthis.tPredict = 30;\n\t\t\t\t\t*/\n\n\t\t\t\t}else if(\n\t\t\t\t this.actType != 'landing hard' &&\n\t\t\t\t this.tillerStack.length > 0 &&\n\t\t\t\t ( this.lastDelta > 0 ) != ( this.preA0DS02 > 0)\n\t\t\t \t){\n\t\t\t\t this.actType = 'landing hard';\n\t\t\t\t var sum = tillerSum;\n\n\t\t\t\t this.tillerBy( -(sum*0.98) );\n\t\t\t\t this.tillerStack = [];\n\t\t\t\t this.tLastAct = t+sec1*3;\n\n\t\t\t\t this.landingHardDirection = sum >= 0 ? 1 : -1;\n\n\t\t\t\t this.db(\" [landing hard] by stack tiller \"+this.tillerStack.toString());\n\n\n\t\t\t }else if( (\n\t\t\t\t this.actType == 'correct' ||\n\t\t\t\t this.actType == 'langing '\n\t\t\t \t\t) &&\n\t\t\t \t(\n\t\t\t\t\tMath.abs( this.a0 )  <= trashHoldWithGain   ||\n\t\t\t \t\tMath.abs( this.preA0DS02 ) <= trashHoldWithGain\n\t\t\t\t)\n\t\t\t){\n\t\t\t\t this.actType = 'landing';\n\t\t\t\t this.tillerBy( -tillerSum/2 );\n\n\t\t\t\t this.tLastAct = t+sec1*0.5;\n\t\t\t\t this.db(\" [landing] by stack tiller \"+this.tillerStack.toString());\n\n\t\t\t\t \tif( this.tillerStack.length == 0 ){\n\t\t\t\t\t\tthis.actType = 'landing done';\n\t\t\t\t\t\tthis.tLastAct = t;\n\t\t\t\t\t\tthis.tLastAct = t+sec1;\n\t\t\t\t\t\tthis.db(\"\t[landing done] out of tiller stack\");\n\t\t\t\t\t\tthis.landingAHeadGain-=0.1;\n\t\t\t\t\t}\n\n\t\t\t }else if( ( this.actType == '' || this.actType == 'correct' ) &&\n\t\t\t \tMath.abs( this.a0 ) > this.startTrashHold &&\n\t\t\t \tMath.abs( this.preA0DS02 ) > this.startTrashHold\n\n\n\t\t\t ){\n\t\t\t\t this.lastDelta = this.a0;\n\t\t\t\t this.actType = 'correct';\n\t\t\t\t var tickBy = this.errorToCorrectionGain*this.a0;\n\t\t\t\t var maxOnStack = 3;\n\t\t\t\t \tif( tickBy > maxOnStack )\n\t\t\t\t \t\ttickBy = maxOnStack;\n\t\t\t\t\telse if( tickBy < -maxOnStack)\n\t\t\t\t\t\ttickBy = -maxOnStack;\n\n\t\t\t\t\tvar tillSumAbs = Math.abs( tillerSum );\n\t\t\t\t\tvar afterTilerSum = tillSumAbs+Math.abs(tickBy);\n\n\t\t\t\t if( afterTilerSum<maxOnStack )\n\t\t\t\t \tthis.tillerBy( -tickBy );\n\t\t\t\t else{\n\t\t\t\t\tthis.db(\" correct maxt out!\" + tillerSum);\n\t\t\t\t\tthis.tillerBy(\n\t\t\t\t\t\t( maxOnStack - tillSumAbs ) * (tickBy >= 0 ? -1 : 1)\n\t\t\t\t\t );\n\t\t\t\t\tthis.db(\"  so max on :\"+this.tillerStackSum());\n\t\t\t\t }\n\t\t\t\t this.tLastAct = t+sec1;\n\t\t\t\t this.db(\" [correct] by tick by:\"+tickBy);\n\n\n\t\t\t }\n\n\t\t }\n\t\t \n\t\t return this.getStatusResp();\n\n\t}\n\n\t\n\n}\n\n    \n    \n    var apS = new apSolver();\n    \n    function getApS(){\n        return apS;\n    }\n    \n    \n    \n    return {\n        add: add,\n        getHello:getHello,\n        degPos: degPos,\n        degDelta: degDelta,\n        Controller:Controller,\n        getPid: getPid,\n        apContener: apContener,\n        getApContener: getApContener,\n        apSolver: apSolver,\n        getApS: getApS\n    };\n    \n}());\n\nglobal.set('mutil', mutil);\n\n    \n    \n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":980,"wires":[[]]},{"id":"59aeb56c4852664c","type":"function","z":"dc100dc94d61a256","name":"autopilot brain","func":"\nvar mu = global.get('mutil');\n//var apV3 = global.get('apV3');\nvar pid = mu.getPid();\n//var ap = mu.getApS()//mu.getApContener()\n\n// Auto pilot drivers\n//var apV3 = global.get('apV3');\nvar apVPID2 = global.get('apVPID2');\nvar apVB1 = global.get('apVB1');\n\n\nvar ap = flow.get('apObj')||undefined;\nif( ap == undefined ){\n    //ap = new apV3();\n    //ap = new apVPID2();\n    ap = new apVB1();\n    \n    flow.set('apObj',ap);\n}\nglobal.set('apOnIs', ap.on );\n\nvar apMode = flow.get('apMode')||undefined;\nvar apMinMove = 25;\n\nfunction sendApStatus(){\n    node.send([\n        {\n            topic: 'ap/status',\n            payload: \n                (ap.getStatusMsg().on == '1' ? apMode+': '+ap.target :'stand by')\n        },\n        null\n    ]);\n}\n\nfunction sendSettingsStatus(){\n    node.send([\n        {\n            topic: 'ap/settings',\n            settings: ap.getSettings()\n        },\n        null\n    ]);\n}\n\nfunction makeApToRMB(){\n    if( apMode == 'toRMB'){\n        var rmbLast = flow.get('rmbLast')||undefined;\n        if( rmbLast != undefined ){\n            if( ap.on ){\n                ap.setTarget(rmbLast);\n            }else{\n                ap.setAuto(rmbLast);\n            }\n            sendApStatus();\n        }\n    }\n}\n\n// on connection of client send init status\nif( msg.status && msg.status.event == 'connect' ){\n    node.send([\n        {\n            topic: 'ap/status',\n            payload: \"i:\"+ \n                (ap.getStatusMsg().on == '1' ? apMode+': '+ap.target :'stand by')\n        },\n        null\n    ]);\n        \n    sendSettingsStatus();\n    \n    \n}\n\n// on incomming cmd\nif( msg._session && msg._session.type == 'websocket'){\n    if( msg.payload == 'ap:standby' ){\n        flow.set('apMode','stand by');\n        apMode = 'stand by';\n        ap.setStandby();\n        node.send([\n            {\n                topic: 'ap/status',\n                payload: (ap.getStatusMsg().on == '1' ? apMode+': '+ap.target :'stand by')\n            },\n            null\n        ]);\n            \n    }else if( msg.payload.substring(0,8) == 'ap:auto:' ){\n        flow.set('apMode','auto');\n        apMode = 'auto';\n        ap.setAuto( parseFloat(msg.payload.substring(8)) );\n        sendApStatus();\n        \n    }else if( msg.payload == 'ap:toRMB' ){\n        flow.set('apMode','toRMB');\n        apMode = 'toRMB';\n        makeApToRMB();\n        \n    }else if( msg.payload.substring(0,17) == 'ap:correctTarget:' ){\n        var t = parseFloat( msg.payload.substring(17) );\n        ap.setTarget(\n            t+ap.target\n            );\n        sendApStatus();\n        if( !ap.on ){\n            node.send([\n                null,\n                {\n                    topic: 'NR/ap/tillerBy',\n                    payload: t > 0 ? 200 : -200\n                }\n            ]);\n        }\n    }else if( msg.payload.substring(0,19) == 'ap:correctTargetMs:' ){\n        var t = parseFloat( msg.payload.substring(19) );\n        node.send([\n            null,\n            {\n                topic: 'NR/ap/tillerBy',\n                payload: t \n            }\n        ]);\n    \n         \n    }else if( msg.payload.substring(0,6) == 'apDeb:' ){\n        j = JSON.parse( msg.payload.substring(6) );\n            node.send([\n                {\n                    topic: 'ap/debug',\n                    payload: j\n                },  \n                null\n            ]);\n\n        \n    \n            \n    }else if( msg.payload.substring(0,14) == 'ap:setSetting:' ){\n        var set = msg.payload.substring(14).split(',');\n        var conf = ap.getSettings();\n        var i = 0;\n        for(var k in conf){\n            conf[k] = set[i++];\n        }\n        ap.setSettings( conf );\n        sendSettingsStatus();\n    }\n    \n}\n\n// getting mqtt mag\nfunction onNewMag( h ){\n    if( ap.on ){\n        res = ap.update( parseFloat(h) );\n        var moveBy = Math.round( res.tillerBy*ap.config['tillerGain'] );\n        if( Math.abs( moveBy ) < apMinMove && moveBy != 0 )\n            moveBy = apMinMove * ( moveBy >= 0 ? 1 : -1 );\n        \n        if( moveBy != 0 )\n            node.send([\n                null,\n                {\n                    topic: 'NR/ap/tillerBy',\n                    payload: moveBy.toString()\n                }\n                ]);\n                \n        res['mode'] = apMode;\n        \n        node.send([\n            {\n                topic: 'ap/workStat',\n                payload: res\n            },\n            null\n            ]);\n    }\n    \n    node.status({\n        text:\"mag:\"+h+\" ap.on:\"+(ap.on?'1':'0')\n        \n    });\n}\nif( msg.topic == 'and/mag' ){\n    var h = parseFloat(msg.payload );\n    \n    onNewMag( h );\n\n}else if( msg.topic == 'NR/nav/rmb' ){\n    makeApToRMB();\n    \n}else if( msg.payload.substring(0,13) == \"apDebHDMFake:\"){\n    var h = parseFloat( msg.payload.substring(13) );\n    \n    node.send([\n        null,\n        {\n            topic: 'and/mag',\n            payload: h,\n            fake: \"1\"\n        }\n        ]);\n    \n    onNewMag( h );\n    \n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":860,"wires":[["f0e20f44c35a8239"],["445759ff7004b406"]]},{"id":"8267680d0b26c922","type":"status","z":"dc100dc94d61a256","name":"","scope":["f0e20f44c35a8239","318a83a44dedb148"],"x":200,"y":860,"wires":[["59aeb56c4852664c"]]},{"id":"e1918c7f5d862745","type":"debug","z":"dc100dc94d61a256","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":1080,"wires":[]},{"id":"d71b19826e14c537","type":"inject","z":"dc100dc94d61a256","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"test","payloadType":"str","x":370,"y":1080,"wires":[["07b190e542a256f2"]]},{"id":"07b190e542a256f2","type":"function","z":"dc100dc94d61a256","name":"test global funcs","func":"var mu = global.get('mutil');\n\nmuTest = {\n    'add( 10, 1 ) -> 11': mu.add(10,1),\n    'getHello' : mu.getHello()\n};\n\nnode.send({payload:mu.degPos(-90)});\n\nd3 = {\n    \"pos(-180) -> 180\":mu.degPos(-180),\n    \"pos(-190) -> 170\":mu.degPos(-190),\n    \"pos(-361) -> 359\":mu.degPos(-361),\n    \"pos(-350) -> 10\":mu.degPos(10),\n    \"delta( 0, 10) -> 10\": mu.degDelta(0,10),\n    \"delta( 0, -10) -> -10\": mu.degDelta(0,-10),\n    \"delta( 90, -90) -> -190 || 190\": mu.degDelta(90,-90)\n};\n\nnode.send({\n    muTest,\n    d3,\n    'Controller': mu.getPid().getHello()\n});","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":1080,"wires":[["e1918c7f5d862745"]]},{"id":"445759ff7004b406","type":"mqtt out","z":"dc100dc94d61a256","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":830,"y":860,"wires":[]},{"id":"a1aa287a39c1af61","type":"inject","z":"dc100dc94d61a256","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":1260,"wires":[["ce2951657404b6c2"]]},{"id":"ce2951657404b6c2","type":"function","z":"dc100dc94d61a256","name":"","func":"var mu2 = global.get('mutil2');\nvar m = new mu2();\n\nreturn {\n    payload: m.add(11, 9)\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1280,"wires":[["e323e4f2bf68cf79"]]},{"id":"e323e4f2bf68cf79","type":"debug","z":"dc100dc94d61a256","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":620,"y":1300,"wires":[]},{"id":"953d641a74fddca2","type":"inject","z":"dc100dc94d61a256","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":300,"y":1380,"wires":[["c7d3e9f04dd7377c"]]},{"id":"c7d3e9f04dd7377c","type":"function","z":"dc100dc94d61a256","name":"","func":"var apV3 = global.get('apV3');\nvar ap = flow.get('ap')||undefined;\nif( ap == undefined ){\n    var m = new apV3();\n    flow.set('ap',m);\n}else{\n    var m = ap;\n}\n\nreturn {\n    payload: m.getStatusMsg()\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480,"y":1400,"wires":[["29e5d82811f992e4"]]},{"id":"29e5d82811f992e4","type":"debug","z":"dc100dc94d61a256","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":670,"y":1420,"wires":[]},{"id":"32544cf6b5eda58e","type":"status","z":"dc100dc94d61a256","name":"","scope":["318a83a44dedb148"],"x":160,"y":260,"wires":[["6c193329fe0d5f0c","5bd0c7a0667d33b1"]]},{"id":"6c193329fe0d5f0c","type":"link out","z":"dc100dc94d61a256","name":"","mode":"link","links":["52f734b330961380"],"x":275,"y":260,"wires":[]},{"id":"1281fb87c2d4260a","type":"inject","z":"dc100dc94d61a256","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"0.3","crontab":"","once":false,"onceDelay":0.1,"topic":"NR/ap/tillerBy","payload":"0","payloadType":"str","x":1190,"y":620,"wires":[["fc13f72416feba8e"]]},{"id":"fc13f72416feba8e","type":"function","z":"dc100dc94d61a256","name":"If working maitain clutch","func":"if( global.get('apOnIs') )\n    return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1430,"y":620,"wires":[["445759ff7004b406"]]},{"id":"87fe520f52230b8d","type":"websocket in","z":"dc100dc94d61a256","name":"","server":"","client":"69e856b8b70c05bf","x":1200,"y":520,"wires":[["e92ef736fe8a53ea"]]},{"id":"e92ef736fe8a53ea","type":"debug","z":"dc100dc94d61a256","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1490,"y":520,"wires":[]},{"id":"5bd0c7a0667d33b1","type":"function","z":"dc100dc94d61a256","name":"ScreenManager","func":"if( msg.status ){\n    if( msg.status.event == \"connect\" ){\n        screenCount = (global.get(\"SMScreenCount\")+1)||0;\n        if(parseInt(screenCount)>99)\n            screenCount = 0;\n        global.set(\"SMScreenCount\", screenCount);\n        node.status({ text: \"SMs:\"+screenCount });\n        \n        return {\n            topic: \"SMForYou\",\n            payload:screenCount+\"\"\n        };\n        \n    }\n}\n\n\nif( msg.payload ){\n    if( msg.payload.substring(0,3) == \"SM:\" ){\n        var c = msg.payload.substring(3);\n        node.status({ text: \"SM: [\"+c+\"]\" });\n        \n        \n        if( c == \"identifyOn\" ){\n            return {\n                topic: \"SMidentifyOn\",\n                payload: \"1\"\n            };\n        }\n        \n        \n    }else if( msg.payload.substring(0,8) == \"SMToAll:\" ){\n        var c = msg.payload.substring(8);\n        node.status({ text:\"SM to all:[\"+c+\"]\" });\n        \n        return {\n            topic: \"SMToAll\",\n            payload: c\n        };\n    //SMStat    \n    }else if( msg.payload.substring(0,7) == \"SMStat:\" ){\n        var c = msg.payload.substring(7);\n        node.status({ text:\"SMStat:[\"+c+\"]\" });\n        \n        return {\n            topic: \"SMStat\",\n            payload: c\n        };\n    \n    //SMCmdTo\n    }else if( msg.payload.substring(0,7) == \"SMCmdTo\" ){\n        var c = msg.payload.substring(7).split(',');\n        c.shift();\n        node.status({ text:\"SMCmdTo:[\"+c[0]+\"] cmd:\"+c[1] });\n        \n        return {\n            topic: \"SMCmdTo\",\n            No: c[0],\n            payload: c[1]\n        };\n    }\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":360,"wires":[["f0e20f44c35a8239"]]},{"id":"a31c8fdeb21292d1","type":"debug","z":"dc100dc94d61a256","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":510,"y":440,"wires":[]},{"id":"f170d0b14db74faa","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":0,"width":0,"height":0,"passthru":false,"label":"Service Stop","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":170,"y":100,"wires":[["b01fc3f2b730ef48"]]},{"id":"b01fc3f2b730ef48","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shStopService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStopService.sh","x":410,"y":80,"wires":[[],[],[]]},{"id":"cfe0a228805592b3","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":7,"width":"3","height":"1","passthru":false,"label":"All Start","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":160,"y":180,"wires":[["286f592ca64c5ab2"]]},{"id":"858e0527282fa7b1","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":7,"width":"3","height":"1","passthru":false,"label":"All Stop","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":160,"y":220,"wires":[["1485b6025b5fc67a"]]},{"id":"286f592ca64c5ab2","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shAllStart.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shAllStart.sh","x":390,"y":160,"wires":[[],[],[]]},{"id":"1485b6025b5fc67a","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shAllStop.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shAllStop.sh","x":390,"y":220,"wires":[[],[],[]]},{"id":"682dafa4ae7d3a5e","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":7,"width":"3","height":"1","passthru":false,"label":"Display on","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":170,"y":300,"wires":[["c68a8ea603a5401e"]]},{"id":"c68a8ea603a5401e","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shDisplayOn.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shDisplayOn.sh","x":400,"y":300,"wires":[[],[],[]]},{"id":"36dc405108bd81fb","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":7,"width":"3","height":"1","passthru":false,"label":"StandBy","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":160,"y":400,"wires":[["949334fc228c7cd1"]]},{"id":"949334fc228c7cd1","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shSpeedStandBy.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shSpeedStandBy.sh","x":420,"y":400,"wires":[[],[],[]]},{"id":"3cad93e94b670f97","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":7,"width":"3","height":"1","passthru":false,"label":"Slow","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":150,"y":480,"wires":[["69ccc2792e3861c0"]]},{"id":"69ccc2792e3861c0","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shSpeedSlow.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shSpeedSlow.sh","x":410,"y":460,"wires":[[],[],[]]},{"id":"da2d1d8a036fe3a2","type":"ui_dropdown","z":"82109d129821a2e2","name":"","label":"Speed","tooltip":"","place":"Select option","group":"259eb7cb0880866d","order":7,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"stand by","value":"standby","type":"str"},{"label":"slow","value":"slow","type":"str"},{"label":"fast","value":"fast","type":"str"},{"label":"display","value":"display","type":"str"}],"payload":"","topic":"topic","topicType":"msg","className":"","x":160,"y":540,"wires":[["10416b31297ca027","a416bcbb7d5c894f"]]},{"id":"10416b31297ca027","type":"debug","z":"82109d129821a2e2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":450,"y":660,"wires":[]},{"id":"a416bcbb7d5c894f","type":"function","z":"82109d129821a2e2","name":"","func":"if( msg.payload == \"slow\" )\n    return {payload: \"/data/data/com.termux/files/home/ySS/shSpeedSlow.sh\"};\n    \nelse if( msg.payload == \"standby\" )\n    return {payload: \"/data/data/com.termux/files/home/ySS/shSpeedStandBy.sh\"};\n\nelse if( msg.payload == \"display\" ){\n    node.status({\n        fill:'blue',\n        shape: 'ring',\n        text:\"do display\"\n        });\n    return {payload: \"/data/data/com.termux/files/home/ySS/shDisplayOn.sh\"};\n    \n\n}else\n    return {payload: \"/data/data/com.termux/files/home/ySS/shSpeedFast.sh\"};\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":560,"wires":[["7400fa975a412820"]]},{"id":"7400fa975a412820","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/usr/bin/sh","addpay":"payload","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"exec","x":590,"y":540,"wires":[[],[],[]]},{"id":"904eafe8d0de9cc9","type":"mqtt in","z":"82109d129821a2e2","name":"","topic":"and/ping","qos":"2","datatype":"auto","broker":"4bf528a73403ee8b","nl":false,"rap":true,"rh":0,"inputs":0,"x":160,"y":740,"wires":[["539d53d6edf7f882"]]},{"id":"539d53d6edf7f882","type":"ui_text","z":"82109d129821a2e2","group":"259eb7cb0880866d","order":7,"width":0,"height":0,"name":"At mqtt","label":"at mqtt","format":"{{msg.topic}} -->> {{msg.payload}}","layout":"row-spread","className":"","x":420,"y":740,"wires":[]},{"id":"0fafa51bd1b8176b","type":"ui_button","z":"82109d129821a2e2","name":"","group":"259eb7cb0880866d","order":0,"width":0,"height":0,"passthru":false,"label":"Service Start","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":170,"y":40,"wires":[["e8740e21ddbcf681"]]},{"id":"e8740e21ddbcf681","type":"exec","z":"82109d129821a2e2","command":"/data/data/com.termux/files/home/ySS/shStartService.sh","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"shStartService.sh","x":410,"y":20,"wires":[[],[],[]]},{"id":"8582cb221cc2b4ff","type":"inject","z":"82109d129821a2e2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":280,"wires":[["c68a8ea603a5401e"]]},{"id":"057b5c83e907c801","type":"inject","z":"82109d129821a2e2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":440,"wires":[["69ccc2792e3861c0"]]},{"id":"7a94c5e6f1a9575f","type":"inject","z":"82109d129821a2e2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":360,"wires":[["949334fc228c7cd1"]]},{"id":"a43a378918df5402","type":"inject","z":"efa51897ea7cb7f4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"0 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":230,"y":200,"wires":[["7f4830bea9c556f6"]]},{"id":"7f4830bea9c556f6","type":"function","z":"efa51897ea7cb7f4","name":"","func":"function dec2bin(dec) {\n  return (dec >>> 0).toString(2);\n}\n\nconst d = new Date();\nvar hour = d.getHours();\nvar hBin = dec2bin( hour );\n\nnode.status({\n    fill:'blue',\n    shape: 'ring',\n    text:\"houre: \"+hour+\" (\"+hBin+\")\"\n});\n\nfunction sendChar( tr, charNo, delay){\n    try{\n        setTimeout(\n            function(){ node.send({\n                payload: tr.charAt(charNo),\n                mp3:\"bell\"+tr.charAt(charNo)+\".mp3\"\n                }) \n            },\n            delay\n            );\n    }catch(e){}\n    \n}\nfor(var c=(hBin.length-1);c>=0;c--){\n    sendChar( hBin, c, (hBin.length-c)*2000);\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":200,"wires":[["b11858fd697c0a8c","f31df6e7cb076ffe"]]},{"id":"b11858fd697c0a8c","type":"debug","z":"efa51897ea7cb7f4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":730,"y":300,"wires":[]},{"id":"f31df6e7cb076ffe","type":"exec","z":"efa51897ea7cb7f4","command":"/data/data/com.termux/files/home/playSound.sh","addpay":"mp3","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"play sound","x":790,"y":80,"wires":[[],[],[]]},{"id":"50fc5ddd9ca21325","type":"exec","z":"4995893face99fd4","command":"/data/data/com.termux/files/usr/bin/sh","addpay":"","append":" /data/data/com.termux/files/usr/bin/ping -c 1 -w 20 www.wp.pl","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"ping www.wp.pl","x":560,"y":580,"wires":[["ef9031b64d6bbede","6b2a3ed64306be8b"],[],[]]},{"id":"bc2934c2e2054c59","type":"inject","z":"4995893face99fd4","name":"","props":[{"p":"payload"}],"repeat":"240","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"/data/data/com.termux/files/home/sNodeRedTest.sh","payloadType":"str","x":360,"y":580,"wires":[["50fc5ddd9ca21325"]]},{"id":"ef9031b64d6bbede","type":"debug","z":"4995893face99fd4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":950,"y":560,"wires":[]},{"id":"6b2a3ed64306be8b","type":"function","z":"4995893face99fd4","name":"","func":"if( msg.rc.code == 0 ){\n\n\n    var s = msg.payload.replace(\"\\t\", \" \").split(' ');\n    for(var w=0,wl=s.length-1;w<wl;w++){\n        if( s[w].substring(0,5) == 'time=' ){\n            var ms = s[w].substring(5);\n            node.status({\n               text: \"ms:\"+ms \n            });\n            node.send({\n                topic: 'hu/gsm/internetPingTime',\n                payload: ms\n            });\n            break;\n        }\n    }\n    \n    \n    return {\n        topic: 'hu/gsm/internetStatus',\n        payload: '1'\n    };\n    \n    \n    \n    \n}else{\n    node.send({\n        topic: 'hu/gsm/internetPingTime',\n        payload: '-1'\n    });\n    return {\n        topic: 'hu/gsm/internetStatus',\n        payload: '0'\n    };\n    \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":620,"wires":[["72084c139b6f2eb9"]]},{"id":"72084c139b6f2eb9","type":"mqtt out","z":"4995893face99fd4","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":950,"y":620,"wires":[]},{"id":"1a4e25a5e34308eb","type":"comment","z":"4995893face99fd4","name":"raport to hu/gsm/internetStatus","info":"","x":430,"y":520,"wires":[]},{"id":"e1e5ba30bff1ae48","type":"debug","z":"d4e42f8b078da96a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":530,"y":120,"wires":[]},{"id":"799bbcd726863730","type":"debug","z":"d4e42f8b078da96a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":610,"y":340,"wires":[]},{"id":"ba9d6d5ee983322c","type":"function","z":"d4e42f8b078da96a","name":"","func":"\nreturn {payload: ui };","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":340,"wires":[["799bbcd726863730"]]},{"id":"6e7e9cb44acf8ea7","type":"debug","z":"d4e42f8b078da96a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":850,"y":700,"wires":[]},{"id":"6fa031d84aa5c6a1","type":"mysql","z":"d4e42f8b078da96a","mydb":"cbada9e3a1ba45d8","name":"","x":640,"y":580,"wires":[["c3967a56d44f378c","7f36725e4bf117ac"]]},{"id":"57cb827ea774bcca","type":"inject","z":"d4e42f8b078da96a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"","payloadType":"date","x":210,"y":560,"wires":[["50af830e61946c3e"]]},{"id":"c3967a56d44f378c","type":"debug","z":"d4e42f8b078da96a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":580,"wires":[]},{"id":"50af830e61946c3e","type":"function","z":"d4e42f8b078da96a","name":"","func":"tr = {};\ntr['topic'] = 'select \\\n    id,resource,unit \\\n    from resources \\\n    where \\\n    entryDate>=:entryDate';\n    \ntr['payload'] = {\n    'entryDate':    0\n};\n\n\nreturn tr;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":580,"wires":[["6fa031d84aa5c6a1"]]},{"id":"0a69267fb020c353","type":"ui_template","z":"d4e42f8b078da96a","group":"2d06544978a5a923","name":"Autocomplete","order":2,"width":"6","height":"2","format":"<md-autocomplete md-no-cache=\"true\" \nmd-selected-item=\"selectedItem\" \nmd-items=\"items in msg.options | filter:searchText\" \nmd-select-on-match=\"true\"  \nmd-search-text=\"searchText\" \nplaceholder=\"{{msg.topic}}\" \nng-change=\"console.log(1)\"\n>\n<span ng-bind=\"items\" ></span></md-autocomplete>\n  ","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","className":"","x":920,"y":240,"wires":[["99a22ac73b36cc6b"]]},{"id":"99a22ac73b36cc6b","type":"debug","z":"d4e42f8b078da96a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1100,"y":240,"wires":[]},{"id":"cd86a26b549c31f3","type":"debug","z":"d4e42f8b078da96a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1030,"y":360,"wires":[]},{"id":"7f36725e4bf117ac","type":"function","z":"d4e42f8b078da96a","name":"","func":"tr = new Array()\n\nresources = new Array();\n\nfor(var i=0;i<msg.payload.length;i++){\n    if( msg.payload[i].resource ){\n        tr.push(\n            msg.payload[i].resource+\" - (\"+\n            msg.payload[i].unit+\n            \")\"\n            );\n        resources.push(msg.payload[i]);\n        \n    }\n}\n\nflow.set(\"resources\",resources);\n\nreturn {\n    options:tr,\n    topic:\"Resource\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":360,"wires":[["cd86a26b549c31f3","0a69267fb020c353"]]},{"id":"6dbc236f5f92d584","type":"ui_text_input","z":"d4e42f8b078da96a","name":"","label":"Notes","tooltip":"","group":"2d06544978a5a923","order":3,"width":"6","height":"2","passthru":true,"mode":"text","delay":300,"topic":"notes","sendOnBlur":true,"className":"","topicType":"str","x":210,"y":160,"wires":[["e357a050911ec736","e1e5ba30bff1ae48"]]},{"id":"5efe5e0d77a5f161","type":"ui_date_picker","z":"d4e42f8b078da96a","name":"","label":"Day","group":"2d06544978a5a923","order":1,"width":0,"height":0,"passthru":true,"topic":"entryDate","topicType":"str","className":"","x":210,"y":100,"wires":[["e357a050911ec736"]]},{"id":"189295cba787f42b","type":"ui_text_input","z":"d4e42f8b078da96a","name":"","label":"Quantity","tooltip":"","group":"2d06544978a5a923","order":4,"width":0,"height":0,"passthru":true,"mode":"number","delay":300,"topic":"quantity","sendOnBlur":true,"className":"","topicType":"str","x":220,"y":280,"wires":[["e357a050911ec736"]]},{"id":"f0931cf72ad39406","type":"ui_text_input","z":"d4e42f8b078da96a","name":"","label":"Unit","tooltip":"","group":"2d06544978a5a923","order":5,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"unit","sendOnBlur":true,"className":"","topicType":"str","x":210,"y":220,"wires":[["e357a050911ec736"]]},{"id":"43dc33a31961a24c","type":"comment","z":"d4e42f8b078da96a","name":"","info":" CREATE TABLE `resources` (\n     `id` int(11) NOT NULL AUTO_INCREMENT,\n     \n     `resource` varchar(255) COLLATE utf8_bin NOT NULL,\n     `unit` varchar(255) COLLATE utf8_bin NOT NULL,\n     \n     `entryDate` int(11) NOT NULL,\n     PRIMARY KEY (`id`)\n ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin\n AUTO_INCREMENT=1 ;\n \nCREATE TABLE `resourceRec` (\n     `id` int(11) NOT NULL AUTO_INCREMENT,\n     \n     `idResource` int(11)  NOT NULL,\n     `notes` varchar(255) COLLATE utf8_bin NOT NULL,\n     `quantity` varchar(255) COLLATE utf8_bin NOT NULL,\n     \n     `entryDate` int(11) NOT NULL,\n     PRIMARY KEY (`id`)\n ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin\n AUTO_INCREMENT=1 ;\n ","x":490,"y":60,"wires":[]},{"id":"e357a050911ec736","type":"function","z":"d4e42f8b078da96a","name":"form data collector","func":"if( msg.topic ){\n    flow.set(\"uiRes_\"+msg.topic, msg.payload);\n    node.status({\n        text: msg.topic+\": \"+msg.payload\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":200,"wires":[[]]},{"id":"c90c3d056b395385","type":"function","z":"d4e42f8b078da96a","name":"","func":"\nreturn {\n    entryDate: flow.get(\"uiRes_entryDate\"),\n    notes: flow.get(\"uiRes_notes\"),\n    quantity: flow.get(\"uiRes_quantity\"),\n    unit: flow.get(\"uiRes_unit\"),\n    resource: msg.resourceSelected\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":700,"wires":[["6e7e9cb44acf8ea7"]]},{"id":"9dddda2e6063c167","type":"ui_template","z":"d4e42f8b078da96a","group":"2d06544978a5a923","name":"Send it button","order":6,"width":"6","height":"1","format":"    \n<button ng-click=\"msg.payload = selectedItem; send(msg)\">Send it</button>\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","className":"","x":480,"y":700,"wires":[["c90c3d056b395385","99c09390cb9b9a22"]]},{"id":"99c09390cb9b9a22","type":"debug","z":"d4e42f8b078da96a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":600,"y":640,"wires":[]},{"id":"66c20f18a7f3dca3","type":"function","z":"6a13900dd386ba70","name":"","func":"entryDate = Math.floor(Date.now() / 1000);\ntr = {};\ntr['topic'] = 'insert into nrNotifications \\\n    (status, sentence,entryDate) VALUES \\\n    (:status,:sentence,:entryDate)';\n    \nstatus = 'info';\nif( msg.hasOwnProperty('status') )\n    status = msg.status;\n    \ntr['payload'] = {\n    'status':   status,\n    'sentence': msg.payload,\n    'entryDate':    entryDate\n};\n\nreturn tr;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":180,"wires":[[]]},{"id":"1888b791885c4105","type":"function","z":"6a13900dd386ba70","name":"","func":"tr = {\n    topic: 'select id,topic from topics;'\n};\n\n/*\ntr['topic'] = 'select id,topic from topics \\\n   (status, sentence,entryDate) VALUES \\\n    (:status,:sentence,:entryDate)';\n    \nstatus = 'info';\nif( msg.hasOwnProperty('status') )\n    status = msg.status;\n    \ntr['payload'] = {\n    'status':   status,\n    'sentence': msg.payload,\n    'entryDate':    entryDate\n};\n*/\nreturn tr;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":300,"wires":[["97b8be4414057d09"]]},{"id":"12faa3e97131d5f6","type":"debug","z":"6a13900dd386ba70","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":910,"y":640,"wires":[]},{"id":"831385e3e664246b","type":"inject","z":"6a13900dd386ba70","name":"make conversion","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":280,"wires":[["1888b791885c4105"]]},{"id":"97b8be4414057d09","type":"mysql","z":"6a13900dd386ba70","mydb":"cbada9e3a1ba45d8","name":"","x":800,"y":360,"wires":[["12faa3e97131d5f6","a19c74dea915810f"]]},{"id":"a19c74dea915810f","type":"function","z":"6a13900dd386ba70","name":"","func":"r = msg.payload;\nfor(var t=0;t<r.length;t++){\n    node.status({text: r[t]['topic']});\n    \n    tableName = 'topic_'+r[t]['topic'];\n    \n    cr = 'CREATE TABLE `'+tableName+'` ( \\\n    `id` int(11) NOT NULL AUTO_INCREMENT, \\\n    `msg` varchar(255) COLLATE utf8_bin NOT NULL, \\\n    `entryDate` int(11) NOT NULL, \\\n    PRIMARY KEY (`id`) \\\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin \\\nAUTO_INCREMENT=1 ;'; \n    \n    \n    node.send({\n        topic: cr\n    });\n    \n    up = 'INSERT INTO `'+tableName+'` (msg,entryDate) \\\nSELECT msg,entryDate FROM msgs where idTopic='+r[t]['id']+';'\n    \n    node.send({\n        topic:up\n    });\n    \n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1040,"y":360,"wires":[["ef2cccc7fb530563","7acea5700519156f"]]},{"id":"ef2cccc7fb530563","type":"debug","z":"6a13900dd386ba70","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":360,"wires":[]},{"id":"7acea5700519156f","type":"mysql","z":"6a13900dd386ba70","mydb":"cbada9e3a1ba45d8","name":"","x":1300,"y":220,"wires":[[]]},{"id":"9d7fa138e4512434","type":"function","z":"6a13900dd386ba70","name":"","func":"tr = {\n    topic: 'select id,topic from topics'\n};\n\n/*\ntr['topic'] = 'select id,topic from topics \\\n   (status, sentence,entryDate) VALUES \\\n    (:status,:sentence,:entryDate)';\n    \nstatus = 'info';\nif( msg.hasOwnProperty('status') )\n    status = msg.status;\n    \ntr['payload'] = {\n    'status':   status,\n    'sentence': msg.payload,\n    'entryDate':    entryDate\n};\n*/\nreturn tr;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":500,"wires":[["890eabd0236f6e1e"]]},{"id":"290164cb4c393c9c","type":"inject","z":"6a13900dd386ba70","name":"drop","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":440,"wires":[["9d7fa138e4512434"]]},{"id":"890eabd0236f6e1e","type":"mysql","z":"6a13900dd386ba70","mydb":"cbada9e3a1ba45d8","name":"","x":560,"y":500,"wires":[["12636526bb7944b2"]]},{"id":"12636526bb7944b2","type":"function","z":"6a13900dd386ba70","name":"","func":"r = msg.payload;\nfor(var t=0;t<r.length;t++){\n    node.status({text: \"drop:\"+r[t]['topic']});\n    \n    tableName = 'topic_'+r[t]['topic'];\n    \n    cr = 'DROP TABLE `'+tableName+'`;'; \n    \n    \n    node.send({\n        topic: cr\n    });\n    \n    \n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":500,"wires":[["7acea5700519156f"]]},{"id":"8d31608629435540","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"?","payloadType":"str","x":520,"y":60,"wires":[["5f06d7b5ffd5e269"]]},{"id":"5f06d7b5ffd5e269","type":"mqtt out","z":"f87d21ae04d5fae1","name":"","topic":"","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"d611ceefa2b9fd0b","x":830,"y":280,"wires":[]},{"id":"590e34cbd564bc4b","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"led:On","payloadType":"str","x":470,"y":140,"wires":[["5f06d7b5ffd5e269"]]},{"id":"1fc31c5dece5bc05","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"led:Off","payloadType":"str","x":470,"y":180,"wires":[["5f06d7b5ffd5e269"]]},{"id":"12c756bfdba930e5","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"NR/ap/tillerBy","payload":"200","payloadType":"str","x":510,"y":660,"wires":[["5f06d7b5ffd5e269"]]},{"id":"ec4e646402864651","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"NR/ap/tillerBy","payload":"-200","payloadType":"num","x":510,"y":700,"wires":[["5f06d7b5ffd5e269"]]},{"id":"1c20ea09d926bf65","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"p0:On","payloadType":"str","x":510,"y":300,"wires":[["5f06d7b5ffd5e269"]]},{"id":"c5ad7cae32bf7ea1","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"p0:Off","payloadType":"str","x":510,"y":340,"wires":[["5f06d7b5ffd5e269"]]},{"id":"856493728edfc770","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"p2:On","payloadType":"str","x":510,"y":420,"wires":[["5f06d7b5ffd5e269"]]},{"id":"0957fb19f8dbcdd4","type":"inject","z":"f87d21ae04d5fae1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"esp01APDrive/cmd","payload":"p2:Off","payloadType":"str","x":510,"y":460,"wires":[["5f06d7b5ffd5e269"]]}]